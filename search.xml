<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Mac å½•åˆ¶éŸ³é¢‘ï¼Œæ³¢å½¢å›¾çš„ç»˜åˆ¶]]></title>
    <url>%2F2017%2F11%2F08%2Fdraw-voice-wave-view%2F</url>
    <content type="text"><![CDATA[å¼€ç¯‡åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šæ•ˆæœå›¾ã€‚ ä¸Šé¢ä¸€é—ªä¸€é—ªçš„å¤§æ¦‚æ˜¯æ²¡å½•å¥½å§ã€‚ğŸ™„ éœ€æ±‚åˆ†æé¦–å…ˆåˆ†æè¿™æ®µåŠ¨ç”»çš„è¿‡ç¨‹ï¼š ç¬¬ä¸€é˜¶æ®µï¼šç‚¹å‡»å›¾æ ‡åï¼Œå›¾æ ‡åƒæ³¡æ³¡ä¸€æ ·æ”¶ç¼©æ”¾å¤§ï¼› ç¬¬äºŒé˜¶æ®µï¼šå›¾æ ‡ç¼©å°ï¼ŒåŒæ—¶å‘ä¸‹æ–¹ç§»åŠ¨ï¼› ç¬¬ä¸‰é˜¶æ®µï¼šæ³¢å½¢å›¾ç»˜åˆ¶ï¼Œéšç€æ•°æ®çš„å¢å¤šï¼Œæ³¢å½¢å›¾å‘å·¦ç§»åŠ¨ï¼ŒåŒæ—¶è§†å›¾çš„å®½åº¦è¶Šæ¥è¶Šé•¿ ç¬¬å››é˜¶æ®µï¼šè§†å›¾å®½åº¦è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼åä¸å†å¢å¤§ï¼Œæ³¢å½¢å›¾ç»§ç»­å‘å·¦ç§»åŠ¨ï¼Œè¶…å‡ºå·¦ä¾§èŒƒå›´çš„éƒ¨åˆ†ä¸å†æ˜¾ç¤ºã€‚ PS. æ³¢å½¢å›¾æ˜¯ä¸Šä¸‹å¯¹ç§°çš„å“¦ã€‚ å®ç°æ€è·¯é¦–å…ˆçœ‹åŠ¨ç”»ï¼Œå‰ä¸¤ä¸ªé˜¶æ®µçš„åŠ¨ç”»æœ‰å…ˆåé¡ºåºï¼Œç¬¬äºŒé˜¶æ®µçš„ä¸¤ä¸ªåŠ¨ç”»åŒæ—¶å‘ç”Ÿï¼Œå¯ä»¥ç”¨åŠ¨ç”»ç»„æ¥åšã€‚ ç„¶åï¼Œç¬¬äºŒã€ç¬¬ä¸‰é˜¶æ®µä¹‹é—´çš„èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å›¾æ ‡åˆšå¥½ç¼©å°åˆ°æ³¢å½¢è§†å›¾çš„é«˜åº¦åï¼Œæ³¢å½¢è§†å›¾å‡ºç°ï¼Œå¦‚æœåˆ†ä¸ºä¸¤ä¸ªè§†å›¾ï¼Œæ€»æœ‰ä¸€ä¸ªç”Ÿç¡¬çš„è¿‡æ¸¡è¿‡ç¨‹ï¼Œä¸ºäº†è¾¾åˆ°ä¸€ä¸ªæµç•…çš„è§†è§‰æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè§†å›¾æ¥åšã€‚ æœ€åï¼Œä»”ç»†çœ‹æ³¢å½¢å›¾ï¼Œæ–°æ•°æ®æ˜¯ä»å³ä¾§è¿›å…¥çš„ï¼Œç”±äºè¿™æ˜¯ä¸ªå½•éŸ³çš„è¿‡ç¨‹ï¼Œå› æ­¤æ•°æ®æ˜¯åœ¨ä¸æ–­å¢å¤šçš„ï¼Œå¯ä»¥ç”¨å®æ—¶ç»˜å›¾æ¥å®ç°ã€‚ æ¥ä¸‹æ¥ä¸Šè‡ªå®šä¹‰ button çš„ä»£ç ã€‚ ç¬¬ä¸€é˜¶æ®µ ~ ç¬¬äºŒé˜¶æ®µ VoiceRecordButton.m 123456789101112131415161718192021222324252627282930- (void)startAnimation&#123; self.enabled = NO; //åŠ¨ç”»è¿‡ç¨‹ä¸­ç¦ç”¨ [self moveAnchorPointToCenter]; //å°†é”šç‚¹ç§»åˆ°ä¸­å¿ƒ (ä¸ºäº†è¾¾åˆ°å›´ç»•ä¸­å¿ƒç¼©æ”¾çš„æ•ˆæœ) //æ”¾å¤§ CAKeyframeAnimation *scaleToBigAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform.scale"]; scaleToBigAnimation.values = @[@(1.0), @(.7f), @(1.f), @(1.3f), @(1.7f)]; //å…ˆä»1.0ç¼©å°åˆ°0.7ï¼Œå†æ”¾å¤§åˆ°1.7ï¼Œè¿™æ ·å°±å®ç°äº†æ³¡æ³¡æ•ˆæœ scaleToBigAnimation.duration = 0.5; scaleToBigAnimation.beginTime = 0; //ç¼©å° CAKeyframeAnimation *scaleAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform.scale"]; scaleAnimation.values = @[@(1.7f), @(1)]; scaleAnimation.duration = 0.75; scaleAnimation.beginTime = scaleToBigAnimation.beginTime + scaleToBigAnimation.duration; //ä½ç½®ä¸‹ç§»ï¼Œä¸ç¼©å°åŠ¨ç”»åŒæ—¶è¿›è¡Œ CABasicAnimation *positionAnimation = [CABasicAnimation animationWithKeyPath:@"position.y"]; positionAnimation.toValue = @(self.layer.position.y - NSWidth(self.frame)); positionAnimation.duration = scaleAnimation.duration; positionAnimation.beginTime = scaleAnimation.beginTime; //æ·»åŠ åŠ¨ç”»ç»„ CAAnimationGroup *animationGroup = [CAAnimationGroup animation]; animationGroup.delegate = self; animationGroup.duration = scaleToBigAnimation.duration + positionAnimation.duration; [animationGroup setValue:@"animationGroup" forKey:@"AnimationKey"]; animationGroup.animations = @[scaleToBigAnimation, scaleAnimation, positionAnimation]; [self.layer addAnimation:animationGroup forKey:@"animationGroup"];&#125; VoiceRecordButton.m123456789101112131415- (void)moveAnchorPointToCenter&#123; //ç”±äºå›¾å±‚é”šç‚¹é»˜è®¤æ˜¯åœ¨åŸç‚¹(0,0)ï¼Œéœ€è¦è®©å›¾å±‚å›´ç»•ä¸­å¿ƒç‚¹ç¼©æ”¾ self.layer.anchorPoint = CGPointMake(0.5, 0.5); //é”šç‚¹æ”¹å˜åï¼Œä¸ºäº†è®©å›¾å±‚éšç€è§†å›¾ç§»åŠ¨ï¼Œå°†å›¾å±‚çš„ä½ç½®ä¹Ÿæ”¹åˆ°é”šç‚¹çš„ä½ç½® NSRect rect = self.frame; CGFloat centerX = rect.origin.x + rect.size.width / 2.f; CGFloat centerY = rect.origin.y + rect.size.height / 2.f; self.layer.position = CGPointMake(centerX, centerY);&#125;- (void)resumeAnchorPoint&#123; self.layer.anchorPoint = CGPointZero; self.layer.position = self.frame.origin;&#125; åŠ¨ç”»ç»“æŸåï¼Œåœ¨ä»£ç†é‡Œè§¦å‘ä¸‹ä¸€æ­¥æ“ä½œã€‚ VoiceRecordButton.m123456789101112#pragma mark - CAAnimation delegate- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123; if (flag) &#123; if ([self.delegate respondsToSelector:@selector(voiceRecordingWillBegin)]) &#123; //æ‰§è¡Œä»£ç†æ–¹æ³•ï¼Œå‡†å¤‡æ•°æ® [self.delegate voiceRecordingWillBegin]; &#125; [self resumeAnchorPoint]; [self startRecording]; &#125;&#125; ç¬¬ä¸‰é˜¶æ®µ ~ ç¬¬å››é˜¶æ®µ æœ¬æ–‡ demo é‡Œæ‰€æœ‰çš„éŸ³é¢‘æ•°æ®éƒ½æ˜¯éšæœºç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®ï¼Œä¹Ÿæ²¡æœ‰å®ç°çœŸæ­£çš„å½•éŸ³å“ˆã€‚ æ§åˆ¶å™¨åœ¨ voiceRecordingWillBegin è¿™ä¸ªæ–¹æ³•é‡Œï¼Œå‡†å¤‡éœ€è¦ç»˜åˆ¶çš„æ•°æ®ã€‚ ViewController.m1234567891011121314151617181920212223242526272829303132333435#pragma mark - voice recording button delegate//å½•éŸ³å³å°†å¼€å§‹- (void)voiceRecordingWillBegin&#123; //ä¹‹å‰çš„åŠ¨ç”»åªæ˜¯å›¾å±‚åŠ¨ç”»ï¼Œå›¾å±‚å·²ç»åˆ°äº†ç›®æ ‡ä½ç½®ï¼Œä½†è§†å›¾çš„ frame è¿˜åœ¨åŸæ¥çš„ä½ç½®ï¼Œå› æ­¤è¦ä¿®æ”¹è§†å›¾çš„ä½ç½®å’Œå°ºå¯¸ NSRect frame = self.voiceRecordBtn.frame; CGFloat centerX = frame.origin.x + frame.size.width / 2.f; CGFloat centerY = frame.origin.y + frame.size.height / 2.f - frame.size.height; frame.size.width = 400; //è¿™æ˜¯è“è‰²æ³¢å½¢å›¾çš„æœ€å¤§å®½åº¦ frame.origin.x = centerX - frame.size.width / 2.f; frame.origin.y = centerY - frame.size.height / 2.f; self.voiceRecordBtn.frame = frame; //æ·»åŠ è®¡æ—¶å™¨ï¼Œæ„é€ æ¨¡æ‹Ÿæ•°æ® [self addTimer];&#125;- (void)addTimer&#123; //æ·»åŠ å®šæ—¶å™¨ _timer = [NSTimer scheduledTimerWithTimeInterval:.1f target:self selector:@selector(addPoint) userInfo:nil repeats:YES]; [[NSRunLoop mainRunLoop] addTimer:_timer forMode:NSRunLoopCommonModes];&#125;- (void)addPoint&#123; //éšæœºç‚¹ NSPoint point = NSMakePoint(self.voiceRecordBtn.bounds.size.height / 2.f, arc4random_uniform(NSHeight(self.voiceRecordBtn.frame) / 4.f) + 0); //æ’å…¥åˆ°æ•°ç»„ï¼ˆåŠ¨ç”»è§†å›¾æœ€å³è¾¹ï¼‰ï¼Œarrayæ·»åŠ CGPointéœ€è¦è½¬æ¢ä¸€ä¸‹// [self.pointArray insertObject:[NSValue valueWithPoint:point] atIndex:0]; [self.pointArray addObject:[NSValue valueWithPoint:point]]; //ä¼ å€¼ï¼Œé‡ç»˜è§†å›¾ self.voiceRecordBtn.pointArray = self.pointArray;&#125; å›åˆ°è‡ªå®šä¹‰æŒ‰é’®çš„.m æ–‡ä»¶ ç‚¹æ•°ç»„çš„ setter æ–¹æ³• VoiceRecordButton.m1234- (void)setPointArray:(NSArray *)pointArray&#123; _pointArray = pointArray; [self setNeedsDisplay:YES];&#125; å¼€å§‹å½•éŸ³ VoiceRecordButton.m1234567- (void)startRecording&#123; self.talking = YES; [self setNeedsDisplay:YES]; //å»¶è¿Ÿ_recordingDurationæ‰§è¡Œï¼Œè‹¥æ²¡æœ‰æ‰‹åŠ¨åœæ­¢ï¼Œåˆ™è‡ªåŠ¨åœæ­¢å½•éŸ³ [self performSelector:@selector(stopRecording) withObject:nil afterDelay:_recordingDuration];&#125; åœæ­¢å½•éŸ³ VoiceRecordButton.m1234567891011121314- (void)stopRecording&#123; //å–æ¶ˆå»¶è¿Ÿæ‰§è¡Œ [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(stopRecording) object:nil]; self.enabled = YES; self.frame = self.initialFrame; //å½•éŸ³ç»“æŸåï¼ŒæŒ‰é’®å›åˆ°ç‚¹å‡»å‰çš„åˆå§‹çŠ¶æ€ self.talking = NO; [self setNeedsDisplay:YES]; if ([self.delegate respondsToSelector:@selector(voiceRecordingDidFinish)]) &#123; [self.delegate voiceRecordingDidFinish]; &#125;&#125; ä»¥ä¸‹æ˜¯é‡å¤´æˆäº†ï¼Œæ¯æ¬¡è°ƒç”¨[self setNeedsDisplay:YES]æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨drawRect:(NSRect)dirtyRect æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•é‡Œç»˜åˆ¶æ•°æ®ã€‚ VoiceRecordButton.m123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172- (void)drawRect:(NSRect)dirtyRect&#123; [super drawRect:dirtyRect]; if (!self.talking) &#123; //ç°åœ¨æ²¡æœ‰åœ¨å½•éŸ³ï¼Œå³åˆå§‹çŠ¶æ€ NSBezierPath *rectPath = [NSBezierPath bezierPathWithOvalInRect:dirtyRect]; [[NSColor blueColor] setFill]; [rectPath fill]; NSImage *image = [NSImage imageNamed:@"SideAudio"]; [image drawInRect:dirtyRect]; return; &#125; CGFloat midY = NSHeight(dirtyRect) / 2.f; CGFloat midX = NSWidth(dirtyRect) / 2.f; CGFloat leftX = midX - _pointArray.count / 2.f - _initialWidth / 2.f; CGFloat rightX = midX + _pointArray.count / 2.f + _initialWidth / 2.f; // Drawing code here. CGContextRef ctx = [[NSGraphicsContext currentContext] graphicsPort]; //ç»˜åˆ¶åˆå§‹çº¿å‹ï¼Œæ¨¡æ‹Ÿä¸€èˆ¬å½•éŸ³åœºæ™¯ï¼Œåˆšå¼€å§‹å¯èƒ½æ²¡æœ‰è¯´è¯ï¼Œä¸€æ¡æ¨ªçº¿ CGMutablePathRef linePath = CGPathCreateMutable(); CGPathMoveToPoint(linePath, nil, leftX, midY); CGPathAddLineToPoint(linePath, nil, leftX + _initialWidth, midY); //_initialWidth æ¨ªçº¿çš„å®½åº¦ï¼Œè¿™é‡Œç»™äº†ä¸ªå›ºå®šå€¼ CGContextAddPath(ctx, linePath); //ç»˜åˆ¶ä¸ŠåŠéƒ¨åˆ†æ³¢å½¢ CGMutablePathRef halfPath = CGPathCreateMutable(); //ç»˜åˆ¶è·¯å¾„ CGPathMoveToPoint(halfPath, nil, NSWidth(dirtyRect), midY); for (NSInteger i = 0; i &lt; _pointArray.count; i++) &#123; NSValue *pointValue = _pointArray[i]; NSPoint point = pointValue.pointValue; NSInteger j = _pointArray.count - i - 1; if (point.y == 0) &#123; CGPathMoveToPoint(halfPath, nil, rightX - j + 1, midY); CGPathAddLineToPoint(halfPath, NULL, rightX - j, midY); &#125;else&#123; CGPathMoveToPoint(halfPath, nil, rightX - j, midY); CGPathAddLineToPoint(halfPath, NULL, rightX - j, midY + point.y); &#125; &#125; //å®ç°æ³¢å½¢å›¾åè½¬ CGMutablePathRef fullPath = CGPathCreateMutable();//åˆ›å»ºæ–°è·¯å¾„ CGPathAddPath(fullPath, NULL, halfPath); //åˆå¹¶è·¯å¾„ CGAffineTransform transform = CGAffineTransformIdentity; //åè½¬ //åè½¬é…ç½® transform = CGAffineTransformTranslate(transform, 0, NSHeight(dirtyRect)); transform = CGAffineTransformScale(transform, 1.0, -1.0); CGPathAddPath(fullPath, &amp;transform, halfPath); //å°†è·¯å¾„æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­ CGContextAddPath(ctx, fullPath); //ç»˜åˆ¶çŸ©å½¢åŒºåŸŸï¼Œå³ä¸æ–­å˜é•¿çš„è“è‰²èƒŒæ™¯ CGMutablePathRef rectPath = CGPathCreateMutable(); CGPathMoveToPoint(rectPath, nil, leftX, 0); CGPathAddRoundedRect(rectPath, nil, CGRectMake(leftX, 0, _pointArray.count + _initialWidth, NSHeight(dirtyRect)), NSHeight(dirtyRect) / 2.f, NSHeight(dirtyRect) / 2.f); CGContextAddPath(ctx, rectPath); CGContextSetLineWidth(ctx, 1); CGContextSetStrokeColorWithColor(ctx, [NSColor whiteColor].CGColor); CGContextSetFillColorWithColor(ctx, [NSColor blueColor].CGColor); CGContextDrawPath(ctx, kCGPathFillStroke); //ç§»é™¤ CGPathRelease(halfPath); CGPathRelease(fullPath);&#125; ç»“æŸï¼Œæ˜å¤©æ”¾æ’­æ”¾å½•éŸ³çš„åŠ¨ç”»å®ç°ã€‚ Demo åœ°å€ï¼šhttps://github.com/YunFei2015/AudioWaveAnimation.git]]></content>
      <categories>
        <category>Macå¼€å‘</category>
      </categories>
      <tags>
        <tag>åŠ¨ç”»</tag>
        <tag>ç»˜å›¾</tag>
        <tag>Mac å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºstoryboardä¸å¾—ä¸è¯´çš„äº‹]]></title>
    <url>%2F2017%2F05%2F05%2Fstoryboard-loading%2F</url>
    <content type="text"><![CDATA[è‡ª iOS 5 æ—¶ä»£è‹¹æœæ¨å‡º Storyboardï¼ˆä»¥ä¸‹ç®€ç§°SBï¼‰ä»¥æ¥ï¼Œå…³äºä½¿ç”¨ä»£ç æ‰‹å†™ UIã€SB å’Œ xib ä¹‹é—´çš„äº‰è®ºå°±ä¸€ç›´å­˜åœ¨ã€‚é—®é¢˜ä¸»è¦åœ¨äº Storyboard çš„åŠ è½½è¿‡ç¨‹æ˜¯å¦ä¼šå½±å“æ€§èƒ½ï¼Œä¸‹é¢å°±åˆ†æä¸€ä¸‹ Storyboard ä¸­çš„ ViewController æ˜¯æ€ä¹ˆåŠ è½½å‡ºæ¥çš„ã€‚ ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ Xcode æœ‰ä¸ª Compiling Storyboard files çš„è¿‡ç¨‹ã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œé¡¹ç›®é‡Œç”¨åˆ°çš„ SB æ–‡ä»¶ä¹Ÿä¼šè¢«ç¼–è¯‘ï¼Œå¹¶ä»¥ .storyboarc ä¸ºæ‰©å±•åæœ€ç»ˆä¿å­˜åœ¨ APP åŒ…å†…ã€‚.storyboardc æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢ä¿å­˜äº†æè¿°ç¼–è¯‘åçš„ SB ä¿¡æ¯çš„ Info.plist æ–‡ä»¶ï¼Œä»¥åŠä¸€ç³»åˆ— .nib æ–‡ä»¶ã€‚åŸæ¥çš„ SB ä¸­çš„æ¯ä¸ªå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸ª ViewControllerï¼‰å°†ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„ .nibï¼Œ.nib ä¸­åŒ…å«äº†ç¼–ç åçš„å¯¹åº”çš„å¯¹è±¡å±‚çº§ã€‚åœ¨åŠ è½½ä¸€ä¸ª SBï¼Œå¹¶ä»ä¸­è¯»å– ViewController ç±»å‹å’Œ nib çš„å…³ç³»ï¼Œæ¥å®Œæˆ UIStoryboard çš„åˆå§‹åŒ–ã€‚æ¥ä¸‹æ¥è¯»å–æŸä¸ª nibï¼Œå¹¶ä½¿ç”¨UINibDecoder è¿›è¡Œè§£ç ï¼Œå°† nib äºŒè¿›åˆ¶è¿˜åŸä¸ºå®é™…çš„å¯¹è±¡ï¼Œæœ€åè°ƒç”¨è¯¥å¯¹è±¡çš„ initWithCoderï¼š å®Œæˆå„ä¸ªå±æ€§çš„è§£ç ã€‚æœ€åï¼Œè°ƒç”¨ awakeFromNib æ–¹æ³•ï¼Œæ¥é€šçŸ¥å¼€å‘è€…ä» nib çš„åŠ è½½å·²ç»å®Œæ¯•ã€‚ å¯ä»¥çœ‹å‡ºï¼Œä»åªæœ‰ä¸€ä¸ª ViewController çš„ SB ä¸­åŠ è½½è¿™ä¸ª VCï¼Œä¸ä»æœ‰å¤šä¸ª ViewController çš„ SB ä¸­åŠ è½½çš„æƒ…å†µï¼Œé€Ÿåº¦ä¸Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ åŸæ–‡ï¼š å†çœ‹å…³äº Storyboard çš„ä¸€äº›äº‰è®º]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>Interface Build</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AFNetworking README ä¸­æ–‡ç‰ˆ]]></title>
    <url>%2F2017%2F01%2F25%2FAFNetworking-translate%2F</url>
    <content type="text"><![CDATA[AFNetworking README ä¸­æ–‡ç‰ˆAFNetworkingæ˜¯iOSå’ŒMac OS Xå¹³å°ä¸Šçš„è½»é‡çº§ç½‘ç»œåº“ï¼Œåœ¨Foudation URLåŠ è½½ç³»ç»ŸåŸºç¡€ä¸Šæ„å»ºï¼Œå¯¹æ„å»ºäºCocoaçš„å¼ºå¤§é«˜çº§çš„ç½‘ç»œæŠ½è±¡è¿›è¡Œäº†æ‰©å……ã€‚å®ƒå…·æœ‰è®¾è®¡è‰¯å¥½çš„ã€å¯Œæœ‰ç‰¹æ€§çš„ã€æ¨¡å—åŒ–ç»“æ„çš„APIæ¥å£é›†ã€‚ ä½“ç³»ç»“æ„NSURLSession ä¼šè¯ AFURLSessionManager AFHTTPSessionManager åºåˆ—åŒ– &lt;AFURLRequestSerialization&gt; AFHTTPRequestSerializer AFJSONRequestSerializer AFPropertyListRequestSerializer &lt;AFURLResponseSerialization&gt; AFHTTPResponseSerializer AFJSONResponseSerializer AFXMLParserResponseSerializer AFXMLDocumentResponseSerializer(Mac OS X) AFPropertyListResponseSerializer AFImageResponseSerializer AFCompoundResponseSerializer å…¶ä»–åŠŸèƒ½ AFSecurityPolicy AFNetworkReachabilityManager ç”¨æ³•AFURLSessionManagerAFURLSessionManageråœ¨ä¸€ä¸ªå®šä¹‰å¥½çš„NSURLSessionConfigurationå¯¹è±¡åŸºç¡€ä¸Šåˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ªNSURLSessionå¯¹è±¡, NSURLSessionConfigurationéµå¾ª&lt;NSURLSessionTaskDelegate&gt;, &lt;NSURLSessionDataDelegate&gt;, &lt;NSURLSessionDownloadDelegate&gt;, &lt;NSURLSessionDelegate&gt;åè®®. åˆ›å»ºä¸€ä¸ªä¸‹è½½ä»»åŠ¡1234567891011NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];NSURL *URL = [NSURL URLWithString:@"http://example.com/download.zip"];NSURLRequest *request = [NSURLRequest requestWithURL:URL];NSURLSessionDownloadTask *downloadTask = [manager downloadTaskWithRequest:request progress:nil destination:^NSURL *(NSURL *targetPath, NSURLResponse *response) &#123; NSURL *documentsDirectoryURL = [[NSFileManager defaultManager] URLForDirectory:NSDocumentDirectory inDomain:NSUserDomainMask appropriateForURL:nil create:NO error:nil]; return [documentsDirectoryURL URLByAppendingPathComponent:[response suggestedFilename]];&#125; completionHandler:^(NSURLResponse *response, NSURL *filePath, NSError *error) &#123; NSLog(@"File downloaded to: %@", filePath);&#125;];[downloadTask resume]; åˆ›å»ºä¸€ä¸ªä¸Šä¼ ä»»åŠ¡12345678910111213NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];NSURL *URL = [NSURL URLWithString:@"http://example.com/upload"];NSURLRequest *request = [NSURLRequest requestWithURL:URL];NSURL *filePath = [NSURL fileURLWithPath:@"file://path/to/image.png"];NSURLSessionUploadTask *uploadTask = [manager uploadTaskWithRequest:request fromFile:filePath progress:nil completionHandler:^(NSURLResponse *response, id responseObject, NSError *error) &#123; if (error) &#123; NSLog(@"Error: %@", error); &#125; else &#123; NSLog(@"Success: %@ %@", response, responseObject); &#125;&#125;];[uploadTask resume]; åˆ›å»ºä¸€ä¸ªå¤šè¡¨å•è¯·æ±‚çš„ä¸Šä¼ ä»»åŠ¡ï¼Œå¸¦è¿›åº¦æ¡1234567891011121314151617181920212223NSMutableURLRequest *request = [[AFHTTPRequestSerializer serializer] multipartFormRequestWithMethod:@"POST" URLString:@"http://example.com/upload" parameters:nil constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt; formData) &#123; [formData appendPartWithFileURL:[NSURL fileURLWithPath:@"file://path/to/image.jpg"] name:@"file" fileName:@"filename.jpg" mimeType:@"image/jpeg" error:nil]; &#125; error:nil];AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];NSURLSessionUploadTask *uploadTask;uploadTask = [manager uploadTaskWithStreamedRequest:request progress:^(NSProgress * _Nonnull uploadProgress) &#123; // This is not called back on the main queue. // You are responsible for dispatching to the main queue for UI updates dispatch_async(dispatch_get_main_queue(), ^&#123; //Update the progress view [progressView setProgress:uploadProgress.fractionCompleted]; &#125;); &#125; completionHandler:^(NSURLResponse * _Nonnull response, id _Nullable responseObject, NSError * _Nullable error) &#123; if (error) &#123; NSLog(@"Error: %@", error); &#125; else &#123; NSLog(@"%@ %@", response, responseObject); &#125; &#125;];[uploadTask resume]; åˆ›å»ºä¸€ä¸ªæ•°æ®ä»»åŠ¡123456789101112NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];NSURL *URL = [NSURL URLWithString:@"http://httpbin.org/get"];NSURLRequest *request = [NSURLRequest requestWithURL:URL];NSURLSessionDataTask *dataTask = [manager dataTaskWithRequest:request completionHandler:^(NSURLResponse *response, id responseObject, NSError *error) &#123; if (error) &#123; NSLog(@"Error: %@", error); &#125; else &#123; NSLog(@"%@ %@", response, responseObject); &#125;&#125;];[dataTask resume]; è¯·æ±‚åºåˆ—åŒ–è¯·æ±‚åºåˆ—åŒ–å™¨é€šè¿‡å°†å‚æ•°ç¼–ç ä¸ºå­—ç¬¦ä¸²æˆ–HTTPè¯·æ±‚ä½“ï¼Œç»“åˆURLå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªè¯·æ±‚ã€‚ å­—ç¬¦ä¸²æ ¼å¼çš„å‚æ•°ç¼–ç 1[[AFHTTPRequestSerializer serializer] requestWithMethod:@"GET" URLString:URLString parameters:parameters error:nil]; GET http://example.com?foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3 URLæ ¼å¼çš„å‚æ•°ç¼–ç 1[[AFHTTPRequestSerializer serializer] requestWithMethod:@"POST" URLString:URLString parameters:parameters error:nil]; POST http://example.com/Content-Type: application/x-www-form-urlencodedfoo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3 JSONæ ¼å¼çš„å‚æ•°ç¼–ç 1[[AFJSONRequestSerializer serializer] requestWithMethod:@"POST" URLString:URLString parameters:parameters error:nil]; POST http://example.com/Content-Type: application/json{â€œfooâ€: â€œbarâ€, â€œbazâ€: [1,2,3]} ç½‘ç»œå¯è¾¾æ€§ç®¡ç†AFNetworkReachabilityManagerç›‘æ§WWANå’ŒWiFiçš„ç½‘ç»œå¯è¾¾æ€§ã€‚ ä¸è¦ä½¿ç”¨Reachabilityå†³å®šæ˜¯å¦å‘é€åŸå§‹è¯·æ±‚ï¼› åº”è¯¥å°è¯•é‡å‘ã€‚ å¯ä»¥ä½¿ç”¨Reachabilityå†³å®šä¸€ä¸ªè¯·æ±‚åœ¨ä»€ä¹ˆæ—¶å€™è‡ªåŠ¨é‡å‘ï¼› è™½ç„¶å¯èƒ½è¯·æ±‚å¤±è´¥ï¼Œä½†ä¸€ä¸ªç½‘ç»œå¯è¾¾çš„Reachabilityé€šçŸ¥æ˜¯é‡æ–°è¯·æ±‚æŸäº›äº‹ç‰©çš„å¥½æ—¶å€™ã€‚ ç½‘ç»œå¯è¾¾ç®¡ç†å™¨æ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥ç¡®å®šä¸€ä¸ªè¯·æ±‚ä¸ºä»€ä¹ˆå¤±è´¥ã€‚ ä¸€ä¸ªç½‘ç»œè¯·æ±‚å¤±è´¥åï¼Œé€šçŸ¥ç”¨æˆ·â€œæ–­çº¿äº†â€ï¼Œæ¯”è¿”å›â€œè¯·æ±‚è¶…æ—¶â€è¿™ç§æ›´æŠ€æœ¯æ›´ç²¾ç¡®çš„é”™è¯¯è¦å¥½ã€‚ å‚è€ƒ WWDC 2012 session 706, â€œNetworking Best Practices.â€. å…±äº«çš„ç½‘ç»œå¯è¾¾æ€§ç®¡ç†å™¨1234[[AFNetworkReachabilityManager sharedManager] setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123; NSLog(@"Reachability: %@", AFStringFromNetworkReachabilityStatus(status));&#125;];[[AFNetworkReachabilityManager sharedManager] startMonitoring]; å®‰å…¨ç­–ç•¥åœ¨ä½ çš„APPé‡Œæ·»åŠ pinned X.509è¯ä¹¦ä¼šå¸®ä½ é¿å…äººä¸ºæ”»å‡»å’Œå…¶ä»–æ¼æ´æ‰«æã€‚å½“åº”ç”¨å¤„ç†æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®æˆ–é‡‘èä¿¡æ¯æ—¶ï¼Œéå¸¸éœ€è¦åœ¨å…·æœ‰SSLè¯ä¹¦çš„HTTPSè¿æ¥ä¸­æ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚ ####å…è®¸æ— æ•ˆSSLè¯ä¹¦ 12AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];manager.securityPolicy.allowInvalidCertificates = YES; // not recommended for production]]></content>
      <categories>
        <category>ç¬¬ä¸‰æ–¹åº“</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ Face++ å®ç°äººè„¸è¯†åˆ«]]></title>
    <url>%2F2016%2F11%2F30%2Fface-recognition-02%2F</url>
    <content type="text"><![CDATA[ä¸Šæ¬¡è®²äº†å¦‚ä½•ä½¿ç”¨Face++å®ç°äººè„¸æœç´¢ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥è°ˆè°ˆé¢éƒ¨è¯†åˆ«çš„å®ç°æ–¹æ³•ã€‚ æ•ˆæœå›¾ å°†Face++é›†æˆåˆ°é¡¹ç›®ä¸­è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒä½¿ç”¨ Face++å®ç°äººè„¸æœç´¢ç¬¬ä¸€éƒ¨åˆ†ã€‚ å¼€å§‹å·¥ä½œ1. å£°æ˜å±æ€§å˜é‡12@property (strong, nonatomic) UIImage personImg;//äººç‰©å›¾åƒ@property (weak, nonatomic) IBOutletUIImageView *imgView; 2. ä»æœ¬åœ°ç›¸å†Œé€‰å–å›¾ç‰‡123UIImagePickerController *picker = [[UIImagePickerController alloc] init]; picker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary; picker.delegate = self; [self presentViewController:picker animated:YES completion:nil]; 3. é€‰æ‹©å›¾ç‰‡åï¼Œè¿›è¡Œé¢éƒ¨è¯†åˆ«123456789101112131415161718-(void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary&lt;NSString *,id&gt; *)info&#123; _personImg = info[UIImagePickerControllerOriginalImage]; [_imgView updateH:_imgView.width / (_personImg.size.width / _personImg.size.height)];//æŒ‰åŸæ¯”ä¾‹æ›´æ–°è§†å›¾å®½é«˜ï¼Œç±»åˆ«æ–¹æ³•ï¼Œæ­¤å¤„å°±ä¸èµ˜è¿°äº† _imgView.image = _personImg; NSData *data = UIImageJPEGRepresentation(_personImg, 1); //è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œç”±äºè€—è´¹æ—¶é—´è¾ƒé•¿ï¼Œæœ€å¥½å¼‚æ­¥æ‰§è¡Œ dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123; FaceppResult *result = [[FaceppAPI detection] detectWithURL:nil orImageData:data mode:FaceppDetectionModeOneFace attribute:FaceppDetectionAttributeAll tag:nil async:NO others:nil]; //å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°UI dispatch_async(dispatch_get_main_queue(), ^&#123; [self didFinishDetection:result]; &#125;); &#125;); [picker dismissViewControllerAnimated:YES completion:^&#123; &#125;];&#125; resultè¿”å›å€¼è¯´æ˜ï¼ŒJSONç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&#123;"face": [ &#123;"attribute": &#123; "age": &#123;//åŒ…å«å¹´é¾„åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸ºä¸€ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºä¼°è®¡çš„å¹´é¾„, rangeè¡¨ç¤ºä¼°è®¡å¹´é¾„çš„æ­£è´ŸåŒºé—´ "range": 5, "value": 14 &#125;, "gender": &#123;//åŒ…å«æ€§åˆ«åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸ºMale/Female, confidenceè¡¨ç¤ºç½®ä¿¡åº¦ "confidence": 99.9981, "value": "Female" &#125;, "race": &#123;//åŒ…å«äººç§åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸ºAsian/White/Black, confidenceè¡¨ç¤ºç½®ä¿¡åº¦ "confidence": 99.818, "value": "Asian" &#125;, "smiling": &#123;//åŒ…å«å¾®ç¬‘ç¨‹åº¦åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸º0ï¼100çš„å®æ•°ï¼Œè¶Šå¤§è¡¨ç¤ºå¾®ç¬‘ç¨‹åº¦è¶Šé«˜ "value": 8.14031 &#125; &#125;, "face_id": "62bed8c94bbf92323675943328aed269", "position": &#123; "center": &#123;//æ£€å‡ºçš„äººè„¸æ¡†çš„ä¸­å¿ƒç‚¹åæ ‡, x &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°) "x": 49.731183, "y": 32.5 &#125;, "eye_left": &#123;//ç›¸åº”äººè„¸çš„å·¦çœ¼åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°) "x": 43.148441, "y": 28.722909 &#125;, "eye_right": &#123;//ç›¸åº”äººè„¸çš„å³çœ¼åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°) "x": 55.413441, "y": 27.745455 &#125;, "height": 21.363636, //0~100ä¹‹é—´çš„å®æ•°ï¼Œè¡¨ç¤ºæ£€å‡ºçš„è„¸çš„é«˜åº¦åœ¨å›¾ç‰‡ä¸­ç™¾åˆ†æ¯” "mouth_left": &#123;//ç›¸åº”äººè„¸çš„å·¦ä¾§å˜´è§’åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°) "x": 46.193978, "y": 39.472682 &#125;, "mouth_right": &#123;//ç›¸åº”äººè„¸çš„å³ä¾§å˜´è§’åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°) "x": 54.952688, "y": 38.989955 &#125;, "nose": &#123;//ç›¸åº”äººè„¸çš„é¼»å°–åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°) "x": 50.23414, "y": 34.953727 &#125;, "width": 25.268817 //0~100ä¹‹é—´çš„å®æ•°ï¼Œè¡¨ç¤ºæ£€å‡ºçš„è„¸çš„å®½åº¦åœ¨å›¾ç‰‡ä¸­ç™¾åˆ†æ¯” &#125;, "tag": "" &#125;], "img_height": 220, "img_id": "064aae142ef977bb44b6cc3dd9a6eeb1", "img_width": 186, "session_id": "ade961e7b0d347ca943e0f0f752f7cc5", "url": null&#125; 4. å¯¹æ£€æµ‹ç»“æœè¿›è¡Œå¤„ç†123456- (void)didFinishDetection:(FaceppResult *)result&#123; NSDictionary *face = [result content][@"face"][0]; [self markTheFiveSenseOrgansWithData:face]; [self markFaceWithData:face]; [self analysisPersonWithData:face];&#125; 1) æ ‡è®°è„¸éƒ¨èŒƒå›´ 1234567891011121314151617- (void)markFaceWithData:(NSDictionary *)face&#123; CGFloat img_width = _imgView.frame.size.width; CGFloat img_height = _imgView.frame.size.height; CGFloat center_x = [face[@"position"][@"center"][@"x"] floatValue] / 100.f * img_width;//è„¸éƒ¨ä¸­å¿ƒç‚¹xåæ ‡ CGFloat center_y = [face[@"position"][@"center"][@"y"] floatValue] / 100.f * img_height;//è„¸éƒ¨ä¸­å¿ƒç‚¹yåæ ‡ CGFloat width = [face[@"position"][@"width"] floatValue] / 100.f * img_width;//è„¸éƒ¨å®½åº¦ CGFloat height = [face[@"position"][@"height"] floatValue] / 100.f * img_height;//è„¸éƒ¨é«˜åº¦ CGPoint center = CGPointMake(center_x, center_y); CGRect rect = CGRectMake(0, 0, width, height); //è‡ªå®šä¹‰ä¸€ä¸ªCALayer,ç”»ä¸€ä¸ªçŸ©å½¢ RectLayer *rectLayer = [RectLayer layer]; rectLayer.bounds = rect; rectLayer.position = center; [rectLayer setNeedsDisplayInRect:rect]; [self.imgView.layer addSublayer:rectLayer]; //è‡ªå®šä¹‰ä¸€ä¸ªCALayer,ç”»ä¸€ä¸ªçŸ©å½¢ [rectLayer twinkleAnimation:3];&#125; 2) æ ‡è®°äº”å®˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243- (void)markTheFiveSenseOrgansWithData:(NSDictionary *)face&#123; CGFloat img_width = _imgView.frame.size.width; CGFloat img_height = _imgView.frame.size.height; CGFloat eye_left_x = [face[@"position"][@"eye_left"][@"x"] floatValue] / 100.f * img_width; CGFloat eye_left_y = [face[@"position"][@"eye_left"][@"y"] floatValue] / 100.f * img_height; CGFloat eye_right_x = [face[@"position"][@"eye_right"][@"x"] floatValue] / 100.f * img_width; CGFloat eye_right_y = [face[@"position"][@"eye_right"][@"y"] floatValue] / 100.f * img_height; CGFloat mouth_left_x = [face[@"position"][@"mouth_left"][@"x"] floatValue] / 100.f * img_width; CGFloat mouth_left_y = [face[@"position"][@"mouth_left"][@"y"] floatValue] / 100.f * img_height; CGFloat mouth_right_x = [face[@"position"][@"mouth_right"][@"x"] floatValue] / 100.f * img_width; CGFloat mouth_right_y = [face[@"position"][@"mouth_right"][@"y"] floatValue] / 100.f * img_height; CGFloat nose_x = [face[@"position"][@"nose"][@"x"] floatValue] / 100.f * img_width; CGFloat nose_y = [face[@"position"][@"nose"][@"y"] floatValue] / 100.f * img_height; //æ ‡æ³¨å·¦çœ¼ CALayer *leftEyeLayer = [CALayer layer]; leftEyeLayer.frame = CGRectMake(eye_left_x, eye_left_y, 2, 2); leftEyeLayer.backgroundColor = [UIColor greenColor].CGColor; [leftEyeLayer setNeedsDisplay]; [self.imgView.layer addSublayer:leftEyeLayer]; //æ ‡æ³¨å³çœ¼ CALayer *rightEyeLayer = [CALayer layer]; rightEyeLayer.frame = CGRectMake(eye_right_x, eye_right_y, 2, 2); rightEyeLayer.backgroundColor = [UIColor greenColor].CGColor; [rightEyeLayer setNeedsDisplay]; [self.imgView.layer addSublayer:rightEyeLayer]; [leftEyeLayer twinkleAnimation:3]; [rightEyeLayer twinkleAnimation:3]; //æ ‡æ³¨é¼»å­ RoundLayer *noseLayer = [RoundLayer layer]; noseLayer.bounds = CGRectMake(0, 0, 20, 20); noseLayer.position = CGPointMake(nose_x, nose_y); [noseLayer setNeedsDisplay]; [self.imgView.layer addSublayer:noseLayer]; [noseLayer twinkleAnimation:3]; //æ ‡æ³¨å˜´å·´ RectLayer *mouthLayer = [RectLayer layer]; mouthLayer.frame = CGRectMake(mouth_left_x, mouth_left_y, mouth_right_x - mouth_left_x, mouth_right_y - mouth_left_y); [mouthLayer setNeedsDisplay]; [self.imgView.layer addSublayer:mouthLayer]; [mouthLayer twinkleAnimation:3];&#125; 3) åˆ†æäººç‰©ç‰¹å¾ 123456789101112131415161718192021- (void)analysisPersonWithData:(NSDictionary *)face&#123; CGFloat smiling = [face[@"attribute"][@"smiling"][@"value"] floatValue];//ç¬‘å®¹ NSInteger age_value = [face[@"attribute"][@"age"][@"value"] integerValue];//å¹´é¾„ NSInteger age_range = [face[@"attribute"][@"age"][@"range"] integerValue];//å¹´é¾„è¯¯å·® NSString *gender = face[@"attribute"][@"gender"][@"value"];//æ€§åˆ« NSString *race = face[@"attribute"][@"race"][@"value"];//ç§æ— NSArray *texts = @[[NSString stringWithFormat:@"å¼€å¿ƒåº¦ï¼š%@", @(smiling).stringValue], [NSString stringWithFormat:@"å¹´é¾„ï¼š%ld - %ld",age_value - age_range, age_value + age_range], [NSString stringWithFormat:@"æ€§åˆ«ï¼š%@", gender], [NSString stringWithFormat:@"ç§æ—ï¼š%@", race]]; CGFloat width = self.view.width - 40; CGFloat height = 20; CGFloat x = 20; CGFloat margin = 10; for (int i = 0; i &lt; 4; i++) &#123; CGFloat y = _imgView.height + _imgView.y + height * i + margin * (i + 1); UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(x, y, width, height)]; label.text = texts[i]; [self.view addSubview:label]; &#125;&#125; 5. è‡ªå®šä¹‰layer1ï¼‰RectLayeré‡å†™drawInContextæ–¹æ³• 12345678910-(void)drawInContext:(CGContextRef)ctx&#123; //1.ç»˜åˆ¶å›¾å½¢ //ç”»ä¸€ä¸ªçŸ©å½¢ CGContextAddRect(ctx, self.bounds); //è®¾ç½®å±æ€§ï¼ˆé¢œè‰²ï¼‰ CGContextSetLineWidth(ctx, 2); CGContextSetRGBStrokeColor(ctx, 0, 1, 0, 1); //2.æ¸²æŸ“ CGContextStrokePath(ctx);&#125; 2ï¼‰RoundLayeré‡å†™drawInContextæ–¹æ³• 123456-(void)drawInContext:(CGContextRef)ctx&#123; CGContextAddEllipseInRect(ctx, self.bounds); CGContextSetLineWidth(ctx, 2); CGContextSetRGBStrokeColor(ctx, 0, 1, 0, 1); CGContextStrokePath(ctx);&#125; 6. åˆ›å»ºCALayerç±»åˆ«ï¼Œç®¡ç†layeråŠ¨ç”»12345678910111213141516#import "CALayer+Animation.h"@implementation CALayer (Animation)- (void)twinkleAnimation:(float)time&#123; CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@"opacity"]; animation.fromValue = @[@1.0f]; animation.toValue = @[@0.0f]; animation.autoreverses = YES; animation.duration = time * 0.1; animation.repeatCount = time - 1; animation.removedOnCompletion = NO; animation.fillMode = kCAFillModeForwards; [self addAnimation:animation forKey:nil];&#125;@end]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>äººè„¸è¯†åˆ«</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨ Face++ å®ç°äººè„¸æœç´¢]]></title>
    <url>%2F2016%2F11%2F22%2Fface-recognition-01%2F</url>
    <content type="text"><![CDATA[Face++ç”±ä¸‰ä½85åçš„æ¸…åå¸ˆå…„å¼Ÿäº2011å¹´åˆ›å»ºï¼Œå…ˆåè·å¾—è”æƒ³ä¹‹æ˜Ÿçš„å¤©ä½¿æŠ•èµ„å’Œåˆ›æ–°å·¥åœºçš„Aè½®æŠ•èµ„ã€‚2013å¹´åº•å¼€å§‹ï¼Œå…ˆååœ¨ä¸–ç•Œæœ€æƒå¨çš„äººè„¸æ£€æµ‹(FDDBè¯„æµ‹)ã€äººè„¸å…³é”®ç‚¹å®šä½ï¼ˆ300-Wè¯„æµ‹ï¼‰ï¼Œå’Œäººè„¸è¯†åˆ«(LFWè¯„æµ‹)è·å¾—ä¸‰ä¸ªä¸–ç•Œç¬¬ä¸€ã€‚è¿™æ„å‘³ç€åœ¨äººè„¸æŠ€æœ¯ä¸‰ä¸ªæœ€æ ¸å¿ƒçš„æŠ€æœ¯æ¨¡å—ï¼ŒFace++éƒ½è¾¾åˆ°äº†ä¸–ç•Œæœ€é«˜æ°´å¹³ã€‚åŒæ—¶Face++æ‰€æä¾›çš„æŠ€æœ¯äº‘å¹³å°(Face++ æœ€å¥½çš„å…è´¹äººè„¸è¯†åˆ«äº‘æœåŠ¡)ä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„äººè„¸æŠ€æœ¯å¹³å°ï¼Œç´¯è®¡å¤„ç†å›¾ç‰‡æ€»æ•°æ¥è¿‘10äº¿è§„æ¨¡ï¼Œå¹¶ä¸ºé˜¿é‡Œï¼Œè”æƒ³ï¼Œ360ï¼Œä¸–çºªä½³ç¼˜ï¼Œç¾å›¾ç§€ç§€ï¼Œcamera360ç­‰ä¸€æ‰¹å›½å†…å¤–è‘—åäº’è”ç½‘ä¼ä¸šæä¾›äº†æŠ€æœ¯æœåŠ¡ã€‚ åœ¨ä»Šå¹´6æœˆä»½çš„WWDCä¸»é¢˜æ¼”è®²å¤§ä¼šä¸Šï¼Œè‹¹æœä»‹ç»äº†ä¸€é¡¹å…¨æ–°çš„äººè„¸è¯†åˆ«åŠŸèƒ½ã€‚è¿™é¡¹åŠŸèƒ½è¢«æ·»åŠ åœ¨ iOS 10 çš„ç…§ç‰‡åº”ç”¨å½“ä¸­ï¼Œä¼šæ ¹æ®é¢éƒ¨è¡¨æƒ…å¯¹ç…§ç‰‡è¿›è¡Œåˆ†ç±»ã€‚è‹¹æœè½¯ä»¶å·¥ç¨‹é«˜çº§å‰¯æ€»è£å…‹é›·æ ¼Â·è´¹å¾·é‡Œå¥‡åœ¨æ¼”è®²ä¸­è¡¨ç¤ºï¼Œâ€œå…ˆè¿›è®¡ç®—æœºè§†è§‰â€ï¼ˆAdvanced Computer Visionï¼‰æ˜¯ä»Šå¹´ç…§ç‰‡åº”ç”¨æœ€å¤§å¹…åº¦çš„ä¸€æ¬¡æ›´æ–°ï¼Œå› ä¸ºè‹¹æœé€šè¿‡æ·±åº¦å­¦ä¹ æŠ€æœ¯å°†äººè„¸è¯†åˆ«å¸¦åˆ°äº† iPhone èº«ä¸Šã€‚ æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é€šè¿‡Face++æ¥å®ç°äººè„¸æœç´¢ã€‚ å‡†å¤‡å·¥ä½œ1. è¯·åˆ°GitHubä¸Šä¸‹è½½SDKï¼šfacepp-ios-sdk 2. è§£å‹åå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç›®å½•ï¼šFaceppSDKå’ŒFaceppSDK_ARCã€‚é¡¾åæ€ä¹‰ï¼ŒFaceppSDK_ARCæ˜¯åœ¨ARCç¯å¢ƒä¸‹ä½¿ç”¨çš„ï¼ŒFaceppSDKæ˜¯åœ¨MRCç¯å¢ƒä¸‹ä½¿ç”¨çš„ï¼Œæœ¬æ–‡ç€é‡ä»‹ç»ARCç¯å¢ƒçš„å®ç°æ–¹æ³•ã€‚ 3. åœ¨Finderä¸­ï¼Œå°†FaceppSDK_ARCç›®å½•æ‹–å…¥å·¥ç¨‹ç›®å½•ä¸‹ï¼Œå°†FaceppSDK_ARCæ·»åŠ è‡³æ‚¨çš„å·¥ç¨‹ä¸­; 4. åœ¨åº”ç”¨ç¨‹åºå…¥å£å¤„æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 1#import "FaceppAPI.h"` åœ¨å…¥å£ä»£ç ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç : 12345#import "FaceppAPI.h"- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; [FaceppAPI initWithApiKey: @"YOUR_KEY" andApiSecret: @"YOUR_SECRET"]; ...&#125; 5. ä½¿ç”¨è°ƒè¯•æ¨¡å¼ï¼š å¼€å¯è°ƒè¯•æ¨¡å¼ä¹‹åï¼Œç¨‹åºå°†å‘æ§åˆ¶å°è¾“å‡ºæ‰€æœ‰httpè¯·æ±‚çš„urlï¼Œä»¥åŠè¿”å›jsonçš„åŸå§‹æ•°æ®ï¼Œä»¥ä¾›è°ƒè¯•ä½¿ç”¨ã€‚ 1[FaceppAPI setDebugMode: TRUE]; ###å¼€å§‹å·¥ä½œ 1. ä½¿ç”¨/detection/detectæ¥å£æ¥å¯¹å›¾ç‰‡è¿›è¡Œæ£€æµ‹ï¼Œåœ¨è·å¾—æ•°æ®ä»¥åå…¶å°†è¿”å›ä¸€ä¸ªFaceppResultç»“æ„ 12FaceppResult *result = [[FaceppAPI detection] detectWithURL:nil imageData:[NSData dataWithContentsOfFile:@"LOCAL_FILE_PATH"]]; 2. ä»FaceppResultä¸­è·å–ç»“æœ è·å¾—ç¬¬ä¸€å¼ è„¸çš„face_idï¼š 1NSString *face_id = [result content][@"face"][0][@"face_id"]; 3. å¯¹æ‰€æœ‰å›¾ç‰‡æ‰§è¡Œ1~2æ­¥åï¼ŒæŠŠæ¯ä¸ªå›¾ç‰‡å¯¹åº”çš„face_idå­˜å…¥æ•°ç»„ï¼Œç„¶åä½¿ç”¨/faceset/createæ¥å£æ¥åˆ›å»ºfaceset 12FaceppResult *setResult = [[FaceppAPI faceset] createWithFacesetName:nil andFaceId:_facesIds andTag:@"1"];NSString *faceset_id = [setResult content][@"faceset_id"]; 4. é’ˆå¯¹searchåŠŸèƒ½å¯¹ä¸€ä¸ªfacesetè¿›è¡Œè®­ç»ƒ 1[[FaceppAPI train] trainAsynchronouslyWithId:_faceset_id orName:nil andType:FaceppTrainSearch]; åœ¨ä¸€ä¸ªfacesetå†…è¿›è¡Œsearchä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯¹è¯¥facesetè¿›è¡ŒTrainã€‚ 5. trainæˆåŠŸåï¼Œé’ˆå¯¹æŸå¼ å›¾ç‰‡çš„face_idè¿›è¡Œæœç´¢ 1FaceppResult *searchResult = [[FaceppAPI recognition] searchWithKeyFaceId:face_id andFacesetId:_faceset_id orFacesetName:nil]; æœç´¢åˆ°çš„ç›¸ä¼¼å›¾ç‰‡çš„face_idéƒ½å­˜å‚¨åœ¨[searchResult content][@&quot;candidate&quot;]é‡Œï¼Œä»¥ä¸‹ä¸ºè¿è¡Œç»“æœï¼š 123456789101112131415161718192021 [FacePlusPlus]response JSON: &#123; "candidate": [ &#123; "face_id": "589bb6f9c7cd98a45c662a93f4607316", "similarity": 99.9909, "tag": "" &#125;, &#123; "face_id": "4aa39ac1c989ff1e597dafa8979446be", "similarity": 75.3242, "tag": "" &#125;, &#123; "face_id": "6ae11866cf062abb1908087b7467a03a", "similarity": 59.9056, "tag": "" &#125; ], "session_id": "e37308bb0e354c75b87fdf1de9b7e5c7"&#125;]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>äººè„¸è¯†åˆ«</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vImageå­¦ä¹ ç¬”è®°â€”â€”å·ç§¯ï¼ˆConvolutionï¼‰]]></title>
    <url>%2F2016%2F08%2F31%2FvImage-translation-02%2F</url>
    <content type="text"><![CDATA[å·ç§¯ï¼ˆConvolutionï¼‰æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œå¯ä»¥æ”¹å˜åƒç´ å¼ºåº¦ï¼Œä»è€Œå½±å“å‘¨å›´å…¶ä»–åƒç´ çš„å¼ºåº¦ã€‚å·ç§¯çš„å¸¸ç”¨æŠ€æœ¯æ˜¯åˆ›å»ºæ»¤é•œï¼Œä½¿ç”¨å·ç§¯æŠ€æœ¯ï¼Œä½ å¯ä»¥è·å–ä¸€äº›æµè¡Œçš„å›¾åƒæ•ˆæœï¼Œæ¯”å¦‚æ¨¡ç³Šï¼ˆblurï¼‰ã€é”åŒ–ï¼ˆsharpenï¼‰åŠè¾¹ç¼˜æ£€æµ‹ï¼ˆedge detectionï¼‰ï¼Œè¿™äº›æ•ˆæœåœ¨Photo Boothã€iPhotoå’ŒApertureéƒ½æœ‰å¹¿æ³›ä½¿ç”¨ã€‚ å¦‚æœä½ å¯¹å›¾åƒæ»¤é•œå’Œå®æ—¶å¤„ç†æœ‰å…´è¶£çš„è¯ï¼Œä½ ä¼šå‘ç°vImageå‡½æ•°é›†çš„å¥½å¤„ã€‚ç”¨å›¾åƒæ»¤é•œï¼Œå·ç§¯æ“ä½œå¯ä»¥å®Œæˆä¸€äº›å¸¸ç”¨çš„æ»¤é•œæ•ˆæœï¼Œæ¯”å¦‚æµ®é›•ã€æ¨¡ç³ŠåŠè‰²è°ƒåˆ†ç¦»ã€‚ vImageå·ç§¯æŠ€æœ¯å¯¹é”åŒ–æˆ–å¢å¼ºå›¾åƒè´¨é‡ä¹Ÿå¾ˆæœ‰ç”¨ã€‚å½“å¤„ç†ä¸€äº›ç§‘å­¦å›¾åƒæ—¶ï¼Œå¢å¼ºå›¾åƒè´¨é‡å¾ˆæœ‰ç”¨ã€‚æ­¤å¤–ï¼Œç”±äºç§‘å­¦å›¾åƒé€šå¸¸éƒ½å¾ˆå¤§ï¼Œå°±å¾ˆæœ‰å¿…è¦ä½¿ç”¨è¿™äº›vImageæŠ€æœ¯æ¥è¾¾åˆ°åˆé€‚çš„æ€§èƒ½éœ€æ±‚ã€‚è¿™ç§æƒ…å†µä¸‹ä½ éœ€è¦ç”¨åˆ°çš„æŠ€æœ¯æœ‰è¾¹ç¼˜æ£€æµ‹ï¼ˆedge detectionï¼‰ã€é”åŒ–ã€æç»˜å¤–è§‚è½®å»“ï¼ˆsurface contour outliningï¼‰ã€å¹³æ»‘ã€åŠåŠ¨ä½œæ£€æµ‹ï¼ˆmotion detectionï¼‰ã€‚ æœ¬ç« èŠ‚è®²è¿°äº†å·ç§¯æŠ€æœ¯ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨vImageæä¾›çš„å·ç§¯å‡½æ•°ã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥ï¼š äº†è§£å·ç§¯æŠ€æœ¯å¯ä»¥å®ç°å“ªäº›æ•ˆæœï¼› å­¦ä¹ ä»€ä¹ˆæ˜¯å·ç§¯æ ¸ä»¥åŠå¦‚ä½•æ„å»ºå·ç§¯æ ¸ï¼› é€šè¿‡ä»£ç ç¤ºä¾‹ï¼Œå­¦ä¹ å¦‚ä½•å¯¹ä¸€ä¸ªå›¾åƒä½¿ç”¨å·ç§¯æŠ€æœ¯ã€‚ å·ç§¯æ ¸ï¼ˆConvolution Kernelsï¼‰å›¾1å±•ç¤ºäº†ä¸€ä¸ªå›¾åƒé€šè¿‡vImageå·ç§¯å‡½æ•°æ·»åŠ äº†æµ®é›•æ•ˆæœå‰åçš„å¯¹æ¯”å›¾ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼ŒvImageä½¿ç”¨ä¸€ä¸ªç±»ç½‘æ ¼çš„æ•°å­¦æ¦‚å¿µï¼Œç§°ä¸ºæ ¸ï¼ˆkernelï¼‰ï¼Œæ¥å®Œæˆå·ç§¯æ“ä½œã€‚ å›¾1 æµ®é›• å›¾2æ˜¯ä¸€ä¸ª3Ã—3çš„kernelã€‚kernelçš„é«˜åº¦å’Œå®½åº¦ä¸å¿…ä¸€æ ·ï¼Œä½†å¿…é¡»æ˜¯å¥‡æ•°ã€‚kernelå†…éƒ¨çš„æ•°å€¼ä¼šå½±å“å·ç§¯çš„æ•´ä½“æ•ˆæœã€‚è¿™äº›æ•°å€¼å†³å®šäº†åˆå§‹å›¾åƒåƒç´ ä¼šå¦‚ä½•è½¬æ¢æˆç›®æ ‡å›¾åƒåƒç´ ï¼Œè¿™çœ‹èµ·æ¥å¯èƒ½ä¸æ˜¯å¾ˆç›´è§‚ï¼Œ9ä¸ªæ•°å­—ä¼šå¦‚ä½•å½±å“åˆ°æ»¤é•œæ•ˆæœå‘¢ï¼Ÿå·ç§¯æŠ€æœ¯ç»è¿‡ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ ¹æ®å‘¨å›´åƒç´ çš„å¼ºåº¦æ”¹å˜å½“å‰åƒç´ çš„å¼ºåº¦ã€‚vImageæ ¹æ®kernelæ‰§è¡Œå·ç§¯æ“ä½œï¼Œè¿™ç§é€šè¿‡kernelæ‰§è¡Œå·ç§¯è®¡ç®—çš„è¿‡ç¨‹å°±ç§°ä¸ºkernel convolutionï¼ˆæ ¸å·ç§¯ï¼‰ã€‚ å›¾2 3Ã—3å·ç§¯ å·ç§¯æ˜¯åƒç´ å•ä½çš„æ“ä½œï¼Œå³å¯¹æ¯ä¸ªåƒç´ éƒ½è¦æ‰§è¡ŒåŒæ ·çš„ç®—æ³•ã€‚å› æ­¤ï¼Œå¤§å›¾åƒæ¯”å°å›¾åƒéœ€è¦æ›´å¤šçš„å·ç§¯æ“ä½œã€‚ä¸€ä¸ªkernelå¯ä»¥è¢«çœ‹åšä¸€ä¸ªäºŒç»´çš„ç½‘æ ¼æ•°æ®ï¼Œè€Œå›¾åƒä¹Ÿå¯ä»¥è¢«çœ‹åšä¸€ä¸ªäºŒç»´ç½‘æ ¼æ•°æ®ï¼ˆå¦‚å›¾3ï¼‰ï¼Œå¯¹ä¸€ä¸ªå›¾åƒåº”ç”¨kernelå¯ä»¥æƒ³è±¡æˆæŠŠä¸€ä¸ªå°æ ¼å­ï¼ˆkernelï¼‰å¹³é“ºåœ¨å¤§æ ¼å­ï¼ˆå›¾åƒï¼‰ä¸Šã€‚ å›¾3 å›¾åƒæ˜¯äºŒç»´ç½‘æ ¼æ•°æ® kernelå†…éƒ¨çš„æ•°å€¼ä¼šä½œä¸ºä¸å®ƒä¸‹é¢çš„æ•°å€¼ç›¸ä¹˜çš„ä¹˜æ•°ï¼Œä¸‹é¢çš„æ•°å€¼æŒ‡çš„æ˜¯è¢«kernelæ•°å€¼è¦†ç›–çš„åƒç´ çš„å¼ºåº¦ã€‚åœ¨è¿›è¡Œå·ç§¯è®¡ç®—æ—¶ï¼ŒæŠŠkernelçš„ä¸­å¿ƒå€¼è¦†ç›–åœ¨å¾…è½¬æ¢çš„åƒç´ ä¸Šï¼Œç„¶åå°†kernelçš„æ¯ä¸ªå€¼ä¸å…¶æ­£ä¸‹æ–¹çš„åƒç´ å€¼ç›¸ä¹˜ï¼Œæœ€åå°†æ‰€æœ‰çš„ç»“æœç›¸åŠ ï¼Œç›¸åŠ åçš„ç»“æœå°±æ˜¯æ–°çš„åƒç´ å¼ºåº¦ã€‚å›¾4å±•ç¤ºäº†kernelæ˜¯å¦‚ä½•è½¬åŒ–åƒç´ çš„ã€‚ å›¾4 æ ¸å·ç§¯ è™½ç„¶kernelä¼šè¦†ç›–åˆ°ä¸€äº›å…¶å®ƒçš„åƒç´ ï¼Œä½†æ˜¯æœ€ç»ˆåªæœ‰kernelä¸­å¿ƒå€¼æ­£ä¸‹æ–¹çš„åŸå§‹åƒç´ ä¼šå‘ç”Ÿå˜åŒ–ã€‚kernelå’Œå›¾åƒä¹‹é—´æ‰€æœ‰ä¹˜ç§¯ç›¸åŠ åçš„å’Œè¢«ç§°ä¸ºåŠ æƒå’Œã€‚ä¸ºäº†ç¡®ä¿å¤„ç†åçš„å›¾åƒå¯¹æ¯”åŸå›¾ä¸ä¼šè¿‡äºé¥±å’Œï¼ŒvImageæœ‰ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œå°±æ˜¯è®¾ç½®ä¸€ä¸ªé™¤æ•°å› å­ï¼ŒæŠŠåŠ æƒå’Œè¿›è¡Œæ‹†åˆ†ã€‚å› ä¸ºç”¨å‘¨å›´åƒç´ çš„åŠ æƒå’Œæ¥ä»£æ›¿åŸå§‹åƒç´ æ—¶å¸¸å¯¼è‡´åƒç´ å¼ºåº¦è¿‡å¤§ï¼ˆå¹¶ä¸”å›¾åƒæ•´ä½“ä¹Ÿè¿‡äºæ˜äº®ï¼‰ï¼Œæ‹†åˆ†åŠ æƒå’Œå¯ä»¥æŒ‰æ¯”ä¾‹é™ä½æ»¤é•œæ•ˆæœçš„å¼ºåº¦ï¼Œå¹¶ç¡®ä¿ç»´æŒåŸå§‹äº®åº¦ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ ‡å‡†åŒ–ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯å¯é€‰çš„ï¼Œè¢«æ‹†åˆ†åçš„åŠ æƒå’Œä¼šä»£æ›¿åŸå§‹åƒç´ å€¼ã€‚kernelå¯¹æ¯ä¸ªåƒç´ é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ æ³¨ï¼šå¦‚æœè¦æ‰§è¡Œæ ‡å‡†åŒ–ï¼Œä½ å¿…é¡»å‘å·ç§¯å‡½æ•°æä¾›ä½ è¦ä½¿ç”¨çš„å› å­ã€‚å› å­æœ€å¥½æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å›¾åƒåƒç´ å€¼ä¸ºæ•´æ•°çš„æ—¶å€™å†æä¾›å› å­ã€‚æµ®ç‚¹å‹ä¸éœ€è¦ä½¿ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥ç›´æ¥ä¾æ¯”ä¾‹å†³å®škernelçš„æµ®ç‚¹å‹æ•°å€¼æ¥è¾¾åˆ°æ ‡å‡†åŒ–ã€‚ kernelçš„æ•°æ®ç±»å‹å’Œå›¾åƒçš„æ•°æ®ç±»å‹å¿…é¡»ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚ï¼Œå¦‚æœå›¾åƒåƒç´ æ•°æ®ç±»å‹æ˜¯æµ®ç‚¹å‹ï¼Œé‚£ä¹ˆkernelä¸­çš„æ•°æ®ç±»å‹ä¹Ÿå¿…é¡»æ˜¯æµ®ç‚¹å‹ã€‚ è®°ä½ä»¥ä¸Šæ‰€è¿°çš„ç®—æ³•vImageéƒ½å·²ç»å¸®ä½ åšå¥½äº†ï¼Œä½ ä¸éœ€è¦ç‰¢è®°å·ç§¯ç®—æ³•çš„æ­¥éª¤ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è‡ªå®šä¹‰çš„æ ¸ä¸­å®ç°è¯¥ç®—æ³•ã€‚ åå·ç§¯åå·ç§¯æŒ‡çš„æ˜¯è§£é™¤å…ˆå‰çš„å·ç§¯æ•ˆæœâ€”â€”ä¸€èˆ¬æ˜¯åŸå§‹å›¾åƒä¸­ç‰©ç†æºå¸¦çš„å·ç§¯æ•ˆæœï¼Œæ¯”å¦‚é•œå¤´ä¸­çš„è¡å°„æ•ˆæœã€‚é€šå¸¸ï¼Œåå·ç§¯æ˜¯ä¸€ä¸ªé”åŒ–æ“ä½œã€‚ åå·ç§¯çš„ç®—æ³•æ¯”è¾ƒå¤šï¼ŒvImageç”¨çš„æ˜¯Richardson-Lucy deconvolutionç®—æ³•ã€‚ Richardson-Lucy deconvolutionç®—æ³•çš„ç›®æ ‡æ˜¯æ ¹æ®å·ç§¯åçš„åƒç´ å€¼æ‰¾åˆ°åŸå§‹çš„åƒç´ å€¼ï¼Œä»¥åŠkernelæ•°æ®ã€‚ åŸºäºä»¥ä¸Šéœ€æ±‚ï¼Œåœ¨ä½¿ç”¨åå·ç§¯å‡½æ•°æ—¶å¿…é¡»æä¾›å·ç§¯åçš„å›¾åƒåŠå·ç§¯ä½¿ç”¨çš„kernelå€¼ã€‚ vImageä¼šè‡ªè¡Œå¤„ç†åå·ç§¯çš„æ¯ä¸€æ­¥æ“ä½œï¼Œå› æ­¤ä¸éœ€è¦ç‰¢è®°è¿™äº›æ­¥éª¤ã€‚ä½¿ç”¨åå·ç§¯çš„æ—¶å€™ï¼Œå¿…é¡»æä¾›åˆå§‹çš„å·ç§¯kernelï¼ˆå¦‚æœè¯¥kernelä¸å¯¹ç§°çš„è¯ï¼Œè¿˜è¦é¢å¤–æä¾›ä¸€ä¸ªå¯¹è§’çº¿ç¿»è½¬çš„kernel2ï¼‰ã€‚ ä½¿ç”¨å·ç§¯æ ¸ç°åœ¨ä½ æœ€å¥½äº†è§£ä¸€ä¸‹æ ¸çš„ç»“æ„ä»¥åŠå·ç§¯çš„å¤„ç†è¿‡ç¨‹ï¼Œæ˜¯æ—¶å€™ä½¿ç”¨å‡ ä¸ªvImageå‡½æ•°æ¥çœ‹çœ‹äº†ã€‚æœ¬ç« èŠ‚å±•ç¤ºäº†å¦‚ä½•å®ç°å›¾1ä¸­çš„æµ®é›•æ•ˆæœï¼Œå¹¶è§£é‡Šäº†æ— åå·®å·ç§¯å’Œå¸¦åå·®å·ç§¯ä¹‹é—´çš„å·®åˆ«ã€‚ å·ç§¯vImageå¯ä»¥è‡ªåŠ¨è¿›è¡Œå·ç§¯è®¡ç®—ï¼Œè€Œä½ çš„å·¥ä½œæ˜¯æä¾›kernelï¼Œå³æè¿°å·ç§¯åº”è¯¥ç”Ÿæˆä»€ä¹ˆæ•ˆæœã€‚è¡¨1å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å·ç§¯å»ç”Ÿæˆæµ®é›•æ•ˆæœã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡åˆé€‚çš„kernelï¼Œåˆ©ç”¨åŒæ ·çš„ä»£ç æ¥ç”Ÿæˆä¸€ä¸ªä¸åŒçš„æ•ˆæœï¼Œæ¯”å¦‚é”åŒ–ã€‚ è¡¨1 ç”Ÿæˆæµ®é›•æ•ˆæœ 123456789101112131415161718192021222324252627282930313233343536int myEmboss(void *inData, unsigned int inRowBytes, void *outData, unsigned int outRowBytes, unsigned int height, unsigned int width, void *kernel, unsigned int kernel_height, unsigned int kernel_width, int divisor , vImage_Flags flags )&#123; uint_8 kernel = &#123;-2, -2, 0, -2, 6, 0, 0, 0, 0&#125;; // 1 vImage_Buffer src = &#123; inData, height, width, inRowBytes &#125;; // 2 vImage_Buffer dest = &#123; outData, height, width, outRowBytes &#125;; // 3 unsigned char bgColor[4] = &#123; 0, 0, 0, 0 &#125;; // 4 vImage_Error err; // 5 err = vImageConvolve_ARGB8888( &amp;src, //const vImage_Buffer *src &amp;dest, //const vImage_Buffer *dest, NULL, 0, //unsigned int srcOffsetToROI_X, 0, //unsigned int srcOffsetToROI_Y, kernel, //const signed int *kernel, kernel_height, //unsigned int kernel_width, //unsigned int divisor, //int bgColor, flags | kvImageBackgroundColorFill //vImage_Flags flags ); return err;&#125; ä¸Šè¿°ä»£ç éƒ½åšäº†å“ªäº›å·¥ä½œå‘¢ï¼Ÿ å£°æ˜ä¸€ä¸ªæµ®é›•kernelï¼Œå³intå‹æ•°ç»„ã€‚kernelçš„æ•°æ®ç±»å‹è¦ä¸ç›¸åº”çš„vImageå‡½æ•°æ‰€éœ€æ•°æ®ç±»å‹ç›¸åŒ¹é…ã€‚ç¤ºä¾‹ä¸­ä½¿ç”¨äº†vImageConvolve_ARGB8888å‡½æ•°ï¼Œå› æ­¤kernelçš„æ•°æ®ç±»å‹åº”è¯¥æ˜¯uint_8ï¼ˆæ— ç¬¦å·ï¼Œ8-bitï¼Œæ•´æ•°ï¼‰ã€‚kernelçš„æ•°ç»„å…ƒç´ ä»å·¦è‡³å³ï¼Œä¾æ¬¡æ˜¯ç¬¬ä¸€è¡Œã€ç¬¬äºŒè¡Œã€ç¬¬ä¸‰è¡Œï¼› å£°æ˜ä¸€ä¸ªvImage_Bufferå˜é‡ï¼Œç”¨æ¥å­˜å‚¨åŸå§‹å›¾åƒä¿¡æ¯ã€‚å›¾åƒæ•°æ®ä»¥æ•°ç»„çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œå…ƒç´ å›¾åƒäºŒè¿›åˆ¶æ•°æ®(inData)ï¼Œå¦å¤–è¿˜å­˜å‚¨é«˜åº¦ã€å®½åº¦å’Œæ¯è¡Œçš„å­—èŠ‚æ•°ã€‚è¿™æ ·vImageä¼šçŸ¥é“è¦å¤„ç†çš„å›¾åƒå¤§å°ï¼Œå¹¶å¦‚ä½•åˆé€‚åœ°å¤„ç†å®ƒã€‚ å£°æ˜ä¸€ä¸ªvImage_Bufferå˜é‡ï¼Œç”¨æ¥å­˜å‚¨ç›®æ ‡å›¾åƒä¿¡æ¯ã€‚ å£°æ˜ä¸€ä¸ªPixel8888-æ ¼å¼çš„åƒç´ æ¥è¡¨ç¤ºç›®æ ‡å›¾åƒçš„èƒŒæ™¯è‰²ï¼ˆç¤ºä¾‹ä¸­ç”¨çš„æ˜¯é»‘è‰²ï¼‰ã€‚ å£°æ˜ä¸€ä¸ªvImage_Errå˜é‡æ¥å­˜å‚¨å·ç§¯å‡½æ•°çš„è¿”å›å€¼ã€‚ ç„¶åï¼Œå°†è¿™äº›å£°æ˜çš„å˜é‡å€¼ä¼ å…¥vImageConvolve_ARGB8888å‡½æ•°ä¸­ï¼Œç”±vImageæ¥å¤„ç†åç»­çš„è®¡ç®—ï¼Œå¹¶æŠŠç»“æœå­˜å‚¨åˆ°destå˜é‡ä¸­ã€‚vImageConvolve_ARGB8888å‡½æ•°æ˜¯vImageä¸­ä»…æœ‰çš„å‡ ä¸ªå·ç§¯å‡½æ•°ä¹‹ä¸€ã€‚é€šå¸¸ï¼ŒvImageä¼šä¸ºæ¯ç§å›¾åƒæ ¼å¼æä¾›4ç§å‡½æ•°å˜ä½“ï¼ŒARGB8888å‰ç¼€è¡¨ç¤ºè¯¥å‡½æ•°å¤„ç†çš„æ˜¯äº¤å‰å‹å›¾åƒï¼ˆfull-colorï¼‰ï¼Œæ¯ä¸ªåƒç´ ç”±å››ä¸ª8å­—èŠ‚çš„æ•´æ•°æ„æˆä¸€ç»„ï¼Œä»£è¡¨alphaï¼ˆAï¼‰ï¼Œredï¼ˆRï¼‰ï¼Œgreenï¼ˆGï¼‰å’Œblueï¼ˆBï¼‰å››ä¸ªé€šé“ã€‚æƒ³äº†è§£vImageæ”¯æŒçš„å›¾åƒæ ¼å¼çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·çœ‹vImageæ¦‚è¿°ã€‚ ç¤ºä¾‹myEmbossä¸­è¿˜ä½¿ç”¨äº†vImage_Flagså‚æ•°ã€‚è¯¥å‚æ•°ç”±1ä¸ªæˆ–å¤šä¸ªflagsï¼ˆç”¨æˆ–é€»è¾‘è¿ç®—ç¬¦ | è¿æ¥ï¼‰ç»„æˆã€‚kvImageBackgroundColorFillè¡¨ç¤ºvImageè¦ä½¿ç”¨é¢„å…ˆæä¾›çš„èƒŒæ™¯è‰²ã€‚ ä¸ºäº†ç†Ÿæ‚‰kernelæ•ˆæœçš„ä½¿ç”¨æ–¹æ³•ï¼Œè¯·åœ¨ä½ è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªkernelã€‚å›¾6çš„kernelå¯ä»¥ç”Ÿæˆé«˜æ–¯æ¨¡ç³Šæ•ˆæœï¼Œå›¾7çš„kernelå¯ä»¥ç”Ÿæˆè¾¹ç¼˜æ£€æµ‹æ•ˆæœã€‚ å›¾6 é«˜æ–¯æ¨¡ç³Š å›¾7 è¾¹ç¼˜æ£€æµ‹ å¸¦åå·®çš„å·ç§¯åœ¨æ‰§è¡Œå·ç§¯æ“ä½œæ—¶ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦å¸¦åå·®ã€‚åå·®æ˜¯æŒ‡åœ¨å·ç§¯ç»“æœä¸Šå†é¢å¤–æ·»åŠ ä¸€ä¸ªæ¥è‡ªå‘¨å›´åƒç´ çš„å½±å“ã€‚ç”±äºæŸäº›å·ç§¯è®¡ç®—å¾—åˆ°çš„ç»“æœå¯èƒ½ä¸ºè´Ÿå€¼ï¼Œåå·®å¯ä»¥é¿å…ä¿¡å·æº¢å‡ºã€‚å¯ä»¥æŠŠåå·®è®¾ä¸º127æˆ–128ï¼Œæ¥å…è®¸è´Ÿå€¼ä¹Ÿè¢«æç»˜å‡ºæ¥ã€‚åå·®å¯èƒ½ä½¿æ•´ä½“å›¾åƒæ•ˆæœå˜äº®æˆ–å˜æš—ã€‚ æ¯ä¸ªæ ‡å‡†çš„vImageå‡½æ•°ï¼ˆæ¯”å¦‚vImageConvolve_PlanarFï¼‰éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å¸¦åå·®çš„å‡½æ•°ï¼ˆvImageConvolveWithBias_PlanarFï¼‰ã€‚åå·®å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•å’Œæ— åå·®å‡½æ•°ä¸€æ ·ï¼Œé™¤äº†å¿…é¡»è®¾ç½®biaså‚æ•°æ¥ä½¿ç”¨åå·®ã€‚biasçš„æ•°æ®ç±»å‹å¿…é¡»ä¸å›¾åƒåƒç´ æ•°æ®ç±»å‹ä¸€è‡´ã€‚ å›¾8 å¸¦åå·®ä¸æ— åå·® ä½¿ç”¨é«˜é€Ÿæ»¤é•œvImageæä¾›äº†ä¸€äº›ç‰¹å®šçš„å·ç§¯å‡½æ•°ï¼Œè¿™äº›æ¯”ä¸€èˆ¬çš„å·ç§¯å‡½æ•°å…·æœ‰æ›´å¿«çš„å¤„ç†é€Ÿåº¦ã€‚OS X v10.4ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œå¯¹äºPlanar_8å’ŒARGB8888æ•°æ®ç±»å‹å¯ä»¥ä½¿ç”¨boxæ»¤é•œå’Œtentæ»¤é•œã€‚è¿™äº›æ»¤é•œå¯ä»¥å¾—åˆ°æ¨¡ç³Šæ•ˆæœï¼Œå‡½æ•°æ˜¯æ ¹æ®ä»–ä»¬åœ¨ç¬›å¡å°”åæ ‡ç³»çš„å½¢çŠ¶å‘½åçš„ã€‚è°ƒç”¨è¿™äº›å‡½æ•°ä¸éœ€è¦æä¾›kernelï¼Œæ•ˆæœç­‰åŒäºéœ€è¦æä¾›kernelçš„ä¸€èˆ¬çš„å·ç§¯å‡½æ•°ã€‚ä½†æ˜¯è¿™äº›å‡½æ•°æ¯”ä¸€èˆ¬çš„å‡½æ•°æ€§èƒ½ä¸Šè¦å¿«å¤§çº¦1ä¸ªé‡çº§ã€‚ æ³¨ï¼šç”±äºè¿™äº›å‡½æ•°éœ€è¦ä¸€ä¸ªç¨³å¥ç²¾ç¡®çš„ç®—æ³•ï¼ŒvImageè§„å®šè¿™äº›å‡½æ•°ä¸æ”¯æŒæµ®ç‚¹å‹ã€‚æµ®ç‚¹å‹çš„è®¡ç®—è¯¯å·®ä¼šå¯¼è‡´å›¾åƒé«˜å¯†åº¦åŒºåŸŸé™„è¿‘çš„ä½å¯†åº¦åŒºåŸŸæ˜¾å¾—äººå·¥åŒ–æˆ–ç²—ç³™åŒ–ã€‚ boxæ»¤é•œç”¨å‘¨å›´åƒç´ çš„æœªåŠ æƒçš„å¹³å‡æ•°æ¥ä»£æ›¿è¢«å¤„ç†çš„åƒç´ å€¼ï¼Œç›¸å½“äºé€šè¿‡æ‰€æœ‰å€¼éƒ½ä¸º1çš„kernelæ¥è¿›è¡Œå·ç§¯å¤„ç†ã€‚å¯¹åº”çš„å‡½æ•°æ˜¯vImageBoxConvolve_Planar8å’ŒvImageBoxConvolve_ARGB8888ã€‚æ¯ä¸ªè½¬æ¢åçš„åƒç´ éƒ½æ˜¯å…¶å‘¨å›´åƒç´ çš„å¹³å‡å€¼ï¼ˆå‘¨å›´åƒç´ çš„å®½ã€é«˜å³kernelçš„å®½ã€é«˜ï¼‰ã€‚ å›¾9 boxæ»¤é•œ tentæ»¤é•œç”¨å‘¨å›´åƒç´ çš„åŠ æƒå¹³å‡å€¼æ¥ä»£æ›¿è¢«å¤„ç†çš„åƒç´ å€¼ã€‚å¯¹åº”çš„å‡½æ•°æ˜¯vImageTentConvolve_Planar8å’ŒvImageTentConvolve_ARGB8888ã€‚tentæ»¤é•œçš„æ¨¡ç³Šæ“ä½œç›¸å½“äºä½¿ç”¨å€¼ä¸ä¸º1çš„kernelè¿›è¡Œçš„å·ç§¯æ“ä½œã€‚å’ŒvImageBoxConvolve_Planar8å’ŒvImageBoxConvolve_ARGB8888ä¸€æ ·ï¼Œä¸éœ€è¦å‘å‡½æ•°æä¾›kernelå€¼ï¼Œåªéœ€è¦å®½é«˜å³å¯ã€‚ å›¾10 tentæ»¤é•œ å‡è®¾kernelçš„å¤§å°æ˜¯3Ã—5ã€‚é‚£ä¹ˆç¬¬ä¸€ä¸ªçŸ©é˜µæ˜¯ ç¬¬äºŒä¸ªçŸ©é˜µæ˜¯ é‚£ä¹ˆç”Ÿæˆçš„kernelæ˜¯ 3Ã—5çš„tentæ»¤é•œæ“ä½œç›¸å½“äºä½¿ç”¨ä¸Šå›¾ä¸­çš„æ»¤é•œæ¥è¿›è¡Œå·ç§¯æ“ä½œã€‚ ä½¿ç”¨å¤šæ ¸vImageå…è®¸åœ¨å•ä¸ªå·ç§¯æ“ä½œä¸­ä½¿ç”¨å¤šä¸ªkernelã€‚å¯ä»¥ä½¿ç”¨vImageConvolveMultiKernelå‡½æ•°ï¼Œåˆ†åˆ«å®šä¹‰å››ä¸ªkernelï¼Œæ¯ä¸ªkernelå¯¹åº”ä¸€ä¸ªå›¾åƒé€šé“ã€‚ä¸€ä¸ªkernelæ§åˆ¶ä¸€ä¸ªé€šé“çš„è¯ï¼Œä½ å°±å¯ä»¥å¯¹å›¾åƒè¿›è¡Œæ›´é«˜çº§åˆ«çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ©ç”¨å¤šæ ¸å·ç§¯å¯¹å›¾åƒçš„é¢œè‰²é€šé“åˆ†åˆ«é‡æ–°é‡‡æ ·ï¼ŒæŠµæ¶ˆå±å¹•ä¸Šçš„RGBè§å…‰æ•ˆæœã€‚ç”±äºå››ä¸ªkernelå¯ä»¥åˆ†åˆ«å¯¹å•ä¸ªé¢œè‰²é€šé“è¿›è¡Œå¤„ç†ï¼ŒvImageConvolveMultiKernelå‡½æ•°åªèƒ½åº”ç”¨äºäº¤å‰å‹å›¾åƒã€‚ è¿™äº›å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ä¸å•æ ¸å·ç§¯å‡½æ•°ä½¿ç”¨æ–¹æ³•ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œéœ€è¦æä¾›ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æŒ‡å‘ä¸€ä¸ªkernelåœ°å€ã€‚ åå·ç§¯ä¸å·ç§¯è®¡ç®—ç›¸åŒçš„æ˜¯ï¼ŒvImageåŒæ ·åœ¨å†…éƒ¨å°è£…äº†åå·ç§¯çš„è®¡ç®—è¿‡ç¨‹ï¼Œä½ åªéœ€è¦æä¾›ä¸€ä¸ªkernelå³å¯ã€‚è¡¨2å±•ç¤ºäº†å¦‚ä½•æŠŠæµ®é›•æ•ˆæœé€šè¿‡åå·ç§¯æ¶ˆé™¤çš„è¿‡ç¨‹ã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„ä»£ç ã€åˆé€‚çš„kernelå»åå·ç§¯å„ç§æ•ˆæœï¼ˆæ¯”å¦‚æ¨¡ç³Šæ•ˆæœï¼‰ã€‚ä½†æ˜¯ä¸åŒäºå·ç§¯æ“ä½œçš„æ˜¯ï¼Œåå·ç§¯å‡½æ•°è¿˜éœ€è¦å¦ä¸€ä¸ªkernelå‚æ•°ã€‚é™¤ékernelçš„å®½å’Œé«˜ç›¸åŒï¼Œå¦åˆ™è¿™ä¸ªå‚æ•°ä¸èƒ½ä¸ºNULLã€‚å¦‚æœkernelçš„å®½å’Œé«˜ä¸ç›¸ç­‰ï¼Œå¿…é¡»å†æä¾›ä¸€ä¸ªè¡Œåˆ—åè½¬çš„kernelã€‚ è¡¨2æ˜¯ä¸€æ®µç¤ºä¾‹ä»£ç ï¼Œæè¿°äº†å¦‚ä½•ä½¿ç”¨vImageå¯¹ä¸€ä¸ªARGB8888-æ ¼å¼çš„å›¾åƒè¿›è¡Œåå·ç§¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647int myDeconvolve(void *inData, unsigned int inRowBytes, void *outData, unsigned int outRowBytes, unsigned int height, unsigned int width, void *kernel, unsigned int kernel_height, unsigned int kernel_width, int divisor, int iterationCount, vImage_Flags flags )&#123; //Prepare data structures uint_8 kernel = &#123;-2, -2, 0, -2, 6, 0, 0, 0, 0&#125;; // 1 vImage_Error err; // 2 unsigned char bgColor[4] = &#123; 0, 0, 0, 0 &#125;; // 3 vImage_Buffer src = &#123; inData, height, width, inRowBytes &#125;; // 4 vImage_Buffer dest = &#123; outData, height, width, outRowBytes &#125;; // 5 //Send data to vImage for processing err = vImageRichardsonLucyDeConvolve_ARGB8888( &amp;src, // 6 &amp;dest, //const vImage_Buffer *dest, NULL, 0, //unsigned int srcOffsetToROI_X, 0, //unsigned int srcOffsetToROI_Y, kernel, //const signed int *kernel, NULL, //assumes symmetric kernel kernel_height, //unsigned int kernel_height, kernel_width, //unsigned int kernel_width, 0, //height of second kernel 0, //width of second kernel divisor, //int 0, //for second kernel bgColor, iterationCount, //uint32_t kvImageBackgroundColorFill | flags //vImage_Flags ); //Report result return err; // 7&#125; è¿™æ®µä»£ç éƒ½åšäº†ä»€ä¹ˆï¼Ÿ å®šä¹‰vImageè¦è¿›è¡Œåå·ç§¯å¤„ç†çš„åˆå§‹å·ç§¯å›¾åƒçš„kernelå€¼ã€‚ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯å¯¹ç§°çš„kernelï¼ˆå®½é«˜éƒ½ä¸º3ï¼‰ï¼Œå› æ­¤ä¸ç”¨å†å®šä¹‰ç¬¬äºŒä¸ªkernelï¼› å£°æ˜ä¸€ä¸ªvImage_Errorç»“æ„ä½“ï¼Œæ¥å­˜å‚¨åå·ç§¯ç»“æœï¼› å£°æ˜ä¸€ä¸ªPixel8888-ç±»å‹çš„åƒç´ ï¼Œç”¨äºè¡¨ç¤ºè½¬æ¢åå›¾åƒçš„èƒŒæ™¯è‰²ï¼› å£°æ˜ä¸€ä¸ªvImage_Bufferç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨åˆå§‹å›¾åƒä¿¡æ¯ã€‚å›¾åƒæ•°æ®æ˜¯ä½œä¸ºä¸€ä¸ªå­—èŠ‚å‹æ•°ç»„å­˜å‚¨çš„ï¼ŒåŒ…æ‹¬å›¾åƒæ•°æ®inDataã€å®½ã€é«˜ã€è¡Œå­—èŠ‚ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è®©vImageçŸ¥é“å®ƒè¦å¤„ç†çš„å›¾åƒæœ‰å¤šå¤§ï¼Œä»è€Œæ›´å¥½çš„æ‰§è¡Œæ“ä½œï¼› å£°æ˜ä¸€ä¸ªvImage_Bufferç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨ç›®æ ‡å›¾åƒä¿¡æ¯ï¼› æŠŠä¸Šè¿°å£°æ˜çš„å˜é‡ä¼ ç»™vImageå‡½æ•°ã€‚æ³¨æ„ç¤ºä¾‹ä¸­åœ¨è°ƒç”¨vImageRichardsonDeConvolve_ARGB8888å‡½æ•°æ—¶ï¼Œç¬¬äºŒä¸ªkernelä¸ºNULLï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªkernelæ˜¯å¯¹ç§°çš„ï¼Œæ²¡æœ‰å¿…è¦å†è¿›è¡Œç¿»è½¬ã€‚ åå·ç§¯æ˜¯ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ã€‚ä½ å¯ä»¥è®¾ç½®è¿­ä»£æ¬¡æ•°ï¼Œæ¬¡æ•°ä¸åŒï¼Œå¾—åˆ°çš„ç»“æœä¼šä¸ä¸€æ ·ï¼Œå› æ­¤ï¼Œä¸ºäº†å¾—åˆ°æœ€ç†æƒ³çš„ç»“æœï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å›¾åƒå¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vImageå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰â€”â€”æ¦‚è¿°]]></title>
    <url>%2F2016%2F08%2F22%2FvImage-translation-01%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å…³äºå›¾åƒæ ¼å¼ Image Formatså›¾åƒæ ¼å¼ï¼ˆImage Formatsï¼‰è§„å®šäº†åƒç´ æ•°æ®å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨ã€‚å›¾åƒæ–‡ä»¶æ ¼å¼ï¼ˆæ¯”å¦‚JPGã€PNGã€GIFç­‰ï¼‰ç”¨æ¥åœ¨ç¨‹åºä¸­è½¬æ¢å›¾åƒæ•°æ®ï¼Œå¹¶å°†æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šã€‚è¯¸å¦‚Image I/Oç­‰æ¡†æ¶å¯ä»¥ä»ç¡¬ç›˜åŠ è½½å„ç§æ ¼å¼çš„å›¾åƒæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­ä½¿ç”¨ã€‚åœ¨å†…å­˜ä¸­ï¼Œå›¾åƒæ˜¯é€šè¿‡äºŒç»´æ•°ç»„æ¥å­˜å‚¨åƒç´ æ•°æ®çš„ï¼Œå›¾åƒä¸­çš„æ¯ä¸ªåƒç´ éƒ½å¯¹åº”æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚ å›¾åƒæ ¼å¼ï¼ˆImage Formatsï¼‰åŒ…å«ä¸¤ç§ç±»å‹ï¼šäºŒç»´å¹³é¢å‹ï¼ˆplanarï¼‰å’Œäº¤å‰å‹ï¼ˆinterleavedï¼‰ã€‚äºŒç»´å¹³é¢å‹å›¾åƒæŠŠä¸åŒé€šé“çš„æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„ç¼“å†²åŒºå†…ï¼Œä¸€ä¸ªå…¸å‹çš„å¹³é¢å‹å›¾åƒé€šå¸¸åŒ…æ‹¬redã€greenã€blueå’Œalphaå››ä¸ªé€šé“ã€‚äº¤å‰å‹å›¾åƒæŠŠä¸åŒé€šé“çš„æ•°æ®è½®æ¢ç€å­˜å‚¨ï¼šARGBARGBARGBâ€¦â€¦ å›¾åƒæ•°æ®å¯ä»¥æ˜¯æ•´å‹ï¼ˆintegerï¼‰å’Œæµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚åœ¨vImageä¸­ï¼Œé€šè¿‡ä¸€ä¸ª8ä½ï¼ˆbitï¼‰çš„æ— ç¬¦å·æ•´å‹æ•°å€¼è¡¨ç¤ºè‰²é¥±å’Œåº¦ç­‰çº§ã€‚æ•°å€¼èŒƒå›´0~255ï¼Œ255è¡¨ç¤ºæœ€å¤§è‰²é¥±å’Œåº¦ï¼Œ0è¡¨ç¤ºæ— è‰²é¥±å’Œåº¦ã€‚æµ®ç‚¹å‹æ•°å€¼é€šå¸¸ä»0.0~1.0è¡¨ç¤ºè‰²é¥±å’Œåº¦ã€‚ ä»¥ä¸‹æ˜¯æ ¸å¿ƒæ“ä½œä½¿ç”¨åˆ°çš„å›¾åƒæ ¼å¼ï¼š Planar8 å•é€šé“ï¼ˆé¢œè‰²æˆ–alphaï¼‰å›¾åƒã€‚æ¯ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸ª8bitçš„æ— ç¬¦å·æ•´æ•°ï¼Œæ•°æ®ç±»å‹æ˜¯Pixel_8 PlanarF å•é€šé“ï¼ˆé¢œè‰²ï¼‰å›¾åƒã€‚æ¯ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸ª32bitçš„æµ®ç‚¹æ•°ï¼Œæ•°æ®ç±»å‹æ˜¯Pixel_F ARGB8888 å›¾åƒåŒ…å«å››ä¸ªäº¤å‰é€šé“ï¼Œalphaã€redã€greenã€blueï¼Œé¡ºåºå›ºå®šã€‚æ¯ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸ª32ä½çš„æ•°ç»„ï¼ˆåŒ…å«å››ä¸ª8ä½æ— ç¬¦å·æ•´æ•°ï¼‰ã€‚æ•°æ®ç±»å‹æ˜¯Pixel_8888 ARGBFFFF å›¾åƒåŒ…å«å››ä¸ªäº¤å‰é€šé“ï¼Œalphaã€redã€greenã€blueï¼Œé¡ºåºå›ºå®šã€‚æ¯ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸ªåŒ…å«å››ä¸ªæµ®ç‚¹æ•°çš„æ•°ç»„ã€‚æ•°æ®ç±»å‹æ˜¯Pixel_FFFF RGBA8888 å›¾åƒåŒ…å«å››ä¸ªäº¤å‰é€šé“ï¼Œredã€greenã€blueã€alphaï¼Œé¡ºåºå›ºå®šã€‚æ¯ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸ª32ä½çš„æ•°ç»„ï¼ˆåŒ…å«å››ä¸ª8ä½æ— ç¬¦å·æ•´æ•°ï¼‰ã€‚æ•°æ®ç±»å‹æ˜¯Pixel_8888 RGBAFFFF å›¾åƒåŒ…å«å››ä¸ªäº¤å‰é€šé“ï¼Œredã€greenã€blueã€alphaï¼Œé¡ºåºå›ºå®šã€‚æ¯ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸ªåŒ…å«å››ä¸ªæµ®ç‚¹æ•°çš„æ•°ç»„ã€‚æ•°æ®ç±»å‹æ˜¯Pixel_FFFF å¯ä»¥å°†å…¶ä»–æ ¼å¼çš„å›¾åƒè½¬æ¢ä¸ºvImageçš„å›¾åƒæ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡vImageConvert_16SToFå‡½æ•°å°†ä¸€ä¸ª16ä½åƒç´ çš„å›¾åƒè½¬æ¢ä¸ºvImageæ”¯æŒçš„32ä½åƒç´ ã€‚ä¸‹é¢è¿™äº›å‡½æ•°å¯ä»¥å¸®åŠ©ä½ åœ¨vImageå›¾åƒæ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œä¹Ÿå¯ä»¥æŠŠvImageä¸æ”¯æŒçš„å›¾åƒæ ¼å¼è½¬æ¢ä¸ºvImageæ ¼å¼ã€‚ vImageConvert_16SToF å°†ä¸€ä¸ª16ä½ç¬¦å·æ•´å‹planarå›¾åƒæ ¼å¼ï¼ˆæˆ– vImage_Buffer.width=4çš„interleaved-multiplyï¼‰ç¼“å†²åŒºï¼ˆ vImage_Buffer ï¼‰è½¬æ¢ä¸ºæµ®ç‚¹å‹æ•°å€¼ç¼“å†²åŒº vImageConvert_16UToF å°†ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´å‹planarå›¾åƒæ ¼å¼ï¼ˆæˆ– vImage_Buffer.width=4çš„interleaved-multiplyï¼‰ç¼“å†²åŒºï¼ˆ vImage_Buffer ï¼‰è½¬æ¢ä¸ºæµ®ç‚¹å‹æ•°å€¼ç¼“å†²åŒº ImageConvert_FTo16S å°†ä¸€ä¸ªæµ®ç‚¹å‹planarå›¾åƒæ ¼å¼ï¼ˆæˆ– vImage_Buffer.width=4çš„interleaved-multiplyï¼‰ç¼“å†²åŒºï¼ˆ vImage_Buffer ï¼‰è½¬æ¢ä¸º16ä½ç¬¦å·æ•´å‹ç¼“å†²åŒº vImageConvert_FTo16U å°†ä¸€ä¸ªæµ®ç‚¹å‹planarå›¾åƒæ ¼å¼ï¼ˆæˆ– vImage_Buffer.width=4çš„interleaved-multiplyï¼‰ç¼“å†²åŒºï¼ˆ vImage_Buffer ï¼‰è½¬æ¢ä¸º16ä½æ— ç¬¦å·æ•´å‹ç¼“å†²åŒº vImageConvert_16UtoPlanar8 å°†ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´å‹planarå›¾åƒæ ¼å¼ï¼ˆæˆ– vImage_Buffer.width=4çš„interleaved-multiplyï¼‰ç¼“å†²åŒºï¼ˆ vImage_Buffer ï¼‰è½¬æ¢ä¸º8ä½æ•´å‹ç¼“å†²åŒº vImageConvert_Planar8to16U å°†ä¸€ä¸ª8ä½æ•´å‹planarå›¾åƒæ ¼å¼ï¼ˆæˆ– vImage_Buffer.width=4çš„interleaved-multiplyï¼‰ç¼“å†²åŒºï¼ˆ vImage_Buffer ï¼‰è½¬æ¢ä¸º16ä½æ— ç¬¦å·æ•´å‹ç¼“å†²åŒº vImageConvert_ARGB1555toPlanar8 å°†16ä½/åƒç´ å›¾åƒï¼ˆalphaé€šé“1bitï¼Œred/green/blueé€šé“5bitï¼‰è½¬æ¢ä¸ºPlanar8æ ¼å¼ã€‚ vImageConvert_ARGB1555toARGB8888 å°†16ä½/åƒç´ å›¾åƒï¼ˆalphaé€šé“1bitï¼Œred/green/blueé€šé“5bitï¼‰è½¬æ¢ä¸ºARGB8888æ ¼å¼ã€‚ vImageConvert_Planar8toARGB1555 å°†Planar8æ ¼å¼å›¾åƒè½¬æ¢ä¸ºåŒ…å«1bit alphaï¼Œ5bit redï¼Œ5bit greenï¼Œ5bit blueçš„16ä½/åƒç´ å›¾åƒã€‚ vImageConvert_ARGB8888toARGB1555 å°†ARGB8888æ ¼å¼å›¾åƒè½¬æ¢ä¸ºåŒ…å«1bit alphaï¼Œ5bit redï¼Œ5bit greenï¼Œ5bit blueçš„16ä½/åƒç´ å›¾åƒã€‚ vImageConvert_RGB565toPlanar8 å°†5bit redï¼Œ6bit greenï¼Œ5bit blueçš„16ä½/åƒç´ å›¾åƒè½¬æ¢ä¸ºPlanar8 vImageConvert_RGB565toARGB8888 å°†5bit redï¼Œ6bit greenï¼Œ5bit blueçš„16ä½/åƒç´ å›¾åƒè½¬æ¢ä¸ºARGB8888 vImageConvert_Planar8toRGB565 å°†Planar8å›¾åƒè½¬æ¢ä¸º5-6-6å›¾åƒ vImageConvert_ARGB8888toRGB565 å°†ARGB8888å›¾åƒè½¬æ¢ä¸º5-6-5å›¾åƒ vImageConvert_Planar16FtoPlanarF å°†16ä½æµ®ç‚¹å‹planarå›¾åƒè½¬æ¢ä¸º32ä½æµ®ç‚¹å‹ äºŒã€vImageç»ƒä¹ Loading Image Dataè¦å°†vImageé›†æˆåˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œé¦–å…ˆè¦æŠŠrawå›¾åƒæ•°æ®åŠ è½½åˆ°å†…å­˜ã€‚å¯ä»¥ä½¿ç”¨Image I/Oæ¡†æ¶æŠŠä»»ä½•ä¸»æµçš„å›¾åƒæ–‡ä»¶ï¼ˆJPGã€PNGã€GIFç­‰ï¼‰åŠ è½½åˆ°Cç±»å‹ç¼“å†²æ± ä¸­ï¼ˆvoid *arraysï¼‰ã€‚ ä»¥ä¸‹æ˜¯ä»æœ¬åœ°æ–‡ä»¶æå–rawå›¾åƒæ•°æ®çš„ä¾‹å­ï¼š 12345678910111213141516171819202122NSURL* url = [NSURL fileURLWithPath:filename];//Create the image source with the options left null for now//Keep in mind since we created it, we're responsible for getting rid of itCGImageSourceRef image_source = CGImageSourceCreateWithURL( (CFURLRef)url, NULL);if(image_source == NULL)&#123; //Something went wrong fprintf(stderr, "VImage error: Couldn't create image source from URL\n"); return false;&#125;//Now that we got the source, let's create an image from the first image in the CGImageSourceCGImageRef image = CGImageSourceCreateImageAtIndex(image_source, 0, NULL); //We created our image, and that's all we needed the source for, so let's release itCFRelease(image_source); if(image == NULL)&#123; //something went wrong fprintf(stderr, "VImage error: Couldn't create image source from URL\n"); return false;&#125; æŠŠå›¾åƒåŠ è½½åˆ°å†…å­˜ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡vImageå‡½æ•°è¿›è¡Œå„ç§å¤„ç†äº†ã€‚è¯·å¯†åˆ‡æ³¨æ„å‡½æ•°ä¸‹åˆ’çº¿ä¹‹åçš„å­—ç¬¦ï¼Œé‚£ä»£è¡¨äº†åƒç´ æ•°æ®çš„æ ¼å¼ã€‚vImageå‡½æ•°æ—¢å¯ä»¥åœ¨æºç¼“å†²åŒºä¸­ç›´æ¥å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨æä¾›çš„ç›®æ ‡ç¼“å†²åŒºä¸­å¤„ç†ã€‚ ç”±äºvImageåªè´Ÿè´£å¤„ç†å›¾åƒï¼Œä½ è¿˜éœ€è¦æƒ³åŠæ³•æŠŠå›¾åƒæ˜¾ç¤ºå‡ºæ¥ã€‚æ ¹æ®ä½ çš„åº”ç”¨å¼€å‘ç¯å¢ƒï¼ˆCarbon or Cocoaï¼‰ï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ï¼ˆä¾‹å¦‚Quartzï¼‰å»æ˜¾ç¤ºåˆæˆåçš„åƒç´ æ•°æ®ï¼Œæˆ–å°†å›¾åƒæ•°æ®å­˜å‚¨åˆ°ç£ç›˜ï¼ˆImage I/Oï¼‰ã€‚ ä½¿ç”¨äºŒç»´å›¾åƒæ ¼å¼å¤§å¤šæ•°vImageå‡½æ•°æ˜¯ä»å››ç§å›¾åƒæ ¼å¼å¼€å§‹çš„ã€‚äºŒç»´å›¾åƒæ¯æ¬¡ç¼–ç ä¸€ä¸ªé€šé“ï¼ˆå…ˆå­˜å‚¨æ‰€æœ‰çš„çº¢è‰²é€šé“æ•°æ®ï¼Œç„¶åæ˜¯ç»¿è‰²ï¼Œè“è‰²ï¼Œalphaï¼‰ï¼Œè€Œäº¤å‰å›¾åƒåœ¨å†…å­˜æ˜¯æ··åˆå­˜å‚¨æ‰€æœ‰é€šé“çš„ã€‚ æ³¨æ„ï¼šæœ‰æ—¶å€™ä½ å¯èƒ½å¹¶ä¸éœ€è¦å¤„ç†æ‰€æœ‰çš„é€šé“ã€‚æ¯”å¦‚ï¼Œä½ çŸ¥é“ä½ è¦å¤„ç†çš„å›¾åƒä¸­æ˜¯ä¸éœ€è¦alphaé€šé“çš„ï¼Œæˆ–å¯èƒ½ä½ çš„å›¾åƒæ˜¯ç°åº¦å›¾ï¼Œå› æ­¤ä½ åªéœ€è¦ä¸€ä¸ªé€šé“ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨äºŒç»´å›¾åƒæ ¼å¼å¯ä»¥è®©ä½ æŠŠéœ€è¦çš„é€šé“éš”ç¦»å‡ºæ¥ã€‚ æ‹¼è´´ï¼ˆTilesï¼‰æŠ€æœ¯åœ¨å›¾åƒåº”ç”¨ä¸­ï¼Œé€šå¸¸è¦ä½¿ç”¨Tileså°†ä¸€ä¸ªå›¾åƒåˆ†å‰²æˆå‡ ä¸ªå°å›¾ã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºtilingæŠ€æœ¯ï¼Œæ˜¯å› ä¸ºè¿™çœ‹èµ·æ¥å¾ˆåƒæ˜¯æŠŠå¤šä¸ªåœ°æ¿ç“·ç –æ‹¼æ¥æˆä¸€å¤§å—å„¿çš„è¿‡ç¨‹ï¼Œå›¾åƒä¸­å¤šä¸ªå°çš„å•ä½æ‹¼è´´åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå¤§çš„å›¾åƒã€‚è¿™ä¸ªæŠ€æœ¯çš„ä¼˜åŠ¿åœ¨äºï¼ŒæŠŠæ•°æ®åˆ†æ•£æˆNä¸ªå°çš„å•ä½åï¼Œå¯ä»¥åˆ†æ•£å¡«å……åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè¿™ä½¿CPUçš„å¤„ç†é€Ÿåº¦åŠ å¿«äº†è®¸å¤šã€‚ é€šå¸¸æ¥è¯´ï¼Œå½“è¢«å¤„ç†çš„æ•°æ®ï¼ˆåŒ…æ‹¬è¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®ï¼‰æ”¾åœ¨å¤„ç†å™¨çš„æ•°æ®ç¼“å­˜ä¸­æ—¶ï¼ŒvImageå…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚è®¿é—®å¤„ç†å™¨ç¼“å­˜ä¸­çš„æ•°æ®æ¯”è®¿é—®å†…å­˜æ•°æ®è¦å¿«å¾ˆå¤šã€‚ç„¶è€ŒCPUç¼“å­˜æ˜¯å¾ˆå¿«ï¼Œä½†æ˜¯å®ƒåœ¨ç©ºé—´ä¸Šæ˜¯æœ‰é™åˆ¶çš„ã€‚ä¸åŒçš„CPUç¼“å­˜å¤§å°ä¸ä¸€æ ·ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œåœ¨Intelå¤„ç†å™¨ä¸­ä¿å­˜å°‘äº2MBçš„tileå›¾åƒï¼Œè¿˜æœ‰åœ¨PowerPCå¤„ç†å™¨ä¸­ä¿å­˜å°‘äº512KBçš„tileè¿˜æ˜¯å¾ˆæœ‰ä¼˜åŠ¿çš„ã€‚ ä»¥ä¸‹æ˜¯TilesæŠ€æœ¯çš„ä¸€äº›æŠ€å·§ï¼š æœ‰äº›CPUç¼“å­˜ä¸€æ¬¡åªèƒ½ä¿å­˜å¾ˆå°‘é‡çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯512KBæˆ–æ›´å°‘ï¼‰ 128KB - 512KBçš„tileæ•°æ®ååé‡æœ€ä¼˜ å¾ˆå¤švImageå‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨tileæŠ€æœ¯ï¼ˆè¿˜æœ‰å¤šçº¿ç¨‹ï¼‰ã€‚å¦‚æœä½ æƒ³è‡ªå·±æ§åˆ¶tilingï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶åœ¨flagså‚æ•°ä¸­æ·»åŠ kvImageDoNotTileæ ‡è®°ï¼Œè¿™æ ·å¯ä»¥é¿å…å‡½æ•°åœ¨å†…éƒ¨ä½¿ç”¨tilingæˆ–å¤šçº¿ç¨‹æŠ€æœ¯ã€‚ å¯¹äºå¹³æ–¹å½¢tileï¼Œ128KB-256KBçš„tileå¤§å°å…·æœ‰æœ€å¥½çš„ååç‡ã€‚ ä¸åŒå‡½æ•°çš„æœ€ä¼˜tileå¤§å°ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å…·æœ‰å°‘é‡å­—èŠ‚è®¡ç®—çš„å‡½æ•°ï¼ˆå¤§å¤šæ•°æ˜¯è½¬æ¢å‡½æ•°ï¼‰åœ¨file size å°äº16KBæ—¶æ˜¯æœ€å¿«çš„ï¼Œå…¸å‹çš„vImageå‡½æ•°åœ¨256KB tile sizeä¸‹æ˜¯æœ€å¿«çš„ã€‚ æ•°æ®ç¼“å†²æ’åˆ—å½“åˆ†é…å›¾åƒçš„æµ®ç‚¹å‹æ•°æ®æ—¶ï¼Œä¿æŒ4ä¸ªå­—èŠ‚çš„æ’åˆ—æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™è¯´æ˜ä½ åˆ†é…çš„å­—èŠ‚æ•°åº”è¯¥æ˜¯4çš„æ•´æ•°å€ã€‚ ä»¥ä¸‹æ˜¯æ•°æ®æ’åˆ—å’Œç¼“å†²åŒºå¤§å°çš„ä¸€äº›æŠ€å·§ï¼š å°½ç®¡vImageé»˜è®¤å¯ä»¥æœ‰æ›´å°‘çš„æ•°æ®æ’åˆ—ï¼Œä½†ä¸ºäº†æ€§èƒ½æœ€ä¼˜åŒ–ï¼Œæ‰€æœ‰æ•°æ®éƒ½åº”è¯¥æ˜¯16å­—èŠ‚æ’åˆ—ï¼Œä¸”rowbytesåº”è¯¥æ˜¯16çš„æ•´æ•°å€ã€‚ æµ®ç‚¹å‹æ•°æ®å¿…é¡»è‡³å°‘æ˜¯4å­—èŠ‚ï¼Œå¦åˆ™æŸäº›å‡½æ•°å¯èƒ½ä¼šæŠ¥é”™ã€‚ å‡½æ•°çš„rowByteså‚æ•°ä¸èƒ½ä¼ å…¥2çš„å¹‚æ¬¡æ–¹ã€‚ ç¼“å†²åŒºï¼ˆbufferï¼‰é‡ç”¨æœºåˆ¶å¾ˆå¤šå‡½æ•°åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼šä½¿ç”¨ä¸´æ—¶ç¼“å†²åŒºæ¥å­˜å‚¨ä¸­é—´å€¼ã€‚åœ¨ä¸€å¼€å§‹åªéœ€åˆ›å»ºä¸€æ¬¡bufferï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªå‡½æ•°ä¸­ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœæ—¶é—´ã€‚ å¦‚æœä½ æ²¡æœ‰æä¾›bufferï¼Œè¿™äº›å‡½æ•°ä¼šè‡ªè¡Œåˆ›å»ºbufferï¼ˆå½“ç„¶ï¼Œä½¿ç”¨å®Œåé‡Šæ”¾ï¼‰ã€‚ å¦‚æœä½ åªéœ€è¦è°ƒç”¨å‡ æ¬¡è¯¥å‡½æ•°ï¼Œå¹¶ä¸”ä¸åœ¨æ„çŸ­æš‚çš„é˜»å¡ï¼Œé‚£ä¹ˆè®©å‡½æ•°è‡ªè¡Œåˆ›å»ºbufferæ˜¯ä¸ªæ˜æ™ºçš„é€‰æ‹©ã€‚ æ¯ä¸ªä½¿ç”¨åˆ°ä¸´æ—¶bufferçš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ªsrcå’Œdescå‚æ•°ï¼ˆæ•°æ®ç±»å‹éƒ½æ˜¯vImage_Bufferï¼‰ã€‚å‡½æ•°åªä½¿ç”¨äº†è¿™äº›å‚æ•°çš„heightå’ŒwidthåŸŸï¼›å¿½ç•¥dataå’ŒrowBytesåŸŸã€‚ å¯èƒ½çš„è¯ï¼Œåº”ç”¨ä¹Ÿåº”è¯¥å°è¯•é‡ç”¨vImage_Bufferæ•°æ®çš„dataåŸŸæŒ‡å‘çš„å›¾åƒç¼“å†²åŒºã€‚è¿™æ ·å¯ä»¥èŠ‚çœæ—¶é—´ï¼Œå¦åˆ™è¿˜è¦é‡æ–°åˆ†é…å¹¶ä¸”æŠŠåŸæ¥çš„bufferæŠ¹å¹³ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¦å°½å¯èƒ½çš„é¿å…ä½¿ç”¨å †å’Œå…¶ä»–å¯èƒ½å¼•èµ·é˜»å¡çš„æ“ä½œï¼ˆæ¯”å¦‚å†…å­˜åˆ†é…ï¼‰ã€‚ é€‚å½“çš„ä½¿ç”¨çº¿ç¨‹vImageæ˜¯çº¿ç¨‹å®‰å…¨çš„å¹¶ä¸”å¯é‡å…¥ã€‚å¦‚æœä½ åˆ†å‰²äº†ä½ çš„å›¾åƒï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†ä¸åŒçš„tilesã€‚å¦‚æœä½ ä½¿ç”¨ä¸åŒçš„å¤„ç†å™¨å¤„ç†ä¸åŒçš„tilesï¼Œä½ åº”é€‰æ‹©é‚£äº›æ°´å¹³æ–¹å‘ä¸Šä¸ç›¸é‚»çš„tilesã€‚å¦åˆ™tileçš„è¾¹ç¼˜å¯èƒ½ä¼šå…±äº«åˆ°cacheï¼Œè¿™æœ‰å¯èƒ½å¯¼è‡´ä¸¤ä¸ªå¤„ç†å™¨ä¹‹é—´è€—æ—¶çš„å¹²æ‰°ã€‚ åœ¨vImageå‡½æ•°å·¥ä½œæ—¶ï¼ŒvImageçš„è¾“å‡ºbufferçŠ¶æ€æ˜¯æœªçŸ¥çš„ã€‚æœ‰å¯èƒ½bufferä¸­çš„åƒç´ æ•°æ®æ—¢ä¸æ˜¯èµ·å§‹æ•°æ®ä¹Ÿä¸æ˜¯ç»“æŸæ•°æ®ï¼Œè€Œæ˜¯è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä¸­é—´å€¼ã€‚ åœ¨OS X 10.4ä¹‹åï¼Œä¸€äº›vImageå‡½æ•°åœ¨å†…éƒ¨ä½¿ç”¨äº†å¤šçº¿ç¨‹æŠ€æœ¯ã€‚ä»–ä»¬è‡ªå·±åšäº†å‚æ•°æ£€æŸ¥å’Œå¤šçº¿ç¨‹æ¥æé«˜æ€§èƒ½ã€‚vImageç»´æŒäº†å®ƒå»¶è¿Ÿåˆ†é…çº¿ç¨‹ç¼“å†²æ± çš„é£æ ¼å»åšè¿™ä»¶äº‹ã€‚è¿™äº›çº¿ç¨‹ä¸€æ—¦è¢«åˆ›å»ºå°±ä¸ä¼šè¢«é”€æ¯ï¼Œä»–ä»¬ä¼šè¢«é‡ç”¨ã€‚è¢«è°ƒç”¨çš„çº¿ç¨‹è¦ç­‰å¾…ä¸Šä¸€ä¸ªçº¿ç¨‹å®Œæˆè‡ªå·±çš„ä»»åŠ¡ï¼Œåœ¨è¿™ä¹‹å‰ä¼šè¢«é˜»å¡ã€‚ä½¿ç”¨å†…éƒ¨å®ç°äº†å¤šçº¿ç¨‹æŠ€æœ¯çš„å‡½æ•°æ˜¯å®‰å…¨çš„ã€‚ çº¿ç¨‹å®‰å…¨çš„å‡½æ•°é€šè¿‡é”æ¥ä¿æŒæ•°æ®ä¸€è‡´æ€§ã€‚å¦‚æœä½ ä¸å¸Œæœ›å‡½æ•°ä½¿ç”¨é”ï¼Œä½ éœ€è¦è®¾ç½®kvImageDoNotTileæ ‡å¿—ä½æ¥é˜»æ­¢vImageä½¿ç”¨å¤šçº¿ç¨‹å’ŒtilingæŠ€æœ¯ã€‚å¦‚æœä½ è®¾ç½®äº†è¯¥æ ‡å¿—ä½ï¼Œä½ çš„åº”ç”¨éœ€è¦è‡ªè¡Œå¤„ç†æ•°æ®tilingå’Œå¤šçº¿ç¨‹ã€‚ æŠŠ2Dæ ¸åˆ†ä¸º1Dæ ¸å¦‚æœä½ ä½¿ç”¨å·ç§¯æ–¹æ³•å¯¹å›¾åƒæ·»åŠ æ»¤é•œï¼Œä½ å¯ä»¥é€šè¿‡å°†2Dæ ¸åˆ†è£‚ä¸ºä¸¤ä¸ª1Dæ ¸æ¥æé«˜æ€§èƒ½ï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨ä¸¤æ¬¡å·ç§¯ï¼ˆä¸€ä¸ªç»´åº¦å¯ä»¥ä½¿ç”¨ä¸€æ¬¡ï¼‰ã€‚ å½“ç„¶ï¼Œä½ å¯ä»¥å°†2Dæ ¸ä¼ ç»™vImageConvolveå‡½æ•°ã€‚vImageä½¿ç”¨2Dæ ¸æ¥å®Œæˆ9å±‚8åŠ çš„æ“ä½œæ¥è®¡ç®—æ¯ä¸ªåƒç´ ç»“æœã€‚ä¸ºäº†æ›´å¥½çš„æ€§èƒ½ï¼Œå¯¹æ¯ä¸ª1Då·ç§¯æ»¤é•œè°ƒç”¨ä¸€æ¬¡vImageConvolveå‡½æ•°ã€‚æ ¸åˆ†è£‚åï¼ŒvImageé€šè¿‡æ¯ä¸ªå·ç§¯å¯¹æ¯ä¸ªåƒç´ æ‰§è¡Œ3å±‚2åŠ çš„æ“ä½œï¼ŒåŠ èµ·æ¥æ˜¯6å±‚4åŠ ã€‚æˆ‘ä»¬æ³¨æ„åˆ°å°†æ ¸åˆ†è£‚æˆä¸¤ä¸ªåï¼Œç®—æ³•å¤æ‚åº¦åœ¨ä¹˜æ³•ä¸ŠèŠ‚çœäº†1/3ï¼Œåœ¨åŠ æ³•ä¸ŠèŠ‚çœäº†1/2ã€‚å¯¹äºMÃ—Nçš„å†…æ ¸ï¼Œå¤„ç†æ¶ˆè€—ä»M*Néª¤å‡åˆ°M+Nã€‚ä¸€ä¸ª5Ã—5çš„æ ¸åˆ†è£‚åçš„å¤„ç†é€Ÿåº¦åŠ å¿«2.5å€ï¼Œä¸€ä¸ª11Ã—11çš„æ ¸åˆ†è£‚åå¯èƒ½åŠ å¿«è¶…è¿‡5å€ã€‚ æ³¨æ„è¿™ä¸ªæŠ€æœ¯åœ¨å¸¸è§„æƒ…å†µä¸‹æ˜¯æ¯”è¾ƒæ…¢çš„ã€‚ä¸€èˆ¬åœ¨å›¾åƒç‰¹åˆ«å¤§ï¼Œæˆ–å›¾åƒæ— æ³•å­˜å…¥å†…å­˜æ—¶ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯ã€‚ æœ‰å‡ ç§æƒ…å†µä¸‹ï¼Œåˆ†è£‚ç‰¹åˆ«å¤§çš„æ»¤é•œæ˜¯æ‰§è¡Œå·ç§¯æ“ä½œçš„å”¯ä¸€æ–¹æ¡ˆã€‚ä¸€ä¸ªæ€»è®¡è¶…è¿‡224çš„æ»¤é•œï¼ŒvImageä½¿ç”¨8ä½çš„å·ç§¯æ“ä½œä¸‹ï¼Œè¿è¡Œèµ·æ¥ä¼šæœ‰å†…å­˜æº¢å‡ºçš„é£é™©ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥é‡‡ç”¨åˆ†è£‚æ»¤é•œæ¥é¿å…æº¢å‡ºï¼Œä½ ç”šè‡³å¯ä»¥åœ¨æ”¾å¤§æ»¤é•œä¹‹å‰ï¼Œé€šè¿‡åˆ†è£‚æŠ€æœ¯å‘æ»¤é•œé‡Œæ·»åŠ æ›´å¤šçš„å›ºå®šç²¾åº¦çš„ç‚¹ã€‚è¿™ç§æŠ€æœ¯çš„ä¸­é—´å€¼ç²¾åº¦æŸå¤±ç¨‹åº¦æœªçŸ¥ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å›¾åƒå¤„ç†</tag>
      </tags>
  </entry>
</search>