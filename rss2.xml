<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Freya&#39;s blog</title>
    <link>gofee.me/</link>
    <atom:link href="/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>çµåŠ¨ï¼Œæ´’è„±ï¼Œå†³ç„¶ï¼ŒåšéŸ§</description>
    <pubDate>Sun, 17 Dec 2017 14:06:22 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Mac éŸ³é¢‘æ³¢å½¢å›¾â€”â€”æ’­æ”¾</title>
      <link>gofee.me/2017/11/20/draw-voice-wave-view-02/</link>
      <guid>gofee.me/2017/11/20/draw-voice-wave-view-02/</guid>
      <pubDate>Mon, 20 Nov 2017 09:55:34 GMT</pubDate>
      <description>
      
        &lt;h3 id=&quot;å¼€ç¯‡&quot;&gt;&lt;a href=&quot;#å¼€ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;å¼€ç¯‡&quot;&gt;&lt;/a&gt;å¼€ç¯‡&lt;/h3&gt;&lt;p&gt;æ’­æ”¾éŸ³é¢‘çš„æ•ˆæœå›¾ï¼š&lt;/p&gt;
&lt;img src=&quot;/2017/11/20/draw-voice-wave-view-02/playVoice.
      
      </description>
      
      <content:encoded><![CDATA[<h3 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h3><p>æ’­æ”¾éŸ³é¢‘çš„æ•ˆæœå›¾ï¼š</p>
<img src="/2017/11/20/draw-voice-wave-view-02/playVoice.gif" alt="æ•ˆæœå›¾" title="æ•ˆæœå›¾">
<h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><ol>
<li>ç°è‰²æ³¢å½¢åº•å›¾</li>
<li>æ’­æ”¾è¿‡ç¨‹ï¼Œç™½è‰²æ³¢å½¢è¦†ç›–</li>
</ol>
<h3 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><p>ç°è‰²æ³¢å½¢åº•å›¾æ˜¯å›ºå®šçš„ï¼Œå¯ç›´æ¥ç”¨å›¾å±‚ç»˜åˆ¶</p>
<p>1ã€æ³¢å½¢çš„è·¯å¾„è®¡ç®—ä¸ä¸Šç¯‡ç±»ä¼¼</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//æ³¢å½¢è·¯å¾„</span></div><div class="line">- (<span class="built_in">CGPathRef</span>)pathWithPoints:(<span class="built_in">NSArray</span> *)points&#123;</div><div class="line">    <span class="built_in">CGFloat</span> midY = <span class="built_in">NSHeight</span>(<span class="keyword">self</span>.bounds) / <span class="number">2.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> leftX = <span class="built_in">NSMaxX</span>(playBtnRect);</div><div class="line">    </div><div class="line">    <span class="built_in">CGMutablePathRef</span> wavePath = <span class="built_in">CGPathCreateMutable</span>();                 <span class="comment">//ç»˜åˆ¶è·¯å¾„</span></div><div class="line">    <span class="built_in">CGPathMoveToPoint</span>(wavePath, <span class="literal">nil</span>, leftX, midY);</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; _pointArray.count; i++) &#123;</div><div class="line">        <span class="built_in">NSValue</span> *pointValue = _pointArray[i];</div><div class="line">        <span class="built_in">NSPoint</span> point = pointValue.pointValue;</div><div class="line">        <span class="keyword">if</span> (point.y == <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">CGPathMoveToPoint</span>(wavePath, <span class="literal">nil</span>, leftX + i - <span class="number">1</span>, midY);</div><div class="line">            <span class="built_in">CGPathAddLineToPoint</span>(wavePath, <span class="literal">NULL</span>, leftX + i, midY);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">CGPathMoveToPoint</span>(wavePath, <span class="literal">nil</span>, leftX + i, midY);</div><div class="line">            <span class="built_in">CGPathAddLineToPoint</span>(wavePath, <span class="literal">NULL</span>, leftX + i, midY + point.y);</div><div class="line">            <span class="built_in">CGPathMoveToPoint</span>(wavePath, <span class="literal">nil</span>, leftX + i, midY);</div><div class="line">            <span class="built_in">CGPathAddLineToPoint</span>(wavePath, <span class="literal">NULL</span>, leftX + i, midY - point.y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">CGPathRef</span> path = <span class="built_in">CGPathCreateCopy</span>(wavePath);</div><div class="line">    <span class="built_in">CGPathRelease</span>(wavePath);</div><div class="line">    <span class="keyword">return</span> path;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»˜åˆ¶ç°è‰²æ³¢å½¢</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//æ·»åŠ å®Œæ•´æ³¢å½¢å›¾å±‚</span></div><div class="line">- (<span class="keyword">void</span>)addWaveLayerWithPath:(<span class="built_in">CGPathRef</span>)wavePath&#123;</div><div class="line">    <span class="built_in">CAShapeLayer</span> *shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</div><div class="line">    shapeLayer.lineWidth=<span class="number">1</span>;</div><div class="line">    shapeLayer.strokeColor=[<span class="built_in">NSColor</span> lightGrayColor].CGColor;</div><div class="line">    shapeLayer.lineCap = kCALineCapRound;</div><div class="line">    shapeLayer.lineJoin = kCALineJoinRound;</div><div class="line">    [<span class="keyword">self</span>.layer addSublayer:shapeLayer];</div><div class="line">    shapeLayer.path = wavePath;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2ã€æ’­æ”¾å›¾å±‚ï¼Œä½¿ç”¨CAShapeLayerå®ç°ï¼ŒCAShapeLayeræ˜¯å”¯ä¸€ä¸€ä¸ªå¯åŠ¨ç”»æ•ˆæœçš„å›¾å±‚äº†</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">//æ·»åŠ æ’­æ”¾åŠ¨ç”»å›¾å±‚</span></div><div class="line">- (<span class="keyword">void</span>)addAnimationLayerWithPath:(<span class="built_in">CGPathRef</span>)path&#123;</div><div class="line">    animationLayer = [<span class="built_in">CAShapeLayer</span> layer];</div><div class="line">    animationLayer.path = path;</div><div class="line">    animationLayer.lineWidth = <span class="number">1</span>;</div><div class="line">    animationLayer.strokeColor=[<span class="built_in">NSColor</span> whiteColor].CGColor;</div><div class="line">    animationLayer.lineCap = kCALineCapRound;</div><div class="line">    animationLayer.lineJoin = kCALineJoinRound;</div><div class="line">    [<span class="keyword">self</span>.layer addSublayer:animationLayer];</div><div class="line">    </div><div class="line">    animationLayer.speed = <span class="number">0</span>;   <span class="comment">//ç¦æ­¢åŠ¨ç”»æ‰§è¡Œ</span></div><div class="line">    animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"strokeEnd"</span>];</div><div class="line">    animation.duration = _playDuration;</div><div class="line">    animation.fromValue = @(<span class="number">0.0</span>f);</div><div class="line">    animation.toValue = @(<span class="number">1.0</span>f);</div><div class="line">    animation.delegate = <span class="keyword">self</span>;</div><div class="line">    [animationLayer addAnimation:animation forKey:<span class="string">@""</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>animationLayer.speed</code>è®¾ä¸º0ï¼Œå³åŠ¨ç”»é€Ÿåº¦ä¸º0ï¼Œä¹Ÿå°±æ˜¯ä¸æ‰§è¡Œã€‚</p>
<p><code>@&quot;strokeEnd&quot;</code>æ˜¯è·¯å¾„çš„ç»“æŸç‚¹ï¼Œå§‹äº0ï¼Œæ­¢äº1ï¼Œå½“åŠ¨ç”»å¼€å§‹æ‰§è¡Œï¼Œå°±èƒ½çœ‹åˆ°ç»˜åˆ¶è¿‡ç¨‹äº†ã€‚</p>
<p>3ã€æ’­æ”¾çš„å¼€å§‹ã€æš‚åœã€ç»§ç»­ã€åœæ­¢</p>
<p>å¯¹åŠ¨ç”»çš„æ§åˆ¶ï¼Œä¸»è¦æ˜¯å¯¹<code>speed</code> ã€<code>timeOffset</code>ã€<code>beginTime</code>ç­‰å±æ€§çš„è®¾ç½®ã€‚</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)play&#123;</div><div class="line">    [<span class="keyword">self</span> resume];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)pause&#123;</div><div class="line">    _playing = <span class="literal">NO</span>;</div><div class="line">    [<span class="keyword">self</span> setNeedsDisplay:<span class="literal">YES</span>];</div><div class="line">    </div><div class="line">    <span class="built_in">CFTimeInterval</span> pausedTime = [animationLayer convertTime:<span class="built_in">CACurrentMediaTime</span>() fromLayer:<span class="literal">nil</span>];</div><div class="line">    animationLayer.speed = <span class="number">0</span>;</div><div class="line">    animationLayer.timeOffset = pausedTime;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)resume&#123;</div><div class="line">    _playing = <span class="literal">YES</span>;</div><div class="line">    [<span class="keyword">self</span> setNeedsDisplay:<span class="literal">YES</span>];</div><div class="line">    </div><div class="line">    <span class="built_in">CFTimeInterval</span> pausedTime = [animationLayer timeOffset];</div><div class="line">    animationLayer.speed = <span class="number">1.0</span>;</div><div class="line">    animationLayer.timeOffset = <span class="number">0.0</span>;</div><div class="line">    animationLayer.beginTime = <span class="number">0</span>;</div><div class="line">    <span class="built_in">CFTimeInterval</span> timeSincePause = [animationLayer convertTime:<span class="built_in">CACurrentMediaTime</span>() fromLayer:<span class="literal">nil</span>] - pausedTime;</div><div class="line">    animationLayer.beginTime = timeSincePause;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)stop&#123;</div><div class="line">    _playing = <span class="literal">NO</span>;</div><div class="line">    [<span class="keyword">self</span> setNeedsDisplay:<span class="literal">YES</span>];</div><div class="line"></div><div class="line">    animationLayer.timeOffset = <span class="number">0</span>;</div><div class="line">    animationLayer.speed = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//åŠ¨ç”»æ’­æ”¾å®Œæˆåï¼Œé»˜è®¤è‡ªåŠ¨removed</span></div><div class="line">    [animationLayer addAnimation:animation forKey:<span class="string">@""</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Demo åœ°å€ï¼š<a href="https://github.com/YunFei2015/AudioWaveAnimation.git" target="_blank" rel="external">https://github.com/YunFei2015/AudioWaveAnimation.git</a></p>
]]></content:encoded>
      
      <comments>gofee.me/2017/11/20/draw-voice-wave-view-02/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Mac å½•åˆ¶éŸ³é¢‘ï¼Œæ³¢å½¢å›¾çš„ç»˜åˆ¶</title>
      <link>gofee.me/2017/11/08/draw-voice-wave-view/</link>
      <guid>gofee.me/2017/11/08/draw-voice-wave-view/</guid>
      <pubDate>Wed, 08 Nov 2017 14:05:34 GMT</pubDate>
      <description>
      
        &lt;h3 id=&quot;å¼€ç¯‡&quot;&gt;&lt;a href=&quot;#å¼€ç¯‡&quot; class=&quot;headerlink&quot; title=&quot;å¼€ç¯‡&quot;&gt;&lt;/a&gt;å¼€ç¯‡&lt;/h3&gt;&lt;p&gt;åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šæ•ˆæœå›¾ã€‚&lt;/p&gt;
&lt;img src=&quot;/2017/11/08/draw-voice-wave-view/animation.
      
      </description>
      
      <content:encoded><![CDATA[<h3 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h3><p>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šæ•ˆæœå›¾ã€‚</p>
<img src="/2017/11/08/draw-voice-wave-view/animation.gif" alt="æ•ˆæœå›¾" title="æ•ˆæœå›¾">
<p>ä¸Šé¢ä¸€é—ªä¸€é—ªçš„å¤§æ¦‚æ˜¯æ²¡å½•å¥½å§ã€‚ğŸ™„</p>
<h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>é¦–å…ˆåˆ†æè¿™æ®µåŠ¨ç”»çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼šç‚¹å‡»å›¾æ ‡åï¼Œå›¾æ ‡åƒæ³¡æ³¡ä¸€æ ·æ”¶ç¼©æ”¾å¤§ï¼›</li>
<li>ç¬¬äºŒé˜¶æ®µï¼šå›¾æ ‡ç¼©å°ï¼ŒåŒæ—¶å‘ä¸‹æ–¹ç§»åŠ¨ï¼›</li>
<li>ç¬¬ä¸‰é˜¶æ®µï¼šæ³¢å½¢å›¾ç»˜åˆ¶ï¼Œéšç€æ•°æ®çš„å¢å¤šï¼Œæ³¢å½¢å›¾å‘å·¦ç§»åŠ¨ï¼ŒåŒæ—¶è§†å›¾çš„å®½åº¦è¶Šæ¥è¶Šé•¿</li>
<li>ç¬¬å››é˜¶æ®µï¼šè§†å›¾å®½åº¦è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼åä¸å†å¢å¤§ï¼Œæ³¢å½¢å›¾ç»§ç»­å‘å·¦ç§»åŠ¨ï¼Œè¶…å‡ºå·¦ä¾§èŒƒå›´çš„éƒ¨åˆ†ä¸å†æ˜¾ç¤ºã€‚</li>
</ul>
<p>PS. æ³¢å½¢å›¾æ˜¯ä¸Šä¸‹å¯¹ç§°çš„å“¦ã€‚</p>
<h3 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h3><p>é¦–å…ˆçœ‹åŠ¨ç”»ï¼Œå‰ä¸¤ä¸ªé˜¶æ®µçš„åŠ¨ç”»æœ‰å…ˆåé¡ºåºï¼Œç¬¬äºŒé˜¶æ®µçš„ä¸¤ä¸ªåŠ¨ç”»åŒæ—¶å‘ç”Ÿï¼Œå¯ä»¥ç”¨åŠ¨ç”»ç»„æ¥åšã€‚</p>
<p>ç„¶åï¼Œç¬¬äºŒã€ç¬¬ä¸‰é˜¶æ®µä¹‹é—´çš„èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å›¾æ ‡åˆšå¥½ç¼©å°åˆ°æ³¢å½¢è§†å›¾çš„é«˜åº¦åï¼Œæ³¢å½¢è§†å›¾å‡ºç°ï¼Œå¦‚æœåˆ†ä¸ºä¸¤ä¸ªè§†å›¾ï¼Œæ€»æœ‰ä¸€ä¸ªç”Ÿç¡¬çš„è¿‡æ¸¡è¿‡ç¨‹ï¼Œä¸ºäº†è¾¾åˆ°ä¸€ä¸ªæµç•…çš„è§†è§‰æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè§†å›¾æ¥åšã€‚</p>
<p>æœ€åï¼Œä»”ç»†çœ‹æ³¢å½¢å›¾ï¼Œæ–°æ•°æ®æ˜¯ä»å³ä¾§è¿›å…¥çš„ï¼Œç”±äºè¿™æ˜¯ä¸ªå½•éŸ³çš„è¿‡ç¨‹ï¼Œå› æ­¤æ•°æ®æ˜¯åœ¨ä¸æ–­å¢å¤šçš„ï¼Œå¯ä»¥ç”¨å®æ—¶ç»˜å›¾æ¥å®ç°ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸Šè‡ªå®šä¹‰ button çš„ä»£ç ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€é˜¶æ®µ ~ ç¬¬äºŒé˜¶æ®µ</p>
<figure class="highlight objc"><figcaption><span>VoiceRecordButton.m </span></figcaption><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)startAnimation&#123;</div><div class="line">    <span class="keyword">self</span>.enabled = <span class="literal">NO</span>;  <span class="comment">//åŠ¨ç”»è¿‡ç¨‹ä¸­ç¦ç”¨</span></div><div class="line">    [<span class="keyword">self</span> moveAnchorPointToCenter];   <span class="comment">//å°†é”šç‚¹ç§»åˆ°ä¸­å¿ƒ (ä¸ºäº†è¾¾åˆ°å›´ç»•ä¸­å¿ƒç¼©æ”¾çš„æ•ˆæœ)</span></div><div class="line">    </div><div class="line">    <span class="comment">//æ”¾å¤§</span></div><div class="line">    <span class="built_in">CAKeyframeAnimation</span> *scaleToBigAnimation = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"transform.scale"</span>];</div><div class="line">    scaleToBigAnimation.values = @[@(<span class="number">1.0</span>), @(<span class="number">.7</span>f), @(<span class="number">1.</span>f), @(<span class="number">1.3</span>f), @(<span class="number">1.7</span>f)];   <span class="comment">//å…ˆä»1.0ç¼©å°åˆ°0.7ï¼Œå†æ”¾å¤§åˆ°1.7ï¼Œè¿™æ ·å°±å®ç°äº†æ³¡æ³¡æ•ˆæœ</span></div><div class="line">    scaleToBigAnimation.duration = <span class="number">0.5</span>;</div><div class="line">    scaleToBigAnimation.beginTime = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//ç¼©å°</span></div><div class="line">    <span class="built_in">CAKeyframeAnimation</span> *scaleAnimation = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"transform.scale"</span>];</div><div class="line">    scaleAnimation.values = @[@(<span class="number">1.7</span>f), @(<span class="number">1</span>)];</div><div class="line">    scaleAnimation.duration = <span class="number">0.75</span>;</div><div class="line">    scaleAnimation.beginTime = scaleToBigAnimation.beginTime + scaleToBigAnimation.duration;</div><div class="line">    </div><div class="line">    <span class="comment">//ä½ç½®ä¸‹ç§»ï¼Œä¸ç¼©å°åŠ¨ç”»åŒæ—¶è¿›è¡Œ</span></div><div class="line">    <span class="built_in">CABasicAnimation</span> *positionAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position.y"</span>];</div><div class="line">    positionAnimation.toValue = @(<span class="keyword">self</span>.layer.position.y - <span class="built_in">NSWidth</span>(<span class="keyword">self</span>.frame));</div><div class="line">    positionAnimation.duration = scaleAnimation.duration;</div><div class="line">    positionAnimation.beginTime = scaleAnimation.beginTime;</div><div class="line">    </div><div class="line">    <span class="comment">//æ·»åŠ åŠ¨ç”»ç»„</span></div><div class="line">    <span class="built_in">CAAnimationGroup</span> *animationGroup = [<span class="built_in">CAAnimationGroup</span> animation];</div><div class="line">    animationGroup.delegate = <span class="keyword">self</span>;</div><div class="line">    animationGroup.duration = scaleToBigAnimation.duration + positionAnimation.duration;</div><div class="line">    [animationGroup setValue:<span class="string">@"animationGroup"</span> forKey:<span class="string">@"AnimationKey"</span>];</div><div class="line">    animationGroup.animations = @[scaleToBigAnimation, scaleAnimation, positionAnimation];</div><div class="line">    [<span class="keyword">self</span>.layer addAnimation:animationGroup forKey:<span class="string">@"animationGroup"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>VoiceRecordButton.m</span></figcaption><table><tr><td class="code"><pre><div class="line">- (void)moveAnchorPointToCenter&#123;</div><div class="line">    //ç”±äºå›¾å±‚é”šç‚¹é»˜è®¤æ˜¯åœ¨åŸç‚¹(0,0)ï¼Œéœ€è¦è®©å›¾å±‚å›´ç»•ä¸­å¿ƒç‚¹ç¼©æ”¾</div><div class="line">    self.layer.anchorPoint = CGPointMake(0.5, 0.5);</div><div class="line">    </div><div class="line">    //é”šç‚¹æ”¹å˜åï¼Œä¸ºäº†è®©å›¾å±‚éšç€è§†å›¾ç§»åŠ¨ï¼Œå°†å›¾å±‚çš„ä½ç½®ä¹Ÿæ”¹åˆ°é”šç‚¹çš„ä½ç½®</div><div class="line">    NSRect rect = self.frame;</div><div class="line">    CGFloat centerX = rect.origin.x + rect.size.width / 2.f;</div><div class="line">    CGFloat centerY = rect.origin.y + rect.size.height / 2.f;</div><div class="line">    self.layer.position = CGPointMake(centerX, centerY);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)resumeAnchorPoint&#123;</div><div class="line">    self.layer.anchorPoint = CGPointZero;</div><div class="line">    self.layer.position = self.frame.origin;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åŠ¨ç”»ç»“æŸåï¼Œåœ¨ä»£ç†é‡Œè§¦å‘ä¸‹ä¸€æ­¥æ“ä½œã€‚</p>
<figure class="highlight plain"><figcaption><span>VoiceRecordButton.m</span></figcaption><table><tr><td class="code"><pre><div class="line">#pragma mark - CAAnimation delegate</div><div class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag&#123;</div><div class="line">    if (flag) &#123;</div><div class="line">        if ([self.delegate respondsToSelector:@selector(voiceRecordingWillBegin)]) &#123;</div><div class="line">          	//æ‰§è¡Œä»£ç†æ–¹æ³•ï¼Œå‡†å¤‡æ•°æ®</div><div class="line">            [self.delegate voiceRecordingWillBegin];</div><div class="line">        &#125;</div><div class="line">        [self resumeAnchorPoint];</div><div class="line">        [self startRecording];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ç¬¬ä¸‰é˜¶æ®µ ~ ç¬¬å››é˜¶æ®µ</p>
<p>æœ¬æ–‡ demo é‡Œæ‰€æœ‰çš„éŸ³é¢‘æ•°æ®éƒ½æ˜¯éšæœºç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®ï¼Œä¹Ÿæ²¡æœ‰å®ç°çœŸæ­£çš„å½•éŸ³å“ˆã€‚</p>
<p>æ§åˆ¶å™¨åœ¨ voiceRecordingWillBegin è¿™ä¸ªæ–¹æ³•é‡Œï¼Œå‡†å¤‡éœ€è¦ç»˜åˆ¶çš„æ•°æ®ã€‚</p>
<figure class="highlight objc"><figcaption><span>ViewController.m</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="meta">#pragma mark - voice recording button delegate</span></div><div class="line"><span class="comment">//å½•éŸ³å³å°†å¼€å§‹</span></div><div class="line">- (<span class="keyword">void</span>)voiceRecordingWillBegin&#123;</div><div class="line">  	<span class="comment">//ä¹‹å‰çš„åŠ¨ç”»åªæ˜¯å›¾å±‚åŠ¨ç”»ï¼Œå›¾å±‚å·²ç»åˆ°äº†ç›®æ ‡ä½ç½®ï¼Œä½†è§†å›¾çš„ frame è¿˜åœ¨åŸæ¥çš„ä½ç½®ï¼Œå› æ­¤è¦ä¿®æ”¹è§†å›¾çš„ä½ç½®å’Œå°ºå¯¸</span></div><div class="line">    <span class="built_in">NSRect</span> frame = <span class="keyword">self</span>.voiceRecordBtn.frame;</div><div class="line">    <span class="built_in">CGFloat</span> centerX = frame.origin.x + frame.size.width / <span class="number">2.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> centerY = frame.origin.y + frame.size.height / <span class="number">2.</span>f - frame.size.height;</div><div class="line">    frame.size.width = <span class="number">400</span>; <span class="comment">//è¿™æ˜¯è“è‰²æ³¢å½¢å›¾çš„æœ€å¤§å®½åº¦</span></div><div class="line">    frame.origin.x = centerX - frame.size.width / <span class="number">2.</span>f;</div><div class="line">    frame.origin.y = centerY - frame.size.height / <span class="number">2.</span>f;</div><div class="line">    <span class="keyword">self</span>.voiceRecordBtn.frame = frame;</div><div class="line">    </div><div class="line">  	<span class="comment">//æ·»åŠ è®¡æ—¶å™¨ï¼Œæ„é€ æ¨¡æ‹Ÿæ•°æ®</span></div><div class="line">    [<span class="keyword">self</span> addTimer];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)addTimer&#123;</div><div class="line">    <span class="comment">//æ·»åŠ å®šæ—¶å™¨</span></div><div class="line">    _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">.1</span>f target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(addPoint) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</div><div class="line"></div><div class="line">    [[<span class="built_in">NSRunLoop</span> mainRunLoop] addTimer:_timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)addPoint</div><div class="line">&#123;</div><div class="line">    <span class="comment">//éšæœºç‚¹</span></div><div class="line">     <span class="built_in">NSPoint</span> point = <span class="built_in">NSMakePoint</span>(<span class="keyword">self</span>.voiceRecordBtn.bounds.size.height / <span class="number">2.</span>f, arc4random_uniform(<span class="built_in">NSHeight</span>(<span class="keyword">self</span>.voiceRecordBtn.frame) / <span class="number">4.</span>f) + <span class="number">0</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//æ’å…¥åˆ°æ•°ç»„ï¼ˆåŠ¨ç”»è§†å›¾æœ€å³è¾¹ï¼‰ï¼Œarrayæ·»åŠ CGPointéœ€è¦è½¬æ¢ä¸€ä¸‹</span></div><div class="line"><span class="comment">//    [self.pointArray insertObject:[NSValue valueWithPoint:point] atIndex:0];</span></div><div class="line">    [<span class="keyword">self</span>.pointArray addObject:[<span class="built_in">NSValue</span> valueWithPoint:point]];</div><div class="line">    </div><div class="line">    <span class="comment">//ä¼ å€¼ï¼Œé‡ç»˜è§†å›¾</span></div><div class="line">    <span class="keyword">self</span>.voiceRecordBtn.pointArray = <span class="keyword">self</span>.pointArray;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å›åˆ°è‡ªå®šä¹‰æŒ‰é’®çš„.m æ–‡ä»¶</p>
<p>ç‚¹æ•°ç»„çš„ setter æ–¹æ³•</p>
<figure class="highlight objc"><figcaption><span>VoiceRecordButton.m</span></figcaption><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setPointArray:(<span class="built_in">NSArray</span> *)pointArray&#123;</div><div class="line">    _pointArray = pointArray;</div><div class="line">    [<span class="keyword">self</span> setNeedsDisplay:<span class="literal">YES</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¼€å§‹å½•éŸ³</p>
<figure class="highlight plain"><figcaption><span>VoiceRecordButton.m</span></figcaption><table><tr><td class="code"><pre><div class="line">- (void)startRecording&#123;</div><div class="line">    self.talking = YES;</div><div class="line">    [self setNeedsDisplay:YES];</div><div class="line">    </div><div class="line">    //å»¶è¿Ÿ_recordingDurationæ‰§è¡Œï¼Œè‹¥æ²¡æœ‰æ‰‹åŠ¨åœæ­¢ï¼Œåˆ™è‡ªåŠ¨åœæ­¢å½•éŸ³</div><div class="line">    [self performSelector:@selector(stopRecording) withObject:nil afterDelay:_recordingDuration];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœæ­¢å½•éŸ³</p>
<figure class="highlight plain"><figcaption><span>VoiceRecordButton.m</span></figcaption><table><tr><td class="code"><pre><div class="line">- (void)stopRecording&#123;</div><div class="line">    //å–æ¶ˆå»¶è¿Ÿæ‰§è¡Œ</div><div class="line">    [NSObject cancelPreviousPerformRequestsWithTarget:self selector:@selector(stopRecording) object:nil];</div><div class="line">    </div><div class="line">    self.enabled = YES;</div><div class="line">    self.frame = self.initialFrame; //å½•éŸ³ç»“æŸåï¼ŒæŒ‰é’®å›åˆ°ç‚¹å‡»å‰çš„åˆå§‹çŠ¶æ€</div><div class="line">    self.talking = NO;</div><div class="line">    </div><div class="line">    [self setNeedsDisplay:YES];</div><div class="line">    </div><div class="line">    if ([self.delegate respondsToSelector:@selector(voiceRecordingDidFinish)]) &#123;</div><div class="line">        [self.delegate voiceRecordingDidFinish];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯é‡å¤´æˆäº†ï¼Œæ¯æ¬¡è°ƒç”¨<code>[self setNeedsDisplay:YES]</code>æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨<code>drawRect:(NSRect)dirtyRect</code> æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•é‡Œç»˜åˆ¶æ•°æ®ã€‚</p>
<figure class="highlight objc"><figcaption><span>VoiceRecordButton.m</span></figcaption><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">NSRect</span>)dirtyRect&#123;</div><div class="line">    [<span class="keyword">super</span> drawRect:dirtyRect];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.talking) &#123;</div><div class="line">        <span class="comment">//ç°åœ¨æ²¡æœ‰åœ¨å½•éŸ³ï¼Œå³åˆå§‹çŠ¶æ€</span></div><div class="line">        <span class="built_in">NSBezierPath</span> *rectPath = [<span class="built_in">NSBezierPath</span> bezierPathWithOvalInRect:dirtyRect];</div><div class="line">        [[<span class="built_in">NSColor</span> blueColor] setFill];</div><div class="line">        [rectPath fill];</div><div class="line">        </div><div class="line">        <span class="built_in">NSImage</span> *image = [<span class="built_in">NSImage</span> imageNamed:<span class="string">@"SideAudio"</span>];</div><div class="line">        [image drawInRect:dirtyRect];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> midY = <span class="built_in">NSHeight</span>(dirtyRect) / <span class="number">2.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> midX = <span class="built_in">NSWidth</span>(dirtyRect) / <span class="number">2.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> leftX = midX - _pointArray.count / <span class="number">2.</span>f - _initialWidth / <span class="number">2.</span>f;</div><div class="line">    <span class="built_in">CGFloat</span> rightX = midX + _pointArray.count / <span class="number">2.</span>f + _initialWidth / <span class="number">2.</span>f;</div><div class="line">    </div><div class="line">    <span class="comment">// Drawing code here.</span></div><div class="line">    <span class="built_in">CGContextRef</span> ctx = [[<span class="built_in">NSGraphicsContext</span> currentContext] graphicsPort];</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶åˆå§‹çº¿å‹ï¼Œæ¨¡æ‹Ÿä¸€èˆ¬å½•éŸ³åœºæ™¯ï¼Œåˆšå¼€å§‹å¯èƒ½æ²¡æœ‰è¯´è¯ï¼Œä¸€æ¡æ¨ªçº¿</span></div><div class="line">    <span class="built_in">CGMutablePathRef</span> linePath = <span class="built_in">CGPathCreateMutable</span>();</div><div class="line">    <span class="built_in">CGPathMoveToPoint</span>(linePath, <span class="literal">nil</span>, leftX, midY);</div><div class="line">    <span class="built_in">CGPathAddLineToPoint</span>(linePath, <span class="literal">nil</span>, leftX + _initialWidth, midY);	<span class="comment">//_initialWidth æ¨ªçº¿çš„å®½åº¦ï¼Œè¿™é‡Œç»™äº†ä¸ªå›ºå®šå€¼</span></div><div class="line">    <span class="built_in">CGContextAddPath</span>(ctx, linePath);</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶ä¸ŠåŠéƒ¨åˆ†æ³¢å½¢</span></div><div class="line">    <span class="built_in">CGMutablePathRef</span> halfPath = <span class="built_in">CGPathCreateMutable</span>();                 <span class="comment">//ç»˜åˆ¶è·¯å¾„</span></div><div class="line">    <span class="built_in">CGPathMoveToPoint</span>(halfPath, <span class="literal">nil</span>, <span class="built_in">NSWidth</span>(dirtyRect), midY);</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; _pointArray.count; i++) &#123;</div><div class="line">        <span class="built_in">NSValue</span> *pointValue = _pointArray[i];</div><div class="line">        <span class="built_in">NSPoint</span> point = pointValue.pointValue;</div><div class="line">        <span class="built_in">NSInteger</span> j = _pointArray.count - i - <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (point.y == <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">CGPathMoveToPoint</span>(halfPath, <span class="literal">nil</span>, rightX - j + <span class="number">1</span>, midY);</div><div class="line">            <span class="built_in">CGPathAddLineToPoint</span>(halfPath, <span class="literal">NULL</span>, rightX - j, midY);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">CGPathMoveToPoint</span>(halfPath, <span class="literal">nil</span>, rightX - j, midY);</div><div class="line">            <span class="built_in">CGPathAddLineToPoint</span>(halfPath, <span class="literal">NULL</span>, rightX - j, midY + point.y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//å®ç°æ³¢å½¢å›¾åè½¬</span></div><div class="line">    <span class="built_in">CGMutablePathRef</span> fullPath = <span class="built_in">CGPathCreateMutable</span>();<span class="comment">//åˆ›å»ºæ–°è·¯å¾„</span></div><div class="line">    <span class="built_in">CGPathAddPath</span>(fullPath, <span class="literal">NULL</span>, halfPath);          <span class="comment">//åˆå¹¶è·¯å¾„</span></div><div class="line">    <span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformIdentity</span>; <span class="comment">//åè½¬</span></div><div class="line">    <span class="comment">//åè½¬é…ç½®</span></div><div class="line">    transform = <span class="built_in">CGAffineTransformTranslate</span>(transform, <span class="number">0</span>, <span class="built_in">NSHeight</span>(dirtyRect));</div><div class="line">    transform = <span class="built_in">CGAffineTransformScale</span>(transform, <span class="number">1.0</span>, <span class="number">-1.0</span>);</div><div class="line">    <span class="built_in">CGPathAddPath</span>(fullPath, &amp;transform, halfPath);</div><div class="line">    </div><div class="line">    <span class="comment">//å°†è·¯å¾„æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­</span></div><div class="line">    <span class="built_in">CGContextAddPath</span>(ctx, fullPath);</div><div class="line">    </div><div class="line">    <span class="comment">//ç»˜åˆ¶çŸ©å½¢åŒºåŸŸï¼Œå³ä¸æ–­å˜é•¿çš„è“è‰²èƒŒæ™¯</span></div><div class="line">    <span class="built_in">CGMutablePathRef</span> rectPath = <span class="built_in">CGPathCreateMutable</span>();</div><div class="line">    <span class="built_in">CGPathMoveToPoint</span>(rectPath, <span class="literal">nil</span>, leftX, <span class="number">0</span>);</div><div class="line">    <span class="built_in">CGPathAddRoundedRect</span>(rectPath, <span class="literal">nil</span>, <span class="built_in">CGRectMake</span>(leftX, <span class="number">0</span>, _pointArray.count + _initialWidth, <span class="built_in">NSHeight</span>(dirtyRect)), <span class="built_in">NSHeight</span>(dirtyRect) / <span class="number">2.</span>f, <span class="built_in">NSHeight</span>(dirtyRect) / <span class="number">2.</span>f);</div><div class="line">    <span class="built_in">CGContextAddPath</span>(ctx, rectPath);</div><div class="line">    </div><div class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">1</span>);</div><div class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">NSColor</span> whiteColor].CGColor);</div><div class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, [<span class="built_in">NSColor</span> blueColor].CGColor);</div><div class="line">    <span class="built_in">CGContextDrawPath</span>(ctx, kCGPathFillStroke);</div><div class="line">    </div><div class="line">    <span class="comment">//ç§»é™¤</span></div><div class="line">    <span class="built_in">CGPathRelease</span>(halfPath);</div><div class="line">    <span class="built_in">CGPathRelease</span>(fullPath);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>ç»“æŸï¼Œæ˜å¤©æ”¾æ’­æ”¾å½•éŸ³çš„åŠ¨ç”»å®ç°ã€‚</p>
<p>Demo åœ°å€ï¼š<a href="https://github.com/YunFei2015/AudioWaveAnimation.git" target="_blank" rel="external">https://github.com/YunFei2015/AudioWaveAnimation.git</a></p>
]]></content:encoded>
      
      <comments>gofee.me/2017/11/08/draw-voice-wave-view/#disqus_thread</comments>
    </item>
    
    <item>
      <title>å…³äºstoryboardä¸å¾—ä¸è¯´çš„äº‹</title>
      <link>gofee.me/2017/05/05/storyboard-loading/</link>
      <guid>gofee.me/2017/05/05/storyboard-loading/</guid>
      <pubDate>Fri, 05 May 2017 03:39:02 GMT</pubDate>
      <description>
      
        &lt;p&gt;è‡ª iOS 5 æ—¶ä»£è‹¹æœæ¨å‡º Storyboardï¼ˆä»¥ä¸‹ç®€ç§°SBï¼‰ä»¥æ¥ï¼Œå…³äºä½¿ç”¨ä»£ç æ‰‹å†™ UIã€SB å’Œ xib ä¹‹é—´çš„äº‰è®ºå°±ä¸€ç›´å­˜åœ¨ã€‚é—®é¢˜ä¸»è¦åœ¨äº Storyboard çš„åŠ è½½è¿‡ç¨‹æ˜¯å¦ä¼šå½±å“æ€§èƒ½ï¼Œä¸‹é¢å°±åˆ†æä¸€ä¸‹ Storyboard ä¸­çš„ ViewController æ˜¯
      
      </description>
      
      <content:encoded><![CDATA[<p>è‡ª iOS 5 æ—¶ä»£è‹¹æœæ¨å‡º Storyboardï¼ˆä»¥ä¸‹ç®€ç§°SBï¼‰ä»¥æ¥ï¼Œå…³äºä½¿ç”¨ä»£ç æ‰‹å†™ UIã€SB å’Œ xib ä¹‹é—´çš„äº‰è®ºå°±ä¸€ç›´å­˜åœ¨ã€‚é—®é¢˜ä¸»è¦åœ¨äº Storyboard çš„åŠ è½½è¿‡ç¨‹æ˜¯å¦ä¼šå½±å“æ€§èƒ½ï¼Œä¸‹é¢å°±åˆ†æä¸€ä¸‹ Storyboard ä¸­çš„ ViewController æ˜¯æ€ä¹ˆåŠ è½½å‡ºæ¥çš„ã€‚</p>
<p>ç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ Xcode æœ‰ä¸ª Compiling Storyboard files çš„è¿‡ç¨‹ã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œé¡¹ç›®é‡Œç”¨åˆ°çš„ SB æ–‡ä»¶ä¹Ÿä¼šè¢«ç¼–è¯‘ï¼Œå¹¶ä»¥ <code>.storyboarc</code> ä¸ºæ‰©å±•åæœ€ç»ˆä¿å­˜åœ¨ APP åŒ…å†…ã€‚<code>.storyboardc</code> æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢ä¿å­˜äº†æè¿°ç¼–è¯‘åçš„ SB ä¿¡æ¯çš„ <code>Info.plist</code> æ–‡ä»¶ï¼Œä»¥åŠä¸€ç³»åˆ— <code>.nib</code> æ–‡ä»¶ã€‚åŸæ¥çš„ SB ä¸­çš„æ¯ä¸ªå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸ª ViewControllerï¼‰å°†ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„ <code>.nib</code>ï¼Œ<code>.nib</code> ä¸­åŒ…å«äº†ç¼–ç åçš„å¯¹åº”çš„å¯¹è±¡å±‚çº§ã€‚åœ¨åŠ è½½ä¸€ä¸ª SBï¼Œå¹¶ä»ä¸­è¯»å– ViewController ç±»å‹å’Œ nib çš„å…³ç³»ï¼Œæ¥å®Œæˆ <code>UIStoryboard</code> çš„åˆå§‹åŒ–ã€‚æ¥ä¸‹æ¥è¯»å–æŸä¸ª nibï¼Œå¹¶ä½¿ç”¨<code>UINibDecoder</code> è¿›è¡Œè§£ç ï¼Œå°† nib äºŒè¿›åˆ¶è¿˜åŸä¸ºå®é™…çš„å¯¹è±¡ï¼Œæœ€åè°ƒç”¨è¯¥å¯¹è±¡çš„ <code>initWithCoderï¼š</code> å®Œæˆå„ä¸ªå±æ€§çš„è§£ç ã€‚æœ€åï¼Œè°ƒç”¨ <code>awakeFromNib</code> æ–¹æ³•ï¼Œæ¥é€šçŸ¥å¼€å‘è€…ä» nib çš„åŠ è½½å·²ç»å®Œæ¯•ã€‚</p>
<img src="/2017/05/05/storyboard-loading/storyboardçš„åŠ è½½è¿‡ç¨‹.png" alt="Storyboard çš„åŠ è½½è¿‡ç¨‹" title="Storyboard çš„åŠ è½½è¿‡ç¨‹">
<p>å¯ä»¥çœ‹å‡ºï¼Œä»åªæœ‰ä¸€ä¸ª ViewController çš„ SB ä¸­åŠ è½½è¿™ä¸ª VCï¼Œä¸ä»æœ‰å¤šä¸ª ViewController çš„ SB ä¸­åŠ è½½çš„æƒ…å†µï¼Œé€Ÿåº¦ä¸Šå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>åŸæ–‡ï¼š <a href="https://onevcat.com/2017/04/storyboard-argue/" target="_blank" rel="external">å†çœ‹å…³äº Storyboard çš„ä¸€äº›äº‰è®º</a></p>
]]></content:encoded>
      
      <comments>gofee.me/2017/05/05/storyboard-loading/#disqus_thread</comments>
    </item>
    
    <item>
      <title>AFNetworking README ä¸­æ–‡ç‰ˆ</title>
      <link>gofee.me/2017/01/25/AFNetworking-translate/</link>
      <guid>gofee.me/2017/01/25/AFNetworking-translate/</guid>
      <pubDate>Wed, 25 Jan 2017 12:23:15 GMT</pubDate>
      <description>
      
        &lt;h1 id=&quot;AFNetworking-README-ä¸­æ–‡ç‰ˆ&quot;&gt;&lt;a href=&quot;#AFNetworking-README-ä¸­æ–‡ç‰ˆ&quot; class=&quot;headerlink&quot; title=&quot;AFNetworking README ä¸­æ–‡ç‰ˆ&quot;&gt;&lt;/a&gt;AFNetworking READ
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="AFNetworking-README-ä¸­æ–‡ç‰ˆ"><a href="#AFNetworking-README-ä¸­æ–‡ç‰ˆ" class="headerlink" title="AFNetworking README ä¸­æ–‡ç‰ˆ"></a>AFNetworking README ä¸­æ–‡ç‰ˆ</h1><p>AFNetworkingæ˜¯iOSå’ŒMac OS Xå¹³å°ä¸Šçš„è½»é‡çº§ç½‘ç»œåº“ï¼Œåœ¨Foudation URLåŠ è½½ç³»ç»ŸåŸºç¡€ä¸Šæ„å»ºï¼Œå¯¹æ„å»ºäºCocoaçš„å¼ºå¤§é«˜çº§çš„ç½‘ç»œæŠ½è±¡è¿›è¡Œäº†æ‰©å……ã€‚å®ƒå…·æœ‰è®¾è®¡è‰¯å¥½çš„ã€å¯Œæœ‰ç‰¹æ€§çš„ã€æ¨¡å—åŒ–ç»“æ„çš„APIæ¥å£é›†ã€‚</p>
<h2 id="ä½“ç³»ç»“æ„"><a href="#ä½“ç³»ç»“æ„" class="headerlink" title="ä½“ç³»ç»“æ„"></a>ä½“ç³»ç»“æ„</h2><h3 id="NSURLSession-ä¼šè¯"><a href="#NSURLSession-ä¼šè¯" class="headerlink" title="NSURLSession ä¼šè¯"></a>NSURLSession ä¼šè¯</h3><ul>
<li>AFURLSessionManager</li>
<li>AFHTTPSessionManager</li>
</ul>
<h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><ul>
<li><code>&lt;AFURLRequestSerialization&gt;</code><ul>
<li>AFHTTPRequestSerializer</li>
<li>AFJSONRequestSerializer</li>
<li>AFPropertyListRequestSerializer</li>
</ul>
</li>
<li><code>&lt;AFURLResponseSerialization&gt;</code><ul>
<li>AFHTTPResponseSerializer</li>
<li>AFJSONResponseSerializer</li>
<li>AFXMLParserResponseSerializer</li>
<li>AFXMLDocumentResponseSerializer(Mac OS X)</li>
<li>AFPropertyListResponseSerializer</li>
<li>AFImageResponseSerializer</li>
<li>AFCompoundResponseSerializer</li>
</ul>
</li>
</ul>
<h3 id="å…¶ä»–åŠŸèƒ½"><a href="#å…¶ä»–åŠŸèƒ½" class="headerlink" title="å…¶ä»–åŠŸèƒ½"></a>å…¶ä»–åŠŸèƒ½</h3><ul>
<li>AFSecurityPolicy</li>
<li>AFNetworkReachabilityManager</li>
</ul>
<h2 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h2><h3 id="AFURLSessionManager"><a href="#AFURLSessionManager" class="headerlink" title="AFURLSessionManager"></a>AFURLSessionManager</h3><p><code>AFURLSessionManager</code>åœ¨ä¸€ä¸ªå®šä¹‰å¥½çš„<code>NSURLSessionConfiguration</code>å¯¹è±¡åŸºç¡€ä¸Šåˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ª<code>NSURLSession</code>å¯¹è±¡, <code>NSURLSessionConfiguration</code>éµå¾ª<code>&lt;NSURLSessionTaskDelegate&gt;</code>, <code>&lt;NSURLSessionDataDelegate&gt;</code>, <code>&lt;NSURLSessionDownloadDelegate&gt;</code>, <code>&lt;NSURLSessionDelegate&gt;</code>åè®®.</p>
<h4 id="åˆ›å»ºä¸€ä¸ªä¸‹è½½ä»»åŠ¡"><a href="#åˆ›å»ºä¸€ä¸ªä¸‹è½½ä»»åŠ¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªä¸‹è½½ä»»åŠ¡"></a>åˆ›å»ºä¸€ä¸ªä¸‹è½½ä»»åŠ¡</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</div><div class="line"><span class="built_in">NSURL</span> *URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://example.com/download.zip"</span>];</div><div class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:URL];</div><div class="line"><span class="built_in">NSURLSessionDownloadTask</span> *downloadTask = [manager downloadTaskWithRequest:request progress:<span class="literal">nil</span> destination:^<span class="built_in">NSURL</span> *(<span class="built_in">NSURL</span> *targetPath, <span class="built_in">NSURLResponse</span> *response) &#123;</div><div class="line">    <span class="built_in">NSURL</span> *documentsDirectoryURL = [[<span class="built_in">NSFileManager</span> defaultManager] URLForDirectory:<span class="built_in">NSDocumentDirectory</span> inDomain:<span class="built_in">NSUserDomainMask</span> appropriateForURL:<span class="literal">nil</span> create:<span class="literal">NO</span> error:<span class="literal">nil</span>];</div><div class="line">    <span class="keyword">return</span> [documentsDirectoryURL URLByAppendingPathComponent:[response suggestedFilename]];</div><div class="line">&#125; completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSURL</span> *filePath, <span class="built_in">NSError</span> *error) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"File downloaded to: %@"</span>, filePath);</div><div class="line">&#125;];</div><div class="line">[downloadTask resume];</div></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºä¸€ä¸ªä¸Šä¼ ä»»åŠ¡"><a href="#åˆ›å»ºä¸€ä¸ªä¸Šä¼ ä»»åŠ¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªä¸Šä¼ ä»»åŠ¡"></a>åˆ›å»ºä¸€ä¸ªä¸Šä¼ ä»»åŠ¡</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</div><div class="line"><span class="built_in">NSURL</span> *URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://example.com/upload"</span>];</div><div class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:URL];</div><div class="line"><span class="built_in">NSURL</span> *filePath = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="string">@"file://path/to/image.png"</span>];</div><div class="line"><span class="built_in">NSURLSessionUploadTask</span> *uploadTask = [manager uploadTaskWithRequest:request fromFile:filePath progress:<span class="literal">nil</span> completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> responseObject, <span class="built_in">NSError</span> *error) &#123;</div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>, error);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Success: %@ %@"</span>, response, responseObject);</div><div class="line">    &#125;</div><div class="line">&#125;];</div><div class="line">[uploadTask resume];</div></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºä¸€ä¸ªå¤šè¡¨å•è¯·æ±‚çš„ä¸Šä¼ ä»»åŠ¡ï¼Œå¸¦è¿›åº¦æ¡"><a href="#åˆ›å»ºä¸€ä¸ªå¤šè¡¨å•è¯·æ±‚çš„ä¸Šä¼ ä»»åŠ¡ï¼Œå¸¦è¿›åº¦æ¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå¤šè¡¨å•è¯·æ±‚çš„ä¸Šä¼ ä»»åŠ¡ï¼Œå¸¦è¿›åº¦æ¡"></a>åˆ›å»ºä¸€ä¸ªå¤šè¡¨å•è¯·æ±‚çš„ä¸Šä¼ ä»»åŠ¡ï¼Œå¸¦è¿›åº¦æ¡</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSMutableURLRequest</span> *request = [[AFHTTPRequestSerializer serializer] multipartFormRequestWithMethod:<span class="string">@"POST"</span> URLString:<span class="string">@"http://example.com/upload"</span> parameters:<span class="literal">nil</span> constructingBodyWithBlock:^(<span class="keyword">id</span>&lt;AFMultipartFormData&gt; formData) &#123;</div><div class="line">        [formData appendPartWithFileURL:[<span class="built_in">NSURL</span> fileURLWithPath:<span class="string">@"file://path/to/image.jpg"</span>] name:<span class="string">@"file"</span> fileName:<span class="string">@"filename.jpg"</span> mimeType:<span class="string">@"image/jpeg"</span> error:<span class="literal">nil</span>];</div><div class="line">    &#125; error:<span class="literal">nil</span>];</div><div class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration]];</div><div class="line"><span class="built_in">NSURLSessionUploadTask</span> *uploadTask;</div><div class="line">uploadTask = [manager</div><div class="line">              uploadTaskWithStreamedRequest:request</div><div class="line">              progress:^(<span class="built_in">NSProgress</span> * _Nonnull uploadProgress) &#123;</div><div class="line">                  <span class="comment">// This is not called back on the main queue.</span></div><div class="line">                  <span class="comment">// You are responsible for dispatching to the main queue for UI updates</span></div><div class="line">                  <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">                      <span class="comment">//Update the progress view</span></div><div class="line">                      [progressView setProgress:uploadProgress.fractionCompleted];</div><div class="line">                  &#125;);</div><div class="line">              &#125;</div><div class="line">              completionHandler:^(<span class="built_in">NSURLResponse</span> * _Nonnull response, <span class="keyword">id</span>  _Nullable responseObject, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">                  <span class="keyword">if</span> (error) &#123;</div><div class="line">                      <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>, error);</div><div class="line">                  &#125; <span class="keyword">else</span> &#123;</div><div class="line">                      <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, response, responseObject);</div><div class="line">                  &#125;</div><div class="line">              &#125;];</div><div class="line">[uploadTask resume];</div></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºä¸€ä¸ªæ•°æ®ä»»åŠ¡"><a href="#åˆ›å»ºä¸€ä¸ªæ•°æ®ä»»åŠ¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ•°æ®ä»»åŠ¡"></a>åˆ›å»ºä¸€ä¸ªæ•°æ®ä»»åŠ¡</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSURLSessionConfiguration</span> *configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</div><div class="line">AFURLSessionManager *manager = [[AFURLSessionManager alloc] initWithSessionConfiguration:configuration];</div><div class="line"><span class="built_in">NSURL</span> *URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://httpbin.org/get"</span>];</div><div class="line"><span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:URL];</div><div class="line"><span class="built_in">NSURLSessionDataTask</span> *dataTask = [manager dataTaskWithRequest:request completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> responseObject, <span class="built_in">NSError</span> *error) &#123;</div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>, error);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, response, responseObject);</div><div class="line">    &#125;</div><div class="line">&#125;];</div><div class="line">[dataTask resume];</div></pre></td></tr></table></figure>
<hr>
<h3 id="è¯·æ±‚åºåˆ—åŒ–"><a href="#è¯·æ±‚åºåˆ—åŒ–" class="headerlink" title="è¯·æ±‚åºåˆ—åŒ–"></a>è¯·æ±‚åºåˆ—åŒ–</h3><p>è¯·æ±‚åºåˆ—åŒ–å™¨é€šè¿‡å°†å‚æ•°ç¼–ç ä¸ºå­—ç¬¦ä¸²æˆ–HTTPè¯·æ±‚ä½“ï¼Œç»“åˆURLå­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªè¯·æ±‚ã€‚</p>
<h4 id="å­—ç¬¦ä¸²æ ¼å¼çš„å‚æ•°ç¼–ç "><a href="#å­—ç¬¦ä¸²æ ¼å¼çš„å‚æ•°ç¼–ç " class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼çš„å‚æ•°ç¼–ç "></a>å­—ç¬¦ä¸²æ ¼å¼çš„å‚æ•°ç¼–ç </h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">[[AFHTTPRequestSerializer serializer] requestWithMethod:<span class="string">@"GET"</span> URLString:URLString parameters:parameters error:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<blockquote>
<p>GET <a href="http://example.com?foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3" target="_blank" rel="external">http://example.com?foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3</a></p>
</blockquote>
<h4 id="URLæ ¼å¼çš„å‚æ•°ç¼–ç "><a href="#URLæ ¼å¼çš„å‚æ•°ç¼–ç " class="headerlink" title="URLæ ¼å¼çš„å‚æ•°ç¼–ç "></a>URLæ ¼å¼çš„å‚æ•°ç¼–ç </h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">[[AFHTTPRequestSerializer serializer] requestWithMethod:<span class="string">@"POST"</span> URLString:URLString parameters:parameters error:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<blockquote>
<p>POST <a href="http://example.com/" target="_blank" rel="external">http://example.com/</a><br>Content-Type: application/x-www-form-urlencoded<br>foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3</p>
</blockquote>
<h4 id="JSONæ ¼å¼çš„å‚æ•°ç¼–ç "><a href="#JSONæ ¼å¼çš„å‚æ•°ç¼–ç " class="headerlink" title="JSONæ ¼å¼çš„å‚æ•°ç¼–ç "></a>JSONæ ¼å¼çš„å‚æ•°ç¼–ç </h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">[[AFJSONRequestSerializer serializer] requestWithMethod:<span class="string">@"POST"</span> URLString:URLString parameters:parameters error:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<blockquote>
<p>POST <a href="http://example.com/" target="_blank" rel="external">http://example.com/</a><br>Content-Type: application/json<br>{â€œfooâ€: â€œbarâ€, â€œbazâ€: [1,2,3]}</p>
</blockquote>
<h3 id="ç½‘ç»œå¯è¾¾æ€§ç®¡ç†"><a href="#ç½‘ç»œå¯è¾¾æ€§ç®¡ç†" class="headerlink" title="ç½‘ç»œå¯è¾¾æ€§ç®¡ç†"></a>ç½‘ç»œå¯è¾¾æ€§ç®¡ç†</h3><p>AFNetworkReachabilityManagerç›‘æ§WWANå’ŒWiFiçš„ç½‘ç»œå¯è¾¾æ€§ã€‚</p>
<ul>
<li>ä¸è¦ä½¿ç”¨Reachabilityå†³å®šæ˜¯å¦å‘é€åŸå§‹è¯·æ±‚ï¼›<ul>
<li>åº”è¯¥å°è¯•é‡å‘ã€‚</li>
</ul>
</li>
<li>å¯ä»¥ä½¿ç”¨Reachabilityå†³å®šä¸€ä¸ªè¯·æ±‚åœ¨ä»€ä¹ˆæ—¶å€™è‡ªåŠ¨é‡å‘ï¼›<ul>
<li>è™½ç„¶å¯èƒ½è¯·æ±‚å¤±è´¥ï¼Œä½†ä¸€ä¸ªç½‘ç»œå¯è¾¾çš„Reachabilityé€šçŸ¥æ˜¯é‡æ–°è¯·æ±‚æŸäº›äº‹ç‰©çš„å¥½æ—¶å€™ã€‚</li>
</ul>
</li>
<li>ç½‘ç»œå¯è¾¾ç®¡ç†å™¨æ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥ç¡®å®šä¸€ä¸ªè¯·æ±‚ä¸ºä»€ä¹ˆå¤±è´¥ã€‚<ul>
<li>ä¸€ä¸ªç½‘ç»œè¯·æ±‚å¤±è´¥åï¼Œé€šçŸ¥ç”¨æˆ·â€œæ–­çº¿äº†â€ï¼Œæ¯”è¿”å›â€œè¯·æ±‚è¶…æ—¶â€è¿™ç§æ›´æŠ€æœ¯æ›´ç²¾ç¡®çš„é”™è¯¯è¦å¥½ã€‚</li>
</ul>
</li>
</ul>
<p>å‚è€ƒ <a href="https://developer.apple.com/videos/play/wwdc2012-706/" target="_blank" rel="external">WWDC 2012 session 706, â€œNetworking Best Practices.â€</a>.</p>
<h4 id="å…±äº«çš„ç½‘ç»œå¯è¾¾æ€§ç®¡ç†å™¨"><a href="#å…±äº«çš„ç½‘ç»œå¯è¾¾æ€§ç®¡ç†å™¨" class="headerlink" title="å…±äº«çš„ç½‘ç»œå¯è¾¾æ€§ç®¡ç†å™¨"></a>å…±äº«çš„ç½‘ç»œå¯è¾¾æ€§ç®¡ç†å™¨</h4><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">[[AFNetworkReachabilityManager sharedManager] setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Reachability: %@"</span>, AFStringFromNetworkReachabilityStatus(status));</div><div class="line">&#125;];</div><div class="line">[[AFNetworkReachabilityManager sharedManager] startMonitoring];</div></pre></td></tr></table></figure>
<h3 id="å®‰å…¨ç­–ç•¥"><a href="#å®‰å…¨ç­–ç•¥" class="headerlink" title="å®‰å…¨ç­–ç•¥"></a>å®‰å…¨ç­–ç•¥</h3><p>åœ¨ä½ çš„APPé‡Œæ·»åŠ pinned X.509è¯ä¹¦ä¼šå¸®ä½ é¿å…äººä¸ºæ”»å‡»å’Œå…¶ä»–æ¼æ´æ‰«æã€‚å½“åº”ç”¨å¤„ç†æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®æˆ–é‡‘èä¿¡æ¯æ—¶ï¼Œéå¸¸éœ€è¦åœ¨å…·æœ‰SSLè¯ä¹¦çš„HTTPSè¿æ¥ä¸­æ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚</p>
<p>####å…è®¸æ— æ•ˆSSLè¯ä¹¦</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">manager.securityPolicy.allowInvalidCertificates = <span class="literal">YES</span>; <span class="comment">// not recommended for production</span></div></pre></td></tr></table></figure>
]]></content:encoded>
      
      <comments>gofee.me/2017/01/25/AFNetworking-translate/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Face++ å®ç°äººè„¸è¯†åˆ«</title>
      <link>gofee.me/2016/11/30/face-recognition-02/</link>
      <guid>gofee.me/2016/11/30/face-recognition-02/</guid>
      <pubDate>Wed, 30 Nov 2016 09:37:43 GMT</pubDate>
      <description>
      
        &lt;p&gt;ä¸Šæ¬¡è®²äº†å¦‚ä½•&lt;a href=&quot;/2016/11/22/face-recognition-01/&quot; title=&quot;ä½¿ç”¨Face++å®ç°äººè„¸æœç´¢&quot;&gt;ä½¿ç”¨Face++å®ç°äººè„¸æœç´¢&lt;/a&gt;ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥è°ˆè°ˆé¢éƒ¨è¯†åˆ«çš„å®ç°æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ•ˆæœå›¾&quot;&gt;&lt;a href=&quot;#æ•ˆ
      
      </description>
      
      <content:encoded><![CDATA[<p>ä¸Šæ¬¡è®²äº†å¦‚ä½•<a href="/2016/11/22/face-recognition-01/" title="ä½¿ç”¨Face++å®ç°äººè„¸æœç´¢">ä½¿ç”¨Face++å®ç°äººè„¸æœç´¢</a>ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥è°ˆè°ˆé¢éƒ¨è¯†åˆ«çš„å®ç°æ–¹æ³•ã€‚</p>
<h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><img src="/2016/11/30/face-recognition-02/äººè„¸è¯†åˆ«.gif" alt="æ•ˆæœå›¾" title="æ•ˆæœå›¾">
<p>å°†Face++é›†æˆåˆ°é¡¹ç›®ä¸­è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ<a href="/2016/11/22/face-recognition-01/" title="ä½¿ç”¨ Face++å®ç°äººè„¸æœç´¢">ä½¿ç”¨ Face++å®ç°äººè„¸æœç´¢</a>ç¬¬ä¸€éƒ¨åˆ†ã€‚</p>
<h4 id="å¼€å§‹å·¥ä½œ"><a href="#å¼€å§‹å·¥ä½œ" class="headerlink" title="å¼€å§‹å·¥ä½œ"></a>å¼€å§‹å·¥ä½œ</h4><h5 id="1-å£°æ˜å±æ€§å˜é‡"><a href="#1-å£°æ˜å±æ€§å˜é‡" class="headerlink" title="1. å£°æ˜å±æ€§å˜é‡"></a>1. å£°æ˜å±æ€§å˜é‡</h5><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIImage</span> personImg;<span class="comment">//äººç‰©å›¾åƒ</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) IBOutletUIImageView *imgView;</div></pre></td></tr></table></figure>
<h5 id="2-ä»æœ¬åœ°ç›¸å†Œé€‰å–å›¾ç‰‡"><a href="#2-ä»æœ¬åœ°ç›¸å†Œé€‰å–å›¾ç‰‡" class="headerlink" title="2. ä»æœ¬åœ°ç›¸å†Œé€‰å–å›¾ç‰‡"></a>2. ä»æœ¬åœ°ç›¸å†Œé€‰å–å›¾ç‰‡</h5><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">UIImagePickerController</span> *picker = [[<span class="built_in">UIImagePickerController</span> alloc] init]; </div><div class="line">picker.sourceType = <span class="built_in">UIImagePickerControllerSourceTypePhotoLibrary</span>; picker.delegate = <span class="keyword">self</span>; </div><div class="line">[<span class="keyword">self</span> presentViewController:picker animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<h5 id="3-é€‰æ‹©å›¾ç‰‡åï¼Œè¿›è¡Œé¢éƒ¨è¯†åˆ«"><a href="#3-é€‰æ‹©å›¾ç‰‡åï¼Œè¿›è¡Œé¢éƒ¨è¯†åˆ«" class="headerlink" title="3. é€‰æ‹©å›¾ç‰‡åï¼Œè¿›è¡Œé¢éƒ¨è¯†åˆ«"></a>3. é€‰æ‹©å›¾ç‰‡åï¼Œè¿›è¡Œé¢éƒ¨è¯†åˆ«</h5><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)imagePickerController:(<span class="built_in">UIImagePickerController</span> *)picker didFinishPickingMediaWithInfo:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)info&#123;</div><div class="line">    _personImg = info[<span class="built_in">UIImagePickerControllerOriginalImage</span>];</div><div class="line">    [_imgView updateH:_imgView.width / (_personImg.size.width / _personImg.size.height)];<span class="comment">//æŒ‰åŸæ¯”ä¾‹æ›´æ–°è§†å›¾å®½é«˜ï¼Œç±»åˆ«æ–¹æ³•ï¼Œæ­¤å¤„å°±ä¸èµ˜è¿°äº†</span></div><div class="line">    _imgView.image = _personImg;</div><div class="line">    <span class="built_in">NSData</span> *data = <span class="built_in">UIImageJPEGRepresentation</span>(_personImg, <span class="number">1</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œç”±äºè€—è´¹æ—¶é—´è¾ƒé•¿ï¼Œæœ€å¥½å¼‚æ­¥æ‰§è¡Œ</span></div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        FaceppResult *result = [[FaceppAPI detection] detectWithURL:<span class="literal">nil</span> orImageData:data mode:FaceppDetectionModeOneFace attribute:FaceppDetectionAttributeAll tag:<span class="literal">nil</span> async:<span class="literal">NO</span> others:<span class="literal">nil</span>];</div><div class="line">        <span class="comment">//å›åˆ°ä¸»çº¿ç¨‹æ›´æ–°UI</span></div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            [<span class="keyword">self</span> didFinishDetection:result];</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">    [picker dismissViewControllerAnimated:<span class="literal">YES</span> completion:^&#123;</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>resultè¿”å›å€¼è¯´æ˜ï¼ŒJSONç¤ºä¾‹</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">&#123;<span class="string">"face"</span>: [</div><div class="line">    &#123;<span class="string">"attribute"</span>: &#123;</div><div class="line">        <span class="string">"age"</span>: &#123;<span class="comment">//åŒ…å«å¹´é¾„åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸ºä¸€ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºä¼°è®¡çš„å¹´é¾„, rangeè¡¨ç¤ºä¼°è®¡å¹´é¾„çš„æ­£è´ŸåŒºé—´</span></div><div class="line">            <span class="string">"range"</span>: <span class="number">5</span>,</div><div class="line">            <span class="string">"value"</span>: <span class="number">14</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"gender"</span>: &#123;<span class="comment">//åŒ…å«æ€§åˆ«åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸ºMale/Female, confidenceè¡¨ç¤ºç½®ä¿¡åº¦</span></div><div class="line">            <span class="string">"confidence"</span>: <span class="number">99.9981</span>,</div><div class="line">            <span class="string">"value"</span>: <span class="string">"Female"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"race"</span>: &#123;<span class="comment">//åŒ…å«äººç§åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸ºAsian/White/Black, confidenceè¡¨ç¤ºç½®ä¿¡åº¦</span></div><div class="line">            <span class="string">"confidence"</span>: <span class="number">99.818</span>,</div><div class="line">            <span class="string">"value"</span>: <span class="string">"Asian"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"smiling"</span>: &#123;<span class="comment">//åŒ…å«å¾®ç¬‘ç¨‹åº¦åˆ†æç»“æœï¼Œvalueçš„å€¼ä¸º0ï¼100çš„å®æ•°ï¼Œè¶Šå¤§è¡¨ç¤ºå¾®ç¬‘ç¨‹åº¦è¶Šé«˜</span></div><div class="line">            <span class="string">"value"</span>: <span class="number">8.14031</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">      <span class="string">"face_id"</span>: <span class="string">"62bed8c94bbf92323675943328aed269"</span>,</div><div class="line">      <span class="string">"position"</span>: &#123;</div><div class="line">          <span class="string">"center"</span>: &#123;<span class="comment">//æ£€å‡ºçš„äººè„¸æ¡†çš„ä¸­å¿ƒç‚¹åæ ‡, x &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°)</span></div><div class="line">              <span class="string">"x"</span>: <span class="number">49.731183</span>,</div><div class="line">              <span class="string">"y"</span>: <span class="number">32.5</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"eye_left"</span>: &#123;<span class="comment">//ç›¸åº”äººè„¸çš„å·¦çœ¼åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°)</span></div><div class="line">              <span class="string">"x"</span>: <span class="number">43.148441</span>,</div><div class="line">              <span class="string">"y"</span>: <span class="number">28.722909</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"eye_right"</span>: &#123;<span class="comment">//ç›¸åº”äººè„¸çš„å³çœ¼åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°)</span></div><div class="line">              <span class="string">"x"</span>: <span class="number">55.413441</span>,</div><div class="line">              <span class="string">"y"</span>: <span class="number">27.745455</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"height"</span>: <span class="number">21.363636</span>, <span class="comment">//0~100ä¹‹é—´çš„å®æ•°ï¼Œè¡¨ç¤ºæ£€å‡ºçš„è„¸çš„é«˜åº¦åœ¨å›¾ç‰‡ä¸­ç™¾åˆ†æ¯”</span></div><div class="line">          <span class="string">"mouth_left"</span>: &#123;<span class="comment">//ç›¸åº”äººè„¸çš„å·¦ä¾§å˜´è§’åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°)</span></div><div class="line">              <span class="string">"x"</span>: <span class="number">46.193978</span>,</div><div class="line">              <span class="string">"y"</span>: <span class="number">39.472682</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"mouth_right"</span>: &#123;<span class="comment">//ç›¸åº”äººè„¸çš„å³ä¾§å˜´è§’åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°)</span></div><div class="line">              <span class="string">"x"</span>: <span class="number">54.952688</span>,</div><div class="line">              <span class="string">"y"</span>: <span class="number">38.989955</span></div><div class="line">          &#125;,</div><div class="line">          <span class="string">"nose"</span>: &#123;<span class="comment">//ç›¸åº”äººè„¸çš„é¼»å°–åæ ‡ï¼Œx &amp; y åæ ‡åˆ†åˆ«è¡¨ç¤ºåœ¨å›¾ç‰‡ä¸­çš„å®½åº¦å’Œé«˜åº¦çš„ç™¾åˆ†æ¯” (0~100ä¹‹é—´çš„å®æ•°)</span></div><div class="line">              <span class="string">"x"</span>: <span class="number">50.23414</span>,                    </div><div class="line">              <span class="string">"y"</span>: <span class="number">34.953727</span>                </div><div class="line">          &#125;,                </div><div class="line">          <span class="string">"width"</span>: <span class="number">25.268817</span> <span class="comment">//0~100ä¹‹é—´çš„å®æ•°ï¼Œè¡¨ç¤ºæ£€å‡ºçš„è„¸çš„å®½åº¦åœ¨å›¾ç‰‡ä¸­ç™¾åˆ†æ¯”            </span></div><div class="line">      &#125;,            </div><div class="line">      <span class="string">"tag"</span>: <span class="string">""</span>        </div><div class="line">    &#125;],</div><div class="line">    <span class="string">"img_height"</span>: <span class="number">220</span>,</div><div class="line">    <span class="string">"img_id"</span>: <span class="string">"064aae142ef977bb44b6cc3dd9a6eeb1"</span>,    </div><div class="line">    <span class="string">"img_width"</span>: <span class="number">186</span>,    </div><div class="line">    <span class="string">"session_id"</span>: <span class="string">"ade961e7b0d347ca943e0f0f752f7cc5"</span>,    </div><div class="line">    <span class="string">"url"</span>: null</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="4-å¯¹æ£€æµ‹ç»“æœè¿›è¡Œå¤„ç†"><a href="#4-å¯¹æ£€æµ‹ç»“æœè¿›è¡Œå¤„ç†" class="headerlink" title="4. å¯¹æ£€æµ‹ç»“æœè¿›è¡Œå¤„ç†"></a>4. å¯¹æ£€æµ‹ç»“æœè¿›è¡Œå¤„ç†</h5><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)didFinishDetection:(FaceppResult *)result&#123;</div><div class="line">    <span class="built_in">NSDictionary</span> *face = [result content][<span class="string">@"face"</span>][<span class="number">0</span>];</div><div class="line">    [<span class="keyword">self</span> markTheFiveSenseOrgansWithData:face];</div><div class="line">    [<span class="keyword">self</span> markFaceWithData:face];</div><div class="line">    [<span class="keyword">self</span> analysisPersonWithData:face];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>1) æ ‡è®°è„¸éƒ¨èŒƒå›´</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)markFaceWithData:(<span class="built_in">NSDictionary</span> *)face&#123;</div><div class="line">    <span class="built_in">CGFloat</span> img_width = _imgView.frame.size.width;</div><div class="line">    <span class="built_in">CGFloat</span> img_height = _imgView.frame.size.height;</div><div class="line">    <span class="built_in">CGFloat</span> center_x = [face[<span class="string">@"position"</span>][<span class="string">@"center"</span>][<span class="string">@"x"</span>] floatValue] / <span class="number">100.</span>f * img_width;<span class="comment">//è„¸éƒ¨ä¸­å¿ƒç‚¹xåæ ‡</span></div><div class="line">    <span class="built_in">CGFloat</span> center_y = [face[<span class="string">@"position"</span>][<span class="string">@"center"</span>][<span class="string">@"y"</span>] floatValue] / <span class="number">100.</span>f * img_height;<span class="comment">//è„¸éƒ¨ä¸­å¿ƒç‚¹yåæ ‡</span></div><div class="line">    <span class="built_in">CGFloat</span> width = [face[<span class="string">@"position"</span>][<span class="string">@"width"</span>] floatValue] / <span class="number">100.</span>f * img_width;<span class="comment">//è„¸éƒ¨å®½åº¦</span></div><div class="line">    <span class="built_in">CGFloat</span> height = [face[<span class="string">@"position"</span>][<span class="string">@"height"</span>] floatValue] / <span class="number">100.</span>f * img_height;<span class="comment">//è„¸éƒ¨é«˜åº¦</span></div><div class="line">    <span class="built_in">CGPoint</span> center = <span class="built_in">CGPointMake</span>(center_x, center_y);    </div><div class="line">    <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">    <span class="comment">//è‡ªå®šä¹‰ä¸€ä¸ªCALayer,ç”»ä¸€ä¸ªçŸ©å½¢</span></div><div class="line">    RectLayer *rectLayer = [RectLayer layer];</div><div class="line">    rectLayer.bounds = rect;</div><div class="line">    rectLayer.position = center;</div><div class="line">    [rectLayer setNeedsDisplayInRect:rect];</div><div class="line">    [<span class="keyword">self</span>.imgView.layer addSublayer:rectLayer];     <span class="comment">//è‡ªå®šä¹‰ä¸€ä¸ªCALayer,ç”»ä¸€ä¸ªçŸ©å½¢</span></div><div class="line">    [rectLayer twinkleAnimation:<span class="number">3</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2) æ ‡è®°äº”å®˜</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)markTheFiveSenseOrgansWithData:(<span class="built_in">NSDictionary</span> *)face&#123;</div><div class="line">    <span class="built_in">CGFloat</span> img_width = _imgView.frame.size.width;</div><div class="line">    <span class="built_in">CGFloat</span> img_height = _imgView.frame.size.height;</div><div class="line">    <span class="built_in">CGFloat</span> eye_left_x = [face[<span class="string">@"position"</span>][<span class="string">@"eye_left"</span>][<span class="string">@"x"</span>] floatValue] / <span class="number">100.</span>f * img_width;</div><div class="line">    <span class="built_in">CGFloat</span> eye_left_y = [face[<span class="string">@"position"</span>][<span class="string">@"eye_left"</span>][<span class="string">@"y"</span>] floatValue] / <span class="number">100.</span>f * img_height;</div><div class="line">    <span class="built_in">CGFloat</span> eye_right_x = [face[<span class="string">@"position"</span>][<span class="string">@"eye_right"</span>][<span class="string">@"x"</span>] floatValue] / <span class="number">100.</span>f * img_width;</div><div class="line">    <span class="built_in">CGFloat</span> eye_right_y = [face[<span class="string">@"position"</span>][<span class="string">@"eye_right"</span>][<span class="string">@"y"</span>] floatValue] / <span class="number">100.</span>f * img_height;</div><div class="line">    <span class="built_in">CGFloat</span> mouth_left_x = [face[<span class="string">@"position"</span>][<span class="string">@"mouth_left"</span>][<span class="string">@"x"</span>] floatValue] / <span class="number">100.</span>f * img_width;</div><div class="line">    <span class="built_in">CGFloat</span> mouth_left_y = [face[<span class="string">@"position"</span>][<span class="string">@"mouth_left"</span>][<span class="string">@"y"</span>] floatValue] / <span class="number">100.</span>f * img_height;</div><div class="line">    <span class="built_in">CGFloat</span> mouth_right_x = [face[<span class="string">@"position"</span>][<span class="string">@"mouth_right"</span>][<span class="string">@"x"</span>] floatValue] / <span class="number">100.</span>f * img_width;</div><div class="line">    <span class="built_in">CGFloat</span> mouth_right_y = [face[<span class="string">@"position"</span>][<span class="string">@"mouth_right"</span>][<span class="string">@"y"</span>] floatValue] / <span class="number">100.</span>f * img_height;</div><div class="line">    <span class="built_in">CGFloat</span> nose_x = [face[<span class="string">@"position"</span>][<span class="string">@"nose"</span>][<span class="string">@"x"</span>] floatValue] / <span class="number">100.</span>f * img_width;</div><div class="line">    <span class="built_in">CGFloat</span> nose_y = [face[<span class="string">@"position"</span>][<span class="string">@"nose"</span>][<span class="string">@"y"</span>] floatValue] / <span class="number">100.</span>f * img_height;</div><div class="line">    <span class="comment">//æ ‡æ³¨å·¦çœ¼</span></div><div class="line">    <span class="built_in">CALayer</span> *leftEyeLayer = [<span class="built_in">CALayer</span> layer];</div><div class="line">    leftEyeLayer.frame = <span class="built_in">CGRectMake</span>(eye_left_x, eye_left_y, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">    leftEyeLayer.backgroundColor = [<span class="built_in">UIColor</span> greenColor].CGColor;</div><div class="line">    [leftEyeLayer setNeedsDisplay];</div><div class="line">    [<span class="keyword">self</span>.imgView.layer addSublayer:leftEyeLayer];</div><div class="line">    </div><div class="line">    <span class="comment">//æ ‡æ³¨å³çœ¼    CALayer *rightEyeLayer = [CALayer layer];</span></div><div class="line">    rightEyeLayer.frame = <span class="built_in">CGRectMake</span>(eye_right_x, eye_right_y, <span class="number">2</span>, <span class="number">2</span>);</div><div class="line">    rightEyeLayer.backgroundColor = [<span class="built_in">UIColor</span> greenColor].CGColor;</div><div class="line">    [rightEyeLayer setNeedsDisplay];</div><div class="line">    [<span class="keyword">self</span>.imgView.layer addSublayer:rightEyeLayer];</div><div class="line">    [leftEyeLayer twinkleAnimation:<span class="number">3</span>];</div><div class="line">    [rightEyeLayer twinkleAnimation:<span class="number">3</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//æ ‡æ³¨é¼»å­</span></div><div class="line">    RoundLayer *noseLayer = [RoundLayer layer];</div><div class="line">    noseLayer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>, <span class="number">20</span>);</div><div class="line">    noseLayer.position = <span class="built_in">CGPointMake</span>(nose_x, nose_y);</div><div class="line">    [noseLayer setNeedsDisplay];</div><div class="line">    [<span class="keyword">self</span>.imgView.layer addSublayer:noseLayer];</div><div class="line">    [noseLayer twinkleAnimation:<span class="number">3</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//æ ‡æ³¨å˜´å·´</span></div><div class="line">    RectLayer *mouthLayer = [RectLayer layer];</div><div class="line">    mouthLayer.frame = <span class="built_in">CGRectMake</span>(mouth_left_x, mouth_left_y, mouth_right_x - mouth_left_x, mouth_right_y - mouth_left_y);</div><div class="line">    [mouthLayer setNeedsDisplay];</div><div class="line">    [<span class="keyword">self</span>.imgView.layer addSublayer:mouthLayer];</div><div class="line">    [mouthLayer twinkleAnimation:<span class="number">3</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3) åˆ†æäººç‰©ç‰¹å¾</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)analysisPersonWithData:(<span class="built_in">NSDictionary</span> *)face&#123;</div><div class="line">    <span class="built_in">CGFloat</span> smiling = [face[<span class="string">@"attribute"</span>][<span class="string">@"smiling"</span>][<span class="string">@"value"</span>] floatValue];<span class="comment">//ç¬‘å®¹</span></div><div class="line">    <span class="built_in">NSInteger</span> age_value = [face[<span class="string">@"attribute"</span>][<span class="string">@"age"</span>][<span class="string">@"value"</span>] integerValue];<span class="comment">//å¹´é¾„</span></div><div class="line">    <span class="built_in">NSInteger</span> age_range = [face[<span class="string">@"attribute"</span>][<span class="string">@"age"</span>][<span class="string">@"range"</span>] integerValue];<span class="comment">//å¹´é¾„è¯¯å·®</span></div><div class="line">    <span class="built_in">NSString</span> *gender = face[<span class="string">@"attribute"</span>][<span class="string">@"gender"</span>][<span class="string">@"value"</span>];<span class="comment">//æ€§åˆ«</span></div><div class="line">    <span class="built_in">NSString</span> *race = face[<span class="string">@"attribute"</span>][<span class="string">@"race"</span>][<span class="string">@"value"</span>];<span class="comment">//ç§æ—</span></div><div class="line">    <span class="built_in">NSArray</span> *texts = @[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"å¼€å¿ƒåº¦ï¼š%@"</span>, @(smiling).stringValue],</div><div class="line">                       [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"å¹´é¾„ï¼š%ld - %ld"</span>,age_value - age_range, age_value + age_range],</div><div class="line">                       [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"æ€§åˆ«ï¼š%@"</span>, gender],</div><div class="line">                       [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"ç§æ—ï¼š%@"</span>, race]];</div><div class="line">    <span class="built_in">CGFloat</span> width = <span class="keyword">self</span>.view.width - <span class="number">40</span>;</div><div class="line">    <span class="built_in">CGFloat</span> height = <span class="number">20</span>;</div><div class="line">    <span class="built_in">CGFloat</span> x = <span class="number">20</span>;</div><div class="line">    <span class="built_in">CGFloat</span> margin = <span class="number">10</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">        <span class="built_in">CGFloat</span> y = _imgView.height + _imgView.y + height * i + margin * (i + <span class="number">1</span>);</div><div class="line">        <span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(x, y, width, height)];</div><div class="line">        label.text = texts[i];</div><div class="line">        [<span class="keyword">self</span>.view addSubview:label];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="5-è‡ªå®šä¹‰layer"><a href="#5-è‡ªå®šä¹‰layer" class="headerlink" title="5. è‡ªå®šä¹‰layer"></a>5. è‡ªå®šä¹‰layer</h5><p>1ï¼‰RectLayeré‡å†™drawInContextæ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)ctx&#123;</div><div class="line">    <span class="comment">//1.ç»˜åˆ¶å›¾å½¢</span></div><div class="line">    <span class="comment">//ç”»ä¸€ä¸ªçŸ©å½¢</span></div><div class="line">    <span class="built_in">CGContextAddRect</span>(ctx, <span class="keyword">self</span>.bounds);</div><div class="line">    <span class="comment">//è®¾ç½®å±æ€§ï¼ˆé¢œè‰²ï¼‰</span></div><div class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">2</span>);</div><div class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(ctx, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    <span class="comment">//2.æ¸²æŸ“</span></div><div class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2ï¼‰RoundLayeré‡å†™drawInContextæ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)ctx&#123;</div><div class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="keyword">self</span>.bounds);</div><div class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">2</span>);</div><div class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(ctx, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="6-åˆ›å»ºCALayerç±»åˆ«ï¼Œç®¡ç†layeråŠ¨ç”»"><a href="#6-åˆ›å»ºCALayerç±»åˆ«ï¼Œç®¡ç†layeråŠ¨ç”»" class="headerlink" title="6. åˆ›å»ºCALayerç±»åˆ«ï¼Œç®¡ç†layeråŠ¨ç”»"></a>6. åˆ›å»ºCALayerç±»åˆ«ï¼Œç®¡ç†layeråŠ¨ç”»</h5><figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"CALayer+Animation.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CALayer</span> (<span class="title">Animation</span>)</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)twinkleAnimation:(<span class="keyword">float</span>)time&#123;</div><div class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"opacity"</span>];</div><div class="line">    animation.fromValue = @[@<span class="number">1.0</span>f];</div><div class="line">    animation.toValue = @[@<span class="number">0.0</span>f];</div><div class="line">    animation.autoreverses = <span class="literal">YES</span>;</div><div class="line">    animation.duration = time * <span class="number">0.1</span>;</div><div class="line">    animation.repeatCount = time - <span class="number">1</span>;</div><div class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    [<span class="keyword">self</span> addAnimation:animation forKey:<span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
]]></content:encoded>
      
      <comments>gofee.me/2016/11/30/face-recognition-02/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
